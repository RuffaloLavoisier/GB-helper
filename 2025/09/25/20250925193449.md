# Commit: f79aea3a56613dd696c04491c80364903383a430
## Message: Garmin: Fix FitCodeGen string arrays
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/fit/codegen/FitCodeGen.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/fit/messages/FitSegmentFile.java

app/src/test/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupportTest.java

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/fit/codegen/FitCodeGen.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/fit/codegen/FitCodeGen.java
index 3bf50584b9..90fb0955c3 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/fit/codegen/FitCodeGen.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/fit/codegen/FitCodeGen.java
@@ -27,6 +27,7 @@ import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.fit.GlobalFIT
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.fit.RecordData;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.fit.RecordDefinition;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.fit.RecordHeader;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.fit.baseTypes.BaseType;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.fit.fieldDefinitions.FieldDefinitionAlarmLabel;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.fit.fieldDefinitions.FieldDefinitionExerciseCategory;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.fit.fieldDefinitions.FieldDefinitionGoalSource;
@@ -342,7 +343,7 @@ public class FitCodeGen {
         if (primitive.getType() != null) {
             return switch (primitive.getType()) {
                 case ALARM -> LocalTime.class;
-                case ARRAY -> Number[].class;
+                case ARRAY -> primitive.getBaseType() == BaseType.STRING ? String[].class : Number[].class;
                 case BOOLEAN -> Boolean.class;
                 case DAY_OF_WEEK -> DayOfWeek.class;
                 case EXERCISE_CATEGORY -> FieldDefinitionExerciseCategory.ExerciseCategory[].class;
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/fit/messages/FitSegmentFile.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/fit/messages/FitSegmentFile.java
index 504a3d6d91..87d3852f83 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/fit/messages/FitSegmentFile.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/fit/messages/FitSegmentFile.java
@@ -103,17 +103,17 @@ public class FitSegmentFile extends RecordData {
     }
 
     @Nullable
-    public Number[] getLeaderActivityIdString() {
+    public String[] getLeaderActivityIdString() {
         final Object object = getFieldByNumber(10);
         if (object == null)
             return null;
         if (!object.getClass().isArray()) {
-            return new Number[]{(Number) object};
+            return new String[]{(String) object};
         }
         final Object[] objectsArray = (Object[]) object;
-        final Number[] ret = new Number[objectsArray.length];
+        final String[] ret = new String[objectsArray.length];
         for (int i = 0; i < objectsArray.length; i++) {
-            ret[i] = (Number) objectsArray[i];
+            ret[i] = (String) objectsArray[i];
         }
         return ret;
     }
@@ -166,7 +166,7 @@ public class FitSegmentFile extends RecordData {
             return this;
         }
 
-        public Builder setLeaderActivityIdString(final Number[] value) {
+        public Builder setLeaderActivityIdString(final String[] value) {
             setFieldByNumber(10, (Object[]) value);
             return this;
         }
diff --git a/app/src/test/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupportTest.java b/app/src/test/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupportTest.java
index f38b797dbf..c70e398cba 100644
--- a/app/src/test/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupportTest.java
+++ b/app/src/test/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupportTest.java
@@ -850,11 +850,6 @@ public class GarminSupportTest extends TestBase {
                         // FIXME java.lang.ClassCastException: class java.lang.Integer cannot be cast to class java.lang.Double
                         continue;
                     }
-                    if ("FitSegmentFile".equals(recordName) && "getLeaderActivityIdString".equals(methodName)) {
-                        // TODO GarminSupportTest.TestFitMessageTypeParsing -> FitCodeGen is broken
-                        // FIXME FitSegmentFile.getLeaderActivityIdString should return String[] instead of Number[]
-                        continue;
-                    }
                     if ("FitMonitoring".equals(recordName) && "getActivityTime".equals(methodName)) {
                         // TODO GarminSupportTest.TestFitMessageTypeParsing -> sample fit file is likely broken
                         // FIXME sample FIT should use a plain value and not an array
```
-----------------------------------
