# Commit: 24c96a64976625fdd53b582d80897db5b76aa77a
## Message: Sony headphones: Fix recognition of some bluetooth names
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC510Coordinator.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC700NCoordinator.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC710NCoordinator.java

app/src/test/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinatorTest.java

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC510Coordinator.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC510Coordinator.java
index bf159ac532..d011c15ffd 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC510Coordinator.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC510Coordinator.java
@@ -29,7 +29,7 @@ public class SonyWFC510Coordinator extends SonyHeadphonesCoordinator {
 
     @Override
     protected Pattern getSupportedDeviceName() {
-        return Pattern.compile("WF-C510");
+        return Pattern.compile(".*WF-C510.*");
     }
 
     @Override
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC700NCoordinator.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC700NCoordinator.java
index 5b22cbb575..b79ae5301c 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC700NCoordinator.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC700NCoordinator.java
@@ -29,7 +29,7 @@ public class SonyWFC700NCoordinator extends SonyHeadphonesCoordinator {
 
     @Override
     protected Pattern getSupportedDeviceName() {
-        return Pattern.compile("WF-C700N");
+        return Pattern.compile(".*WF-C700N.*");
     }
 
     @Override
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC710NCoordinator.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC710NCoordinator.java
index 03a24e7646..2009aabe2d 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC710NCoordinator.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/sony/headphones/coordinators/SonyWFC710NCoordinator.java
@@ -29,7 +29,8 @@ public class SonyWFC710NCoordinator extends SonyHeadphonesCoordinator {
 
     @Override
     protected Pattern getSupportedDeviceName() {
-        return Pattern.compile("WF-C710N");
+        // Each headphone reports a separate LE_WF-C710N, which we must ignore
+        return Pattern.compile("(?!LE_).*WF-C710N$");
     }
 
     @Override
diff --git a/app/src/test/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinatorTest.java b/app/src/test/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinatorTest.java
index ec783256e4..0a19b7d868 100644
--- a/app/src/test/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinatorTest.java
+++ b/app/src/test/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinatorTest.java
@@ -46,29 +46,43 @@ public class AbstractDeviceCoordinatorTest extends TestBase {
             put("Amazfit T-Rex 3", DeviceType.AMAZFITTREX3);
             put("Amazfit T-Rex Ultra", DeviceType.AMAZFITTREXULTRA);
             put("Xiaomi Smart Band 7", DeviceType.MIBAND7);
+            put("Xiaomi Band 9 Active AB01", DeviceType.MIBAND9ACTIVE);
             put("P8", DeviceType.WASPOS);
             put("P8DFU", DeviceType.WASPOS);
             put("P80", DeviceType.COLMI_P80);
             put("R11C_B200", DeviceType.YAWELL_R11);
             put("R11_B200", DeviceType.YAWELL_R11);
+            put("WF-C710N", DeviceType.SONY_WF_C710N);
+            put("John's WF-C710N", DeviceType.SONY_WF_C710N);
+            put("LE_WF-C710N", null);
         }};
 
         for (Map.Entry<String, DeviceType> e : bluetoothNameToExpectedType.entrySet()) {
+            final String bluetoothName = e.getKey();
+            final DeviceType expectedType = e.getValue();
             final List<DeviceType> matches = new ArrayList<>(1);
+            // Check the bluetooth name against all existing coordinators
             for (DeviceType type : DeviceType.values()) {
                 final Pattern pattern = ((AbstractDeviceCoordinator) type.getDeviceCoordinator()).getSupportedDeviceName();
                 if (pattern != null) {
-                    if (pattern.matcher(e.getKey()).matches()) {
+                    if (pattern.matcher(bluetoothName).matches()) {
                         matches.add(type);
                     }
                 }
             }
 
-            Assert.assertEquals(
-                    "Bluetooth name " + e.getKey() + " should only match the expected DeviceType",
-                    Collections.singletonList(e.getValue()),
-                    matches
-            );
+            if (expectedType != null) {
+                Assert.assertEquals(
+                        "Bluetooth name " + bluetoothName + " should only match the expected DeviceType",
+                        Collections.singletonList(expectedType),
+                        matches
+                );
+            } else {
+                Assert.assertTrue(
+                        "Bluetooth name " + bluetoothName + " should match no DeviceType",
+                        matches.isEmpty()
+                );
+            }
         }
     }
 }
```
-----------------------------------
