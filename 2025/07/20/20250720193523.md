# Commit: 5b35bbba8f412ae451f02650c66a4871d8b9f9cf
## Message: Rewrite Weather class in Kotlin and extract cache handling and mapping methods

Cache Handling and static mapping methods are extracted to new classes

Also adds test for weather mapping and moves legacy Weather class there to ensure the conversion to kotlin did not introduce errors
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/Weather.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherCacheManager.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherMapper.kt

app/src/test/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherMapperTest.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/Weather.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/GBApplication.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/DebugActivity.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/SettingsActivity.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/CMWeatherReceiver.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/GenericWeatherReceiver.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/LineageOsWeatherReceiver.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/OmniJawsObserver.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/TinyWeatherForecastGermanyReceiver.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/WeatherNotificationReceiver.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/banglejs/BangleJSDeviceSupport.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/cmfwatchpro/CmfWatchProSupport.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/evenrealities/G1DeviceSupport.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/fitpro/FitProDeviceSupport.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupport.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/WeatherHandler.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/HuamiSupport.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/zeppos/ZeppOsWeatherHandler.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWeatherManager.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/moyoung/MoyoungDeviceSupport.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerHealthify.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerM7S.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerMarioTime.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerObsidian.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerPebStyle.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerRealWeather.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerSimplyLight.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerSquare.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerTimeStylePebble.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerTrekVolle.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerYWeather.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerZalewszczak.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/PebbleProtocol.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/webview/GBWebClient.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/qhybrid/adapter/fossil_hr/FossilHRWatchAdapter.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/xiaomi/services/XiaomiWeatherService.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/zetime/ZeTimeDeviceSupport.java

app/src/main/java/ru/gelin/android/weather/notification/ParcelableWeather2.java

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/GBApplication.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/GBApplication.java
index f1409fdf38..3ba709ee3f 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/GBApplication.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/GBApplication.java
@@ -87,6 +87,7 @@ import nodomain.freeyourgadget.gadgetbridge.model.ActivityUser;
 import nodomain.freeyourgadget.gadgetbridge.model.DeviceService;
 import nodomain.freeyourgadget.gadgetbridge.model.DeviceType;
 import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherCacheManager;
 import nodomain.freeyourgadget.gadgetbridge.service.NotificationCollectorMonitorService;
 import nodomain.freeyourgadget.gadgetbridge.util.AndroidUtils;
 import nodomain.freeyourgadget.gadgetbridge.util.BondingUtil;
@@ -310,7 +311,7 @@ public class GBApplication extends Application {
 
         setupExceptionHandler(prefs.getBoolean("crash_notification", isDebug()));
 
-        Weather.getInstance().setCacheFile(getCacheDir(), prefs.getBoolean("cache_weather", true));
+        Weather.INSTANCE.initializeCache(new WeatherCacheManager(getCacheDir(), prefs.getBoolean("cache_weather", true)));
 
         deviceManager = new DeviceManager(this);
         String language = prefs.getString("language", "default");
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/DebugActivity.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/DebugActivity.java
index 7b2c31db69..b89c079bd7 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/DebugActivity.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/DebugActivity.java
@@ -124,6 +124,7 @@ import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;
 import nodomain.freeyourgadget.gadgetbridge.model.RecordedDataTypes;
 import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 import nodomain.freeyourgadget.gadgetbridge.service.serial.GBDeviceProtocol;
 import nodomain.freeyourgadget.gadgetbridge.util.GB;
@@ -362,13 +363,13 @@ public class DebugActivity extends AbstractGBActivity {
         setWeatherButton.setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
-                if (Weather.getInstance().getWeatherSpec() == null) {
+                if (Weather.INSTANCE.getWeatherSpec() == null) {
                     final WeatherSpec weatherSpec = new WeatherSpec();
                     weatherSpec.forecasts = new ArrayList<>();
 
                     weatherSpec.location = "Green Hill";
                     weatherSpec.currentConditionCode = 601; // snow
-                    weatherSpec.currentCondition = Weather.getConditionString(DebugActivity.this, weatherSpec.currentConditionCode);
+                    weatherSpec.currentCondition = WeatherMapper.INSTANCE.getConditionString(DebugActivity.this, weatherSpec.currentConditionCode);
 
                     weatherSpec.currentTemp = 15 + 273;
                     weatherSpec.currentHumidity = 30;
@@ -388,10 +389,10 @@ public class DebugActivity extends AbstractGBActivity {
                         weatherSpec.forecasts.add(gbForecast);
                     }
 
-                    Weather.getInstance().setWeatherSpec(new ArrayList<>(Collections.singletonList(weatherSpec)));
+                    Weather.INSTANCE.setWeatherSpec(new ArrayList<>(Collections.singletonList(weatherSpec)));
                 }
 
-                final ArrayList<WeatherSpec> specs = new ArrayList<>(Weather.getInstance().getWeatherSpecs());
+                final ArrayList<WeatherSpec> specs = new ArrayList<>(Weather.INSTANCE.getWeatherSpecs());
                 GBApplication.deviceService().onSendWeather(specs);
             }
         });
@@ -400,7 +401,7 @@ public class DebugActivity extends AbstractGBActivity {
         showCachedWeatherButton.setOnClickListener(new View.OnClickListener(){
             @Override
             public void onClick(View v) {
-                final List<WeatherSpec> weatherSpecs = Weather.getInstance().getWeatherSpecs();
+                final List<WeatherSpec> weatherSpecs = Weather.INSTANCE.getWeatherSpecs();
 
                 if (weatherSpecs == null || weatherSpecs.isEmpty()) {
                     displayWeatherInfo(null);
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/SettingsActivity.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/SettingsActivity.java
index 2e0d22fb71..99fcea19be 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/SettingsActivity.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/SettingsActivity.java
@@ -69,6 +69,7 @@ import nodomain.freeyourgadget.gadgetbridge.activities.maps.MapsSettingsActivity
 import nodomain.freeyourgadget.gadgetbridge.database.PeriodicExporter;
 import nodomain.freeyourgadget.gadgetbridge.externalevents.TimeChangeReceiver;
 import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherCacheManager;
 import nodomain.freeyourgadget.gadgetbridge.util.AndroidUtils;
 import nodomain.freeyourgadget.gadgetbridge.util.FileUtils;
 import nodomain.freeyourgadget.gadgetbridge.util.GB;
@@ -168,7 +169,7 @@ public class SettingsActivity extends AbstractSettingsActivityV2 {
                 pref.setOnPreferenceChangeListener((preference, newVal) -> {
                     boolean doEnable = Boolean.TRUE.equals(newVal);
 
-                    Weather.getInstance().setCacheFile(requireContext().getCacheDir(), doEnable);
+                    Weather.INSTANCE.initializeCache(new WeatherCacheManager(requireContext().getCacheDir(), doEnable));
 
                     return true;
                 });
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/CMWeatherReceiver.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/CMWeatherReceiver.java
index fac552f910..7d098d86b9 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/CMWeatherReceiver.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/CMWeatherReceiver.java
@@ -38,6 +38,7 @@ import cyanogenmod.weather.util.WeatherUtils;
 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;
 import nodomain.freeyourgadget.gadgetbridge.GBApplication;
 import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 import nodomain.freeyourgadget.gadgetbridge.util.PendingIntentUtils;
 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;
@@ -158,8 +159,8 @@ public class CMWeatherReceiver extends BroadcastReceiver implements CMWeatherMan
             }
             weatherSpec.windDirection = (int) weatherInfo.getWindDirection();
 
-            weatherSpec.currentConditionCode = Weather.mapToOpenWeatherMapCondition(CMtoYahooCondintion(weatherInfo.getConditionCode()));
-            weatherSpec.currentCondition = Weather.getConditionString(mContext, weatherSpec.currentConditionCode);
+            weatherSpec.currentConditionCode = WeatherMapper.INSTANCE.mapToOpenWeatherMapCondition(CMtoYahooCondintion(weatherInfo.getConditionCode()));
+            weatherSpec.currentCondition = WeatherMapper.INSTANCE.getConditionString(mContext, weatherSpec.currentConditionCode);
             weatherSpec.currentHumidity = (int) weatherInfo.getHumidity();
 
             weatherSpec.forecasts = new ArrayList<>();
@@ -174,11 +175,11 @@ public class CMWeatherReceiver extends BroadcastReceiver implements CMWeatherMan
                     gbForecast.maxTemp = (int) cmForecast.getHigh() + 273;
                     gbForecast.minTemp = (int) cmForecast.getLow() + 273;
                 }
-                gbForecast.conditionCode = Weather.mapToOpenWeatherMapCondition(CMtoYahooCondintion(cmForecast.getConditionCode()));
+                gbForecast.conditionCode = WeatherMapper.INSTANCE.mapToOpenWeatherMapCondition(CMtoYahooCondintion(cmForecast.getConditionCode()));
                 weatherSpec.forecasts.add(gbForecast);
             }
             ArrayList<WeatherSpec> weatherSpecs = new ArrayList<>(Collections.singletonList(weatherSpec));
-            Weather.getInstance().setWeatherSpec(weatherSpecs);
+            Weather.INSTANCE.setWeatherSpec(weatherSpecs);
             GBApplication.deviceService().onSendWeather(weatherSpecs);
         } else {
             LOG.info("request has returned null for WeatherInfo");
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/GenericWeatherReceiver.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/GenericWeatherReceiver.java
index ee5267700d..673aee9647 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/GenericWeatherReceiver.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/GenericWeatherReceiver.java
@@ -84,7 +84,7 @@ public class GenericWeatherReceiver extends BroadcastReceiver {
             }
 
             LOG.info("Got generic weather for {} locations", weathers.size());
-            Weather.getInstance().setWeatherSpec(weathers);
+            Weather.INSTANCE.setWeatherSpec(weathers);
             GBApplication.deviceService().onSendWeather(weathers);
         } catch (final Exception e) {
             GB.toast("Gadgetbridge received broken or incompatible weather data", Toast.LENGTH_SHORT, GB.ERROR, e);
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/LineageOsWeatherReceiver.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/LineageOsWeatherReceiver.java
index 09d921bf5b..48263b9b54 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/LineageOsWeatherReceiver.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/LineageOsWeatherReceiver.java
@@ -50,6 +50,7 @@ import lineageos.weather.util.WeatherUtils;
 import nodomain.freeyourgadget.gadgetbridge.BuildConfig;
 import nodomain.freeyourgadget.gadgetbridge.GBApplication;
 import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 import nodomain.freeyourgadget.gadgetbridge.util.PendingIntentUtils;
 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;
@@ -183,8 +184,8 @@ public class LineageOsWeatherReceiver extends BroadcastReceiver implements Linea
             }
             weatherSpec.windDirection = (int) weatherInfo.getWindDirection();
 
-            weatherSpec.currentConditionCode = Weather.mapToOpenWeatherMapCondition(LineageOSToYahooCondition(weatherInfo.getConditionCode()));
-            weatherSpec.currentCondition = Weather.getConditionString(mContext, weatherSpec.currentConditionCode);
+            weatherSpec.currentConditionCode = WeatherMapper.INSTANCE.mapToOpenWeatherMapCondition(LineageOSToYahooCondition(weatherInfo.getConditionCode()));
+            weatherSpec.currentCondition = WeatherMapper.INSTANCE.getConditionString(mContext, weatherSpec.currentConditionCode);
             weatherSpec.currentHumidity = (int) weatherInfo.getHumidity();
 
             weatherSpec.forecasts = new ArrayList<>();
@@ -199,11 +200,11 @@ public class LineageOsWeatherReceiver extends BroadcastReceiver implements Linea
                     gbForecast.maxTemp = (int) cmForecast.getHigh() + 273;
                     gbForecast.minTemp = (int) cmForecast.getLow() + 273;
                 }
-                gbForecast.conditionCode = Weather.mapToOpenWeatherMapCondition(LineageOSToYahooCondition(cmForecast.getConditionCode()));
+                gbForecast.conditionCode = WeatherMapper.INSTANCE.mapToOpenWeatherMapCondition(LineageOSToYahooCondition(cmForecast.getConditionCode()));
                 weatherSpec.forecasts.add(gbForecast);
             }
             ArrayList<WeatherSpec> weatherSpecs = new ArrayList<>(Collections.singletonList(weatherSpec));
-            Weather.getInstance().setWeatherSpec(weatherSpecs);
+            Weather.INSTANCE.setWeatherSpec(weatherSpecs);
             GBApplication.deviceService().onSendWeather(weatherSpecs);
         } else {
             LOG.info("request has returned null for WeatherInfo");
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/OmniJawsObserver.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/OmniJawsObserver.java
index cc11dbaa25..424c7462d1 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/OmniJawsObserver.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/OmniJawsObserver.java
@@ -34,6 +34,7 @@ import java.util.Collections;
 
 import nodomain.freeyourgadget.gadgetbridge.GBApplication;
 import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 
 
@@ -113,8 +114,8 @@ public class OmniJawsObserver extends ContentObserver {
                         if (i == 0) {
 
                             weatherSpec.location = c.getString(0);
-                            weatherSpec.currentConditionCode = Weather.mapToOpenWeatherMapCondition(c.getInt(2));
-                            weatherSpec.currentCondition = Weather.getConditionString(mContext, weatherSpec.currentConditionCode);
+                            weatherSpec.currentConditionCode = WeatherMapper.INSTANCE.mapToOpenWeatherMapCondition(c.getInt(2));
+                            weatherSpec.currentCondition = WeatherMapper.INSTANCE.getConditionString(mContext, weatherSpec.currentConditionCode);
                             //alternatively the following would also be possible
                             //weatherSpec.currentCondition = c.getString(1);
 
@@ -132,14 +133,14 @@ public class OmniJawsObserver extends ContentObserver {
                             WeatherSpec.Daily gbForecast = new WeatherSpec.Daily();
                             gbForecast.minTemp = toKelvin(c.getFloat(5));
                             gbForecast.maxTemp = toKelvin(c.getFloat(6));
-                            gbForecast.conditionCode = Weather.mapToOpenWeatherMapCondition(c.getInt(8));
+                            gbForecast.conditionCode = WeatherMapper.INSTANCE.mapToOpenWeatherMapCondition(c.getInt(8));
                             weatherSpec.forecasts.add(gbForecast);
                         }
                     }
                 }
 
                 ArrayList<WeatherSpec> weatherSpecs = new ArrayList<>(Collections.singletonList(weatherSpec));
-                Weather.getInstance().setWeatherSpec(weatherSpecs);
+                Weather.INSTANCE.setWeatherSpec(weatherSpecs);
                 GBApplication.deviceService().onSendWeather(weatherSpecs);
 
             } finally {
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/TinyWeatherForecastGermanyReceiver.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/TinyWeatherForecastGermanyReceiver.java
index f8f3ab41f0..05d403db3b 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/TinyWeatherForecastGermanyReceiver.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/TinyWeatherForecastGermanyReceiver.java
@@ -43,7 +43,7 @@ public class TinyWeatherForecastGermanyReceiver extends BroadcastReceiver {
                     if (weatherSpec != null) {
                         ArrayList<WeatherSpec> weatherSpecs = new ArrayList<>(Collections.singletonList(weatherSpec));
                         weatherSpec.timestamp = (int) (System.currentTimeMillis() / 1000);
-                        Weather.getInstance().setWeatherSpec(weatherSpecs);
+                        Weather.INSTANCE.setWeatherSpec(weatherSpecs);
                         GBApplication.deviceService().onSendWeather(weatherSpecs);
                     }
                 } catch (Exception e) {
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/WeatherNotificationReceiver.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/WeatherNotificationReceiver.java
index fa49c9ca91..0920f4a72e 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/WeatherNotificationReceiver.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/WeatherNotificationReceiver.java
@@ -50,14 +50,14 @@ public class WeatherNotificationReceiver extends BroadcastReceiver {
         }
 
         if (parcelableWeather2 != null) {
-            Weather weather = Weather.getInstance();
+            Weather weather = Weather.INSTANCE;
             weather.setReconstructedOWMForecast(parcelableWeather2.reconstructedOWMForecast);
 
             WeatherSpec weatherSpec = parcelableWeather2.weatherSpec;
             LOG.info("weather in " + weatherSpec.location + " is " + weatherSpec.currentCondition + " (" + (weatherSpec.currentTemp - 273) + "°C)");
 
             ArrayList<WeatherSpec> weatherSpecs = new ArrayList<>(Collections.singletonList(weatherSpec));
-            Weather.getInstance().setWeatherSpec(weatherSpecs);
+            Weather.INSTANCE.setWeatherSpec(weatherSpecs);
             GBApplication.deviceService().onSendWeather(weatherSpecs);
         }
     }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/Weather.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/Weather.java
deleted file mode 100644
index b37ee00314..0000000000
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/Weather.java
+++ /dev/null
@@ -1,1239 +0,0 @@
-/*  Copyright (C) 2016-2024 Andreas Shimokawa, Daniele Gobbetti, José Rebelo,
-    Petr Vaněk, Sebastian Kranz
-
-    This file is part of Gadgetbridge.
-
-    Gadgetbridge is free software: you can redistribute it and/or modify
-    it under the terms of the GNU Affero General Public License as published
-    by the Free Software Foundation, either version 3 of the License, or
-    (at your option) any later version.
-
-    Gadgetbridge is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU Affero General Public License for more details.
-
-    You should have received a copy of the GNU Affero General Public License
-    along with this program.  If not, see <https://www.gnu.org/licenses/>. */
-package nodomain.freeyourgadget.gadgetbridge.model;
-
-import android.content.Context;
-
-import androidx.annotation.Nullable;
-
-import org.json.JSONArray;
-import org.json.JSONException;
-import org.json.JSONObject;
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.FileOutputStream;
-import java.io.IOException;
-import java.io.ObjectInputStream;
-import java.io.ObjectOutputStream;
-import java.io.ObjectStreamException;
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.List;
-
-import nodomain.freeyourgadget.gadgetbridge.R;
-
-public class Weather {
-    private static final Logger LOG = LoggerFactory.getLogger(Weather.class);
-
-    private final ArrayList<WeatherSpec> weatherSpecs = new ArrayList<>();
-
-    private JSONObject reconstructedOWMForecast = null;
-
-    private File cacheFile;
-
-    private Weather() {
-        // Use getInstance
-    }
-
-    @Nullable
-    public WeatherSpec getWeatherSpec() {
-        if (weatherSpecs.isEmpty()) {
-            return null;
-        }
-
-        return weatherSpecs.get(0);
-    }
-
-    public List<WeatherSpec> getWeatherSpecs() {
-        return weatherSpecs;
-    }
-
-    public void setWeatherSpec(final Collection<WeatherSpec> newWeatherSpecs) {
-        weatherSpecs.clear();
-        weatherSpecs.addAll(newWeatherSpecs);
-        saveToCache();
-    }
-
-    @Nullable
-    public JSONObject createReconstructedOWMWeatherReply() {
-        final WeatherSpec weatherSpec = getWeatherSpec();
-        if (weatherSpec == null) {
-            return null;
-        }
-        JSONObject reconstructedOWMWeather = new JSONObject();
-        JSONArray weather = new JSONArray();
-        JSONObject condition = new JSONObject();
-        JSONObject main = new JSONObject();
-        JSONObject wind = new JSONObject();
-
-        try {
-            condition.put("id", weatherSpec.currentConditionCode);
-            condition.put("main", weatherSpec.currentCondition);
-            condition.put("description", weatherSpec.currentCondition);
-            condition.put("icon", Weather.mapToOpenWeatherMapIcon(weatherSpec.currentConditionCode));
-            weather.put(condition);
-
-
-            main.put("temp", weatherSpec.currentTemp);
-            main.put("humidity", weatherSpec.currentHumidity);
-            main.put("temp_min", weatherSpec.todayMinTemp);
-            main.put("temp_max", weatherSpec.todayMaxTemp);
-
-            wind.put("speed", (weatherSpec.windSpeed / 3.6f)); //meter per second
-            wind.put("deg", weatherSpec.windDirection);
-
-            reconstructedOWMWeather.put("weather", weather);
-            reconstructedOWMWeather.put("main", main);
-            reconstructedOWMWeather.put("name", weatherSpec.location);
-            reconstructedOWMWeather.put("wind", wind);
-
-        } catch (JSONException e) {
-            LOG.error("Error while reconstructing OWM weather reply");
-            return null;
-        }
-        LOG.debug("Weather JSON for WEBVIEW: " + reconstructedOWMWeather.toString());
-        return reconstructedOWMWeather;
-    }
-
-    public JSONObject getReconstructedOWMForecast() {
-        return reconstructedOWMForecast;
-    }
-
-    public void setReconstructedOWMForecast(JSONObject reconstructedOWMForecast) {
-        this.reconstructedOWMForecast = reconstructedOWMForecast;
-    }
-
-    private static final Weather weather = new Weather();
-    public static Weather getInstance() { return weather; }
-
-    public static byte mapToPebbleCondition(int openWeatherMapCondition) {
-/* deducted values:
-    0 = sun + cloud
-    1 = clouds
-    2 = some snow
-    3 = some rain
-    4 = heavy rain
-    5 = heavy snow
-    6 = sun + cloud + rain (default icon?)
-    7 = sun
-    8 = rain + snow
-    9 = 6
-    10, 11, ... = empty icon
- */
-        switch (openWeatherMapCondition) {
-//Group 2xx: Thunderstorm
-            case 200:  //thunderstorm with light rain:  //11d
-            case 201:  //thunderstorm with rain:  //11d
-            case 202:  //thunderstorm with heavy rain:  //11d
-            case 210:  //light thunderstorm::  //11d
-            case 211:  //thunderstorm:  //11d
-            case 230:  //thunderstorm with light drizzle:  //11d
-            case 231:  //thunderstorm with drizzle:  //11d
-            case 232:  //thunderstorm with heavy drizzle:  //11d
-            case 212:  //heavy thunderstorm:  //11d
-            case 221:  //ragged thunderstorm:  //11d
-                return 4;
-//Group 3xx: Drizzle
-            case 300:  //light intensity drizzle:  //09d
-            case 301:  //drizzle:  //09d
-            case 302:  //heavy intensity drizzle:  //09d
-            case 310:  //light intensity drizzle rain:  //09d
-            case 311:  //drizzle rain:  //09d
-            case 312:  //heavy intensity drizzle rain:  //09d
-            case 313:  //shower rain and drizzle:  //09d
-            case 314:  //heavy shower rain and drizzle:  //09d
-            case 321:  //shower drizzle:  //09d
-            case 500:  //light rain:  //10d
-            case 501:  //moderate rain:  //10d
-                return 3;
-//Group 5xx: Rain
-            case 502:  //heavy intensity rain:  //10d
-            case 503:  //very heavy rain:  //10d
-            case 504:  //extreme rain:  //10d
-            case 511:  //freezing rain:  //13d
-            case 520:  //light intensity shower rain:  //09d
-            case 521:  //shower rain:  //09d
-            case 522:  //heavy intensity shower rain:  //09d
-            case 531:  //ragged shower rain:  //09d
-                return 4;
-//Group 6xx: Snow
-            case 600:  //light snow:  //[[file:13d.png]]
-            case 601:  //snow:  //[[file:13d.png]]
-            case 620:  //light shower snow:  //[[file:13d.png]]
-                return 2;
-            case 602:  //heavy snow:  //[[file:13d.png]]
-            case 611:  //sleet:  //[[file:13d.png]]
-            case 612:  //shower sleet:  //[[file:13d.png]]
-            case 621:  //shower snow:  //[[file:13d.png]]
-            case 622:  //heavy shower snow:  //[[file:13d.png]]
-                return 5;
-            case 615:  //light rain and snow:  //[[file:13d.png]]
-            case 616:  //rain and snow:  //[[file:13d.png]]
-                return 8;
-//Group 7xx: Atmosphere
-            case 701:  //mist:  //[[file:50d.png]]
-            case 711:  //smoke:  //[[file:50d.png]]
-            case 721:  //haze:  //[[file:50d.png]]
-            case 731:  //sandcase  dust whirls:  //[[file:50d.png]]
-            case 741:  //fog:  //[[file:50d.png]]
-            case 751:  //sand:  //[[file:50d.png]]
-            case 761:  //dust:  //[[file:50d.png]]
-            case 762:  //volcanic ash:  //[[file:50d.png]]
-            case 771:  //squalls:  //[[file:50d.png]]
-            case 781:  //tornado:  //[[file:50d.png]]
-            case 900:  //tornado
-                return 6;
-//Group 800: Clear
-            case 800:  //clear sky:  //[[file:01d.png]] [[file:01n.png]]
-                return 7;
-//Group 80x: Clouds
-            case 801:  //few clouds:  //[[file:02d.png]] [[file:02n.png]]
-            case 802:  //scattered clouds:  //[[file:03d.png]] [[file:03d.png]]
-            case 803:  //broken clouds:  //[[file:04d.png]] [[file:03d.png]]
-            case 804:  //overcast clouds:  //[[file:04d.png]] [[file:04d.png]]
-                return 0;
-//Group 90x: Extreme
-            case 901:  //tropical storm
-            case 903:  //cold
-            case 904:  //hot
-            case 905:  //windy
-            case 906:  //hail
-//Group 9xx: Additional
-            case 951:  //calm
-            case 952:  //light breeze
-            case 953:  //gentle breeze
-            case 954:  //moderate breeze
-            case 955:  //fresh breeze
-            case 956:  //strong breeze
-            case 957:  //high windcase  near gale
-            case 958:  //gale
-            case 959:  //severe gale
-            case 960:  //storm
-            case 961:  //violent storm
-            case 902:  //hurricane
-            case 962:  //hurricane
-            default:
-                return 6;
-
-        }
-    }
-
-    public static int mapToYahooCondition(int openWeatherMapCondition) {
-        // openweathermap.org conditions:
-        // http://openweathermap.org/weather-conditions
-        switch (openWeatherMapCondition) {
-//Group 2xx: Thunderstorm
-            case 200:  //thunderstorm with light rain:  //11d
-            case 201:  //thunderstorm with rain:  //11d
-            case 202:  //thunderstorm with heavy rain:  //11d
-            case 210:  //light thunderstorm::  //11d
-            case 211:  //thunderstorm:  //11d
-            case 230:  //thunderstorm with light drizzle:  //11d
-            case 231:  //thunderstorm with drizzle:  //11d
-            case 232:  //thunderstorm with heavy drizzle:  //11d
-                return 4;
-            case 212:  //heavy thunderstorm:  //11d
-            case 221:  //ragged thunderstorm:  //11d
-                return 3;
-//Group 3xx: Drizzle
-            case 300:  //light intensity drizzle:  //09d
-            case 301:  //drizzle:  //09d
-            case 302:  //heavy intensity drizzle:  //09d
-            case 310:  //light intensity drizzle rain:  //09d
-            case 311:  //drizzle rain:  //09d
-            case 312:  //heavy intensity drizzle rain:  //09d
-                return 9;
-            case 313:  //shower rain and drizzle:  //09d
-            case 314:  //heavy shower rain and drizzle:  //09d
-            case 321:  //shower drizzle:  //09d
-                return 11;
-//Group 5xx: Rain
-            case 500:  //light rain:  //10d
-            case 501:  //moderate rain:  //10d
-            case 502:  //heavy intensity rain:  //10d
-            case 503:  //very heavy rain:  //10d
-            case 504:  //extreme rain:  //10d
-            case 511:  //freezing rain:  //13d
-                return 10;
-            case 520:  //light intensity shower rain:  //09d
-                return 40;
-            case 521:  //shower rain:  //09d
-            case 522:  //heavy intensity shower rain:  //09d
-            case 531:  //ragged shower rain:  //09d
-                return 12;
-//Group 6xx: Snow
-            case 600:  //light snow:  //[[file:13d.png]]
-                return 7;
-            case 601:  //snow:  //[[file:13d.png]]
-                return 16;
-            case 602:  //heavy snow:  //[[file:13d.png]]
-                return 15;
-            case 611:  //sleet:  //[[file:13d.png]]
-            case 612:  //shower sleet:  //[[file:13d.png]]
-                return 18;
-            case 615:  //light rain and snow:  //[[file:13d.png]]
-            case 616:  //rain and snow:  //[[file:13d.png]]
-                return 5;
-            case 620:  //light shower snow:  //[[file:13d.png]]
-                return 14;
-            case 621:  //shower snow:  //[[file:13d.png]]
-                return 46;
-            case 622:  //heavy shower snow:  //[[file:13d.png]]
-//Group 7xx: Atmosphere
-            case 701:  //mist:  //[[file:50d.png]]
-            case 711:  //smoke:  //[[file:50d.png]]
-                return 22;
-            case 721:  //haze:  //[[file:50d.png]]
-                return 21;
-            case 731:  //sandcase  dust whirls:  //[[file:50d.png]]
-                return 3200;
-            case 741:  //fog:  //[[file:50d.png]]
-                return 20;
-            case 751:  //sand:  //[[file:50d.png]]
-            case 761:  //dust:  //[[file:50d.png]]
-                return 19;
-            case 762:  //volcanic ash:  //[[file:50d.png]]
-            case 771:  //squalls:  //[[file:50d.png]]
-                return 3200;
-            case 781:  //tornado:  //[[file:50d.png]]
-            case 900:  //tornado
-                return 0;
-//Group 800: Clear
-            case 800:  //clear sky:  //[[file:01d.png]] [[file:01n.png]]
-                return 32;
-//Group 80x: Clouds
-            case 801:  //few clouds:  //[[file:02d.png]] [[file:02n.png]]
-            case 802:  //scattered clouds:  //[[file:03d.png]] [[file:03d.png]]
-                return 34;
-            case 803:  //broken clouds:  //[[file:04d.png]] [[file:03d.png]]
-            case 804:  //overcast clouds:  //[[file:04d.png]] [[file:04d.png]]
-                return 44;
-//Group 90x: Extreme
-            case 901:  //tropical storm
-                return 1;
-            case 903:  //cold
-                return 25;
-            case 904:  //hot
-                return 36;
-            case 905:  //windy
-                return 24;
-            case 906:  //hail
-                return 17;
-//Group 9xx: Additional
-            case 951:  //calm
-            case 952:  //light breeze
-            case 953:  //gentle breeze
-            case 954:  //moderate breeze
-            case 955:  //fresh breeze
-                return 34;
-            case 956:  //strong breeze
-            case 957:  //high windcase  near gale
-                return 24;
-            case 958:  //gale
-            case 959:  //severe gale
-            case 960:  //storm
-            case 961:  //violent storm
-                return 3200;
-            case 902:  //hurricane
-            case 962:  //hurricane
-                return 2;
-            default:
-                return 3200;
-
-        }
-    }
-
-    public static String mapToOpenWeatherMapIcon(int openWeatherMapCondition) {
-        //see https://openweathermap.org/weather-conditions
-        String condition = "02d"; //generic "variable" icon
-
-        if (openWeatherMapCondition >= 200 && openWeatherMapCondition < 300) {
-            condition = "11d";
-        } else if (openWeatherMapCondition >= 300 && openWeatherMapCondition < 500) {
-            condition = "09d";
-        } else if (openWeatherMapCondition >= 500 && openWeatherMapCondition < 510) {
-            condition = "10d";
-        } else if (openWeatherMapCondition >= 511 && openWeatherMapCondition < 600) {
-            condition = "09d";
-        } else if (openWeatherMapCondition >= 600 && openWeatherMapCondition < 700) {
-            condition = "13d";
-        } else if (openWeatherMapCondition >= 700 && openWeatherMapCondition < 800) {
-            condition = "50d";
-        } else if (openWeatherMapCondition == 800) {
-            condition = "01d"; //TODO: night?
-        } else if (openWeatherMapCondition == 801) {
-            condition = "02d"; //TODO: night?
-        } else if (openWeatherMapCondition == 802) {
-            condition = "03d"; //TODO: night?
-        } else if (openWeatherMapCondition == 803 || openWeatherMapCondition == 804) {
-            condition = "04d"; //TODO: night?
-        }
-
-        return condition;
-    }
-
-    public static int mapToOpenWeatherMapCondition(int yahooCondition) {
-        switch (yahooCondition) {
-//yahoo weather conditions:
-//https://developer.yahoo.com/weather/documentation.html
-            case 0:  //tornado
-                return 900;
-            case 1:  //tropical storm
-                return 901;
-            case 2:  //hurricane
-                return 962;
-            case 3:  //severe thunderstorms
-                return 212;
-            case 4:  //thunderstorms
-                return 211;
-            case 5:  //mixed rain and snow
-            case 6:  //mixed rain and sleet
-                return 616;
-            case 7:  //mixed snow and sleet
-                return 600;
-            case 8:  //freezing drizzle
-            case 9:  //drizzle
-                return 301;
-            case 10:  //freezing rain
-                return 511;
-            case 11:  //showers
-            case 12:  //showers
-                return 521;
-            case 13:  //snow flurries
-            case 14:  //light snow showers
-                return 620;
-            case 15:  //blowing snow
-            case 41:  //heavy snow
-            case 42:  //scattered snow showers
-            case 43:  //heavy snow
-            case 46:  //snow showers
-                return 602;
-            case 16:  //snow
-                return 601;
-            case 17:  //hail
-            case 35:  //mixed rain and hail
-                return 906;
-            case 18:  //sleet
-                return 611;
-            case 19:  //dust
-                return 761;
-            case 20:  //foggy
-                return 741;
-            case 21:  //haze
-                return 721;
-            case 22:  //smoky
-                return 711;
-            case 23:  //blustery
-            case 24:  //windy
-                return 905;
-            case 25:  //cold
-                return 903;
-            case 26:  //cloudy
-            case 27:  //mostly cloudy (night)
-            case 28:  //mostly cloudy (day)
-                return 804;
-            case 29:  //partly cloudy (night)
-            case 30:  //partly cloudy (day)
-                return 801;
-            case 31:  //clear (night)
-            case 32:  //sunny
-                return 800;
-            case 33:  //fair (night)
-            case 34:  //fair (day)
-                return 801;
-            case 36:  //hot
-                return 904;
-            case 37:  //isolated thunderstorms
-            case 38:  //scattered thunderstorms
-            case 39:  //scattered thunderstorms
-                return 210;
-            case 40:  //scattered showers
-                return 520;
-            case 44:  //partly cloudy
-                return 801;
-            case 45:  //thundershowers
-            case 47:  //isolated thundershowers
-                return 211;
-            case 3200:  //not available
-            default:
-                return -1;
-        }
-    }
-
-    public static String getConditionString(final Context context, int openWeatherMapCondition) {
-        switch (openWeatherMapCondition) {
-            case 200:
-                return context.getString(R.string.weather_condition_thunderstorm_with_light_rain);
-            case 201:
-                return context.getString(R.string.weather_condition_thunderstorm_with_rain);
-            case 202:
-                return context.getString(R.string.weather_condition_thunderstorm_with_heavy_rain);
-            case 210:
-                return context.getString(R.string.weather_condition_light_thunderstorm);
-            case 211:
-                return context.getString(R.string.weather_condition_thunderstorm);
-            case 230:
-                return context.getString(R.string.weather_condition_thunderstorm_with_light_drizzle);
-            case 231:
-                return context.getString(R.string.weather_condition_thunderstorm_with_drizzle);
-            case 232:
-                return context.getString(R.string.weather_condition_thunderstorm_with_heavy_drizzle);
-            case 212:
-                return context.getString(R.string.weather_condition_heavy_thunderstorm);
-            case 221:
-                return context.getString(R.string.weather_condition_ragged_thunderstorm);
-            // Group 3xx: Drizzle
-            case 300:
-                return context.getString(R.string.weather_condition_light_intensity_drizzle);
-            case 301:
-                return context.getString(R.string.weather_condition_drizzle);
-            case 302:
-                return context.getString(R.string.weather_condition_heavy_intensity_drizzle);
-            case 310:
-                return context.getString(R.string.weather_condition_light_intensity_drizzle_rain);
-            case 311:
-                return context.getString(R.string.weather_condition_drizzle_rain);
-            case 312:
-                return context.getString(R.string.weather_condition_heavy_intensity_drizzle_rain);
-            case 313:
-                return context.getString(R.string.weather_condition_shower_rain_and_drizzle);
-            case 314:
-                return context.getString(R.string.weather_condition_heavy_shower_rain_and_drizzle);
-            case 321:
-                return context.getString(R.string.weather_condition_shower_drizzle);
-            // Group 5xx: Rain
-            case 500:
-                return context.getString(R.string.weather_condition_light_rain);
-            case 501:
-                return context.getString(R.string.weather_condition_moderate_rain);
-            case 502:
-                return context.getString(R.string.weather_condition_heavy_intensity_rain);
-            case 503:
-                return context.getString(R.string.weather_condition_very_heavy_rain);
-            case 504:
-                return context.getString(R.string.weather_condition_extreme_rain);
-            case 511:
-                return context.getString(R.string.weather_condition_freezing_rain);
-            case 520:
-                return context.getString(R.string.weather_condition_light_intensity_shower_rain);
-            case 521:
-                return context.getString(R.string.weather_condition_shower_rain);
-            case 522:
-                return context.getString(R.string.weather_condition_heavy_intensity_shower_rain);
-            case 531:
-                return context.getString(R.string.weather_condition_ragged_shower_rain);
-            // Group 6xx: Snow
-            case 600:
-                return context.getString(R.string.weather_condition_light_snow);
-            case 601:
-                return context.getString(R.string.weather_condition_snow);
-            case 620:
-                return context.getString(R.string.weather_condition_light_shower_snow);
-            case 602:
-                return context.getString(R.string.weather_condition_heavy_snow);
-            case 611:
-                return context.getString(R.string.weather_condition_sleet);
-            case 612:
-                return context.getString(R.string.weather_condition_shower_sleet);
-            case 621:
-                return context.getString(R.string.weather_condition_shower_snow);
-            case 622:
-                return context.getString(R.string.weather_condition_heavy_shower_snow);
-            case 615:
-                return context.getString(R.string.weather_condition_light_rain_and_snow);
-            case 616:
-                return context.getString(R.string.weather_condition_rain_and_snow);
-            // Group 7xx: Atmosphere
-            case 701:
-                return context.getString(R.string.weather_condition_mist);
-            case 711:
-                return context.getString(R.string.weather_condition_smoke);
-            case 721:
-                return context.getString(R.string.weather_condition_haze);
-            case 731:
-                return context.getString(R.string.weather_condition_sandcase_dust_whirls);
-            case 741:
-                return context.getString(R.string.weather_condition_fog);
-            case 751:
-                return context.getString(R.string.weather_condition_sand);
-            case 761:
-                return context.getString(R.string.weather_condition_dust);
-            case 762:
-                return context.getString(R.string.weather_condition_volcanic_ash);
-            case 771:
-                return context.getString(R.string.weather_condition_squalls);
-            case 781:
-                return context.getString(R.string.weather_condition_tornado);
-            case 900:
-                return context.getString(R.string.weather_condition_tornado);
-            case 800:
-                return context.getString(R.string.weather_condition_clear_sky);
-            // Group 80x: Clouds
-            case 801:
-                return context.getString(R.string.weather_condition_few_clouds);
-            case 802:
-                return context.getString(R.string.weather_condition_scattered_clouds);
-            case 803:
-                return context.getString(R.string.weather_condition_broken_clouds);
-            case 804:
-                return context.getString(R.string.weather_condition_overcast_clouds);
-            // Group 90x: Extreme
-            case 901:
-                return context.getString(R.string.weather_condition_tropical_storm);
-            case 903:
-                return context.getString(R.string.weather_condition_cold);
-            case 904:
-                return context.getString(R.string.weather_condition_hot);
-            case 905:
-                return context.getString(R.string.weather_condition_windy);
-            case 906:
-                return context.getString(R.string.weather_condition_hail);
-            // Group 9xx: Additional
-            case 951:
-                return context.getString(R.string.weather_condition_calm);
-            case 952:
-                return context.getString(R.string.weather_condition_light_breeze);
-            case 953:
-                return context.getString(R.string.weather_condition_gentle_breeze);
-            case 954:
-                return context.getString(R.string.weather_condition_moderate_breeze);
-            case 955:
-                return context.getString(R.string.weather_condition_fresh_breeze);
-            case 956:
-                return context.getString(R.string.weather_condition_strong_breeze);
-            case 957:
-                return context.getString(R.string.weather_condition_high_windcase_near_gale);
-            case 958:
-                return context.getString(R.string.weather_condition_gale);
-            case 959:
-                return context.getString(R.string.weather_condition_severe_gale);
-            case 960:
-                return context.getString(R.string.weather_condition_storm);
-            case 961:
-                return context.getString(R.string.weather_condition_violent_storm);
-            case 902:
-                return context.getString(R.string.weather_condition_hurricane);
-            case 962:
-                return context.getString(R.string.weather_condition_hurricane);
-            default:
-                return "";
-        }
-    }
-
-    public static String getAqiLevelString(final Context context, int aqi) {
-        // Uses the [2023 Plume index](https://plumelabs.files.wordpress.com/2023/06/plume_aqi_2023.pdf) as a reference
-        if (aqi < 0) {
-            return context.getString(R.string.aqi_level_unknown);
-        }
-        if (aqi < 20) {
-            return context.getString(R.string.aqi_level_excellent);
-        } else if (aqi < 50) {
-            return context.getString(R.string.aqi_level_fair);
-        } else if (aqi < 100) {
-            return context.getString(R.string.aqi_level_poor);
-        } else if (aqi < 150) {
-            return context.getString(R.string.aqi_level_unhealthy);
-        } else if (aqi < 250) {
-            return context.getString(R.string.aqi_level_very_unhealthy);
-        } else {
-            return context.getString(R.string.aqi_level_dangerous);
-        }
-    }
-
-    public static byte mapToZeTimeConditionOld(int openWeatherMapCondition) {
-/* deducted values:
-    0 = partly cloudy
-    1 = cloudy
-    2 = sunny
-    3 = windy/gale
-    4 = heavy rain
-    5 = snowy
-    6 = storm
- */
-        switch (openWeatherMapCondition) {
-//Group 2xx: Thunderstorm
-            case 200:  //thunderstorm with light rain:  //11d
-            case 201:  //thunderstorm with rain:  //11d
-            case 202:  //thunderstorm with heavy rain:  //11d
-            case 210:  //light thunderstorm::  //11d
-            case 211:  //thunderstorm:  //11d
-            case 230:  //thunderstorm with light drizzle:  //11d
-            case 231:  //thunderstorm with drizzle:  //11d
-            case 232:  //thunderstorm with heavy drizzle:  //11d
-            case 212:  //heavy thunderstorm:  //11d
-            case 221:  //ragged thunderstorm:  //11d
-//Group 7xx: Atmosphere
-            case 771:  //squalls:  //[[file:50d.png]]
-            case 781:  //tornado:  //[[file:50d.png]]
-//Group 90x: Extreme
-            case 900:  //tornado
-            case 901:  //tropical storm
-//Group 9xx: Additional
-            case 960:  //storm
-            case 961:  //violent storm
-            case 902:  //hurricane
-            case 962:  //hurricane
-                return 6;
-//Group 3xx: Drizzle
-            case 300:  //light intensity drizzle:  //09d
-            case 301:  //drizzle:  //09d
-            case 302:  //heavy intensity drizzle:  //09d
-            case 310:  //light intensity drizzle rain:  //09d
-            case 311:  //drizzle rain:  //09d
-            case 312:  //heavy intensity drizzle rain:  //09d
-            case 313:  //shower rain and drizzle:  //09d
-            case 314:  //heavy shower rain and drizzle:  //09d
-            case 321:  //shower drizzle:  //09d
-//Group 5xx: Rain
-            case 500:  //light rain:  //10d
-            case 501:  //moderate rain:  //10d
-            case 502:  //heavy intensity rain:  //10d
-            case 503:  //very heavy rain:  //10d
-            case 504:  //extreme rain:  //10d
-            case 511:  //freezing rain:  //13d
-            case 520:  //light intensity shower rain:  //09d
-            case 521:  //shower rain:  //09d
-            case 522:  //heavy intensity shower rain:  //09d
-            case 531:  //ragged shower rain:  //09d
-//Group 90x: Extreme
-            case 906:  //hail
-                return 4;
-//Group 6xx: Snow
-            case 600:  //light snow:  //[[file:13d.png]]
-            case 601:  //snow:  //[[file:13d.png]]
-            case 620:  //light shower snow:  //[[file:13d.png]]
-            case 602:  //heavy snow:  //[[file:13d.png]]
-            case 611:  //sleet:  //[[file:13d.png]]
-            case 612:  //shower sleet:  //[[file:13d.png]]
-            case 621:  //shower snow:  //[[file:13d.png]]
-            case 622:  //heavy shower snow:  //[[file:13d.png]]
-            case 615:  //light rain and snow:  //[[file:13d.png]]
-            case 616:  //rain and snow:  //[[file:13d.png]]
-//Group 90x: Extreme
-            case 903:  //cold
-                return 5;
-//Group 7xx: Atmosphere
-            case 701:  //mist:  //[[file:50d.png]]
-            case 711:  //smoke:  //[[file:50d.png]]
-            case 721:  //haze:  //[[file:50d.png]]
-            case 731:  //sandcase  dust whirls:  //[[file:50d.png]]
-            case 741:  //fog:  //[[file:50d.png]]
-            case 751:  //sand:  //[[file:50d.png]]
-            case 761:  //dust:  //[[file:50d.png]]
-            case 762:  //volcanic ash:  //[[file:50d.png]]
-                return 1;
-//Group 800: Clear
-            case 800:  //clear sky:  //[[file:01d.png]] [[file:01n.png]]
-//Group 90x: Extreme
-            case 904:  //hot
-                return 2;
-//Group 80x: Clouds
-            case 801:  //few clouds:  //[[file:02d.png]] [[file:02n.png]]
-            case 802:  //scattered clouds:  //[[file:03d.png]] [[file:03d.png]]
-            case 803:  //broken clouds:  //[[file:04d.png]] [[file:03d.png]]
-            case 804:  //overcast clouds:  //[[file:04d.png]] [[file:04d.png]]
-            default:
-                return 0;
-
-//Group 9xx: Additional
-            case 905:  //windy
-            case 951:  //calm
-            case 952:  //light breeze
-            case 953:  //gentle breeze
-            case 954:  //moderate breeze
-            case 955:  //fresh breeze
-            case 956:  //strong breeze
-            case 957:  //high windcase  near gale
-            case 958:  //gale
-            case 959:  //severe gale
-                return 3;
-        }
-    }
-
-    public static byte mapToZeTimeCondition(int openWeatherMapCondition) {
-/* deducted values:
-    0 = tornado
-    1 = typhoon
-    2 = hurricane
-    3 = thunderstorm
-    4 = rain and snow
-    5 = unavailable
-    6 = freezing rain
-    7 = drizzle
-    8 = showers
-    9 = snow flurries
-    10 = blowing snow
-    11 = snow
-    12 = sleet
-    13 = foggy
-    14 = windy
-    15 = cloudy
-    16 = partly cloudy (night)
-    17 = partly cloudy (day)
-    18 = clear night
-    19 = sunny
-    20 = thundershower
-    21 = hot
-    22 = scattered thunders
-    23 = snow showers
-    24 = heavy snow
- */
-        switch (openWeatherMapCondition) {
-//Group 2xx: Thunderstorm
-            case 210:  //light thunderstorm::  //11d
-                return 22;
-
-//Group 2xx: Thunderstorm
-            case 200:  //thunderstorm with light rain:  //11d
-            case 201:  //thunderstorm with rain:  //11d
-            case 202:  //thunderstorm with heavy rain:  //11d
-            case 230:  //thunderstorm with light drizzle:  //11d
-            case 231:  //thunderstorm with drizzle:  //11d
-            case 232:  //thunderstorm with heavy drizzle:  //11d
-                return 20;
-
-//Group 2xx: Thunderstorm
-            case 211:  //thunderstorm:  //11d
-            case 212:  //heavy thunderstorm:  //11d
-            case 221:  //ragged thunderstorm:  //11d
-                return 3;
-
-//Group 7xx: Atmosphere
-            case 781:  //tornado:  //[[file:50d.png]]
-//Group 90x: Extreme
-            case 900:  //tornado
-                return 0;
-
-//Group 90x: Extreme
-            case 901:  //tropical storm
-                return 1;
-
-// Group 7xx: Atmosphere
-            case 771:  //squalls:  //[[file:50d.png]]
-//Group 9xx: Additional
-            case 960:  //storm
-            case 961:  //violent storm
-            case 902:  //hurricane
-            case 962:  //hurricane
-                return 2;
-
-//Group 3xx: Drizzle
-            case 300:  //light intensity drizzle:  //09d
-            case 301:  //drizzle:  //09d
-            case 302:  //heavy intensity drizzle:  //09d
-            case 310:  //light intensity drizzle rain:  //09d
-            case 311:  //drizzle rain:  //09d
-            case 312:  //heavy intensity drizzle rain:  //09d
-            case 313:  //shower rain and drizzle:  //09d
-            case 314:  //heavy shower rain and drizzle:  //09d
-            case 321:  //shower drizzle:  //09d
-                return 7;
-
-//Group 5xx: Rain
-            case 500:  //light rain:  //10d
-            case 501:  //moderate rain:  //10d
-            case 502:  //heavy intensity rain:  //10d
-            case 503:  //very heavy rain:  //10d
-            case 504:  //extreme rain:  //10d
-            case 520:  //light intensity shower rain:  //09d
-            case 521:  //shower rain:  //09d
-            case 522:  //heavy intensity shower rain:  //09d
-            case 531:  //ragged shower rain:  //09d
-//Group 90x: Extreme
-            case 906:  //hail
-                return 8;
-
-//Group 5xx: Rain
-            case 511:  //freezing rain:  //13d
-                return 6;
-
-//Group 6xx: Snow
-            case 620:  //light shower snow:  //[[file:13d.png]]
-            case 621:  //shower snow:  //[[file:13d.png]]
-            case 622:  //heavy shower snow:  //[[file:13d.png]]
-                return 23;
-
-//Group 6xx: Snow
-            case 615:  //light rain and snow:  //[[file:13d.png]]
-            case 616:  //rain and snow:  //[[file:13d.png]]
-                return 4;
-
-//Group 6xx: Snow
-            case 611:  //sleet:  //[[file:13d.png]]
-            case 612:  //shower sleet:  //[[file:13d.png]]
-                return 12;
-
-//Group 6xx: Snow
-            case 600:  //light snow:  //[[file:13d.png]]
-            case 601:  //snow:  //[[file:13d.png]]
-                return 11;
-//Group 6xx: Snow
-            case 602:  //heavy snow:  //[[file:13d.png]]
-                return 24;
-
-//Group 7xx: Atmosphere
-            case 701:  //mist:  //[[file:50d.png]]
-            case 711:  //smoke:  //[[file:50d.png]]
-            case 721:  //haze:  //[[file:50d.png]]
-            case 731:  //sandcase  dust whirls:  //[[file:50d.png]]
-            case 741:  //fog:  //[[file:50d.png]]
-            case 751:  //sand:  //[[file:50d.png]]
-            case 761:  //dust:  //[[file:50d.png]]
-            case 762:  //volcanic ash:  //[[file:50d.png]]
-                return 13;
-
-//Group 800: Clear
-            case 800:  //clear sky:  //[[file:01d.png]] [[file:01n.png]]
-                return 19;
-
-//Group 90x: Extreme
-            case 904:  //hot
-                return 21;
-
-//Group 80x: Clouds
-            case 801:  //few clouds:  //[[file:02d.png]] [[file:02n.png]]
-            case 802:  //scattered clouds:  //[[file:03d.png]] [[file:03d.png]]
-            case 803:  //broken clouds:  //[[file:04d.png]] [[file:03d.png]]
-                return 17;
-
-//Group 80x: Clouds
-            case 804:  //overcast clouds:  //[[file:04d.png]] [[file:04d.png]]
-                return 15;
-
-//Group 9xx: Additional
-            case 905:  //windy
-            case 951:  //calm
-            case 952:  //light breeze
-            case 953:  //gentle breeze
-            case 954:  //moderate breeze
-            case 955:  //fresh breeze
-            case 956:  //strong breeze
-            case 957:  //high windcase  near gale
-            case 958:  //gale
-            case 959:  //severe gale
-                return 14;
-
-            default:
-//Group 90x: Extreme
-            case 903:  //cold
-                return 5;
-        }
-    }
-    public static byte mapToCmfCondition(int openWeatherMapCondition) {
-/* deducted values:
-    1 = sunny
-    2 = cloudy
-    3 = overcast
-    4 = showers
-    5 = snow showers
-    6 = fog
-
-    9 = thunder showers
-
-    14 = sleet
-
-    19 = hot (extreme)
-    20 = cold (extreme)
-
-    21 = strong wind
-    22 = (night) sunny - with moon
-    23 = (night) sunny with stars
-    24 = (night) cloudy - with moon
-    25 = sun with haze
-    26 = cloudy (sun with cloud)
- */
-        switch (openWeatherMapCondition) {
-//Group 2xx: Thunderstorm
-            case 210:  //light thunderstorm::  //11d
-            case 200:  //thunderstorm with light rain:  //11d
-            case 201:  //thunderstorm with rain:  //11d
-            case 202:  //thunderstorm with heavy rain:  //11d
-            case 230:  //thunderstorm with light drizzle:  //11d
-            case 231:  //thunderstorm with drizzle:  //11d
-            case 232:  //thunderstorm with heavy drizzle:  //11d
-            case 211:  //thunderstorm:  //11d
-            case 212:  //heavy thunderstorm:  //11d
-            case 221:  //ragged thunderstorm:  //11d
-                return 9;
-
-//Group 90x: Extreme
-            case 901:  //tropical storm
-//Group 7xx: Atmosphere
-            case 781:  //tornado:  //[[file:50d.png]]
-//Group 90x: Extreme
-            case 900:  //tornado
-// Group 7xx: Atmosphere
-            case 771:  //squalls:  //[[file:50d.png]]
-//Group 9xx: Additional
-            case 960:  //storm
-            case 961:  //violent storm
-            case 902:  //hurricane
-            case 962:  //hurricane
-                return 21;
-
-//Group 3xx: Drizzle
-            case 300:  //light intensity drizzle:  //09d
-            case 301:  //drizzle:  //09d
-            case 302:  //heavy intensity drizzle:  //09d
-            case 310:  //light intensity drizzle rain:  //09d
-            case 311:  //drizzle rain:  //09d
-            case 312:  //heavy intensity drizzle rain:  //09d
-            case 313:  //shower rain and drizzle:  //09d
-            case 314:  //heavy shower rain and drizzle:  //09d
-            case 321:  //shower drizzle:  //09d
-//Group 5xx: Rain
-            case 500:  //light rain:  //10d
-            case 501:  //moderate rain:  //10d
-            case 502:  //heavy intensity rain:  //10d
-            case 503:  //very heavy rain:  //10d
-            case 504:  //extreme rain:  //10d
-            case 520:  //light intensity shower rain:  //09d
-            case 521:  //shower rain:  //09d
-            case 522:  //heavy intensity shower rain:  //09d
-            case 531:  //ragged shower rain:  //09d
-                return 4;
-
-//Group 90x: Extreme
-            case 906:  //hail
-            case 615:  //light rain and snow:  //[[file:13d.png]]
-            case 616:  //rain and snow:  //[[file:13d.png]]
-            case 511:  //freezing rain:  //13d
-                return 14;
-
-//Group 6xx: Snow
-            case 611:  //sleet:  //[[file:13d.png]]
-            case 612:  //shower sleet:  //[[file:13d.png]]
-//Group 6xx: Snow
-            case 600:  //light snow:  //[[file:13d.png]]
-            case 601:  //snow:  //[[file:13d.png]]
-//Group 6xx: Snow
-            case 602:  //heavy snow:  //[[file:13d.png]]
-//Group 6xx: Snow
-            case 620:  //light shower snow:  //[[file:13d.png]]
-            case 621:  //shower snow:  //[[file:13d.png]]
-            case 622:  //heavy shower snow:  //[[file:13d.png]]
-                return 5;
-
-
-//Group 7xx: Atmosphere
-            case 701:  //mist:  //[[file:50d.png]]
-            case 711:  //smoke:  //[[file:50d.png]]
-            case 721:  //haze:  //[[file:50d.png]]
-            case 731:  //sandcase  dust whirls:  //[[file:50d.png]]
-            case 741:  //fog:  //[[file:50d.png]]
-            case 751:  //sand:  //[[file:50d.png]]
-            case 761:  //dust:  //[[file:50d.png]]
-            case 762:  //volcanic ash:  //[[file:50d.png]]
-                return 6;
-
-//Group 800: Clear
-            case 800:  //clear sky:  //[[file:01d.png]] [[file:01n.png]]
-                return 1;
-
-//Group 90x: Extreme
-            case 904:  //hot
-                return 19;
-
-//Group 80x: Clouds
-            case 801:  //few clouds:  //[[file:02d.png]] [[file:02n.png]]
-            case 802:  //scattered clouds:  //[[file:03d.png]] [[file:03d.png]]
-                return 26;
-            case 803:  //broken clouds:  //[[file:04d.png]] [[file:03d.png]]
-                return 2;
-
-//Group 80x: Clouds
-            case 804:  //overcast clouds:  //[[file:04d.png]] [[file:04d.png]]
-                return 3;
-
-//Group 9xx: Additional
-            case 905:  //windy
-            case 951:  //calm
-            case 952:  //light breeze
-            case 953:  //gentle breeze
-            case 954:  //moderate breeze
-            case 955:  //fresh breeze
-            case 956:  //strong breeze
-            case 957:  //high windcase  near gale
-            case 958:  //gale
-            case 959:  //severe gale
-                return 21;
-
-            default:
-//Group 90x: Extreme
-            case 903:  //cold
-                return 20;
-        }
-    }
-
-    public static byte mapToFitProCondition(int openWeatherMapCondition) {
-        switch (openWeatherMapCondition) {
-            case 100:
-                return 1;
-            case 104:
-                return 2;
-            case 101:
-            case 102:
-            case 103:
-                return 3;
-            case 305:
-            case 309:
-                return 4;
-            case 306:
-            case 314:
-            case 399:
-                return 5;
-            case 307:
-            case 308:
-            case 310:
-            case 311:
-            case 312:
-            case 315:
-            case 316:
-            case 317:
-            case 318:
-                return 6;
-            case 300:
-            case 301:
-            case 302:
-            case 303:
-                return 7;
-            case 400:
-            case 407:
-                return 8;
-            case 401:
-            case 408:
-            case 499:
-                return 9;
-            case 402:
-            case 403:
-            case 409:
-            case 410:
-                return 10;
-            case 404:
-            case 405:
-            case 406:
-                return 11;
-            case 500:
-            case 501:
-            case 502:
-            case 509:
-            case 510:
-            case 511:
-            case 512:
-            case 513:
-            case 514:
-            case 515:
-                return 12;
-            case 304:
-            case 313:
-                return 13;
-            case 503:
-            case 504:
-            case 507:
-            case 508:
-                return 14;
-            case 200:
-            case 201:
-            case 202:
-            case 203:
-            case 204:
-                return 15;
-            case 205:
-            case 206:
-            case 207:
-            case 208:
-                return 16;
-            case 209:
-            case 210:
-            case 211:
-                return 17;
-            case 212:
-                return 18;
-            case 231:
-                return 19;
-            default:
-                return 3;
-        }
-    }
-
-    /**
-     * Set the weather cache file. If enabled and the current weather is null, load the cache file.
-     *
-     * @param cacheDir the cache directory, where the cache file will be created
-     * @param enabled whether caching is enabled
-     */
-    public void setCacheFile(final File cacheDir, final boolean enabled) {
-        // FIXME: Do not use serializable for this
-
-        cacheFile = new File(cacheDir, "weatherCache.bin");
-
-        if (enabled) {
-            LOG.info("Setting weather cache file to {}", cacheFile.getPath());
-
-            if (cacheFile.isFile() && weatherSpecs.isEmpty()) {
-                try (final ObjectInputStream o = new ObjectInputStream(new FileInputStream(cacheFile))) {
-                    final ArrayList<WeatherSpec> cachedSpecs = (ArrayList<WeatherSpec>) o.readObject();
-                    weatherSpecs.addAll(cachedSpecs);
-                } catch (final ObjectStreamException e) {
-                    LOG.error("Failed to deserialize weather from cache", e);
-                    // keep cacheFile set - it's most likely an older version
-                } catch (final IOException e) {
-                    LOG.error("Failed to read weather cache file", e);
-                    // Something is wrong with the file
-                    cacheFile = null;
-                } catch (final Throwable e) {
-                    LOG.error("Failed to read weather from cache", e);
-                    // keep cacheFile set - it's most likely an older version
-                }
-            } else if (!weatherSpecs.isEmpty()) {
-                saveToCache();
-            }
-        } else {
-            if (cacheFile.isFile()) {
-                LOG.info("Deleting weather cache file {}", cacheFile.getPath());
-
-                try {
-                    cacheFile.delete();
-                } catch (final Throwable e) {
-                    LOG.error("Failed to delete cache file", e);
-                    cacheFile = null;
-                }
-            }
-        }
-    }
-
-    /**
-     * Save the current weather to cache, if a cache file is enabled and the weather is not null.
-     */
-    public void saveToCache() {
-        if (weatherSpecs.isEmpty() || cacheFile == null) {
-            return;
-        }
-
-        LOG.info("Loading weather from cache {}", cacheFile.getPath());
-
-        try (ObjectOutputStream o = new ObjectOutputStream(new FileOutputStream(cacheFile))) {
-            o.writeObject(weatherSpecs);
-        } catch (final Throwable e) {
-            LOG.error("Failed to save weather to cache", e);
-        }
-    }
-}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/Weather.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/Weather.kt
new file mode 100644
index 0000000000..4e8244ff4f
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/Weather.kt
@@ -0,0 +1,79 @@
+package nodomain.freeyourgadget.gadgetbridge.model
+
+import org.json.JSONArray
+import org.json.JSONException
+import org.json.JSONObject
+import org.slf4j.LoggerFactory
+import java.util.concurrent.CopyOnWriteArrayList
+
+object Weather {
+    private val LOG = LoggerFactory.getLogger("Weather")
+
+    private val weatherSpecs = CopyOnWriteArrayList<WeatherSpec>()
+    private var reconstructedOWMForecast: JSONObject? = null
+
+    private var cacheManager: WeatherCacheManager? = null
+
+    fun setWeatherSpec(newSpecs: Collection<WeatherSpec>) {
+        weatherSpecs.apply {
+            clear()
+            addAll(newSpecs)
+        }
+        cacheManager?.save(weatherSpecs)
+    }
+
+    fun getWeatherSpec(): WeatherSpec? = weatherSpecs.firstOrNull()
+
+    fun getWeatherSpecs(): List<WeatherSpec> = weatherSpecs
+
+    fun createReconstructedOWMWeatherReply(): JSONObject? {
+        val spec = getWeatherSpec() ?: return null
+
+        return try {
+            JSONObject().apply {
+                put("weather", JSONArray().apply {
+                    put(JSONObject().apply {
+                        put("id", spec.currentConditionCode)
+                        put("main", spec.currentCondition)
+                        put("description", spec.currentCondition)
+                        put("icon", WeatherMapper.mapToOpenWeatherMapIcon(spec.currentConditionCode))
+                    })
+                })
+
+                put("main", JSONObject().apply {
+                    put("temp", spec.currentTemp)
+                    put("humidity", spec.currentHumidity)
+                    put("temp_min", spec.todayMinTemp)
+                    put("temp_max", spec.todayMaxTemp)
+                })
+
+                put("wind", JSONObject().apply {
+                    put("speed", spec.windSpeed / 3.6f)
+                    put("deg", spec.windDirection)
+                })
+
+                put("name", spec.location)
+            }.also {
+                LOG.debug("Weather JSON for WEBVIEW: {}", it)
+            }
+        } catch (e: JSONException) {
+            LOG.error("Error while reconstructing OWM weather reply", e)
+            null
+        }
+    }
+
+    fun getReconstructedOWMForecast(): JSONObject? = reconstructedOWMForecast
+
+    fun setReconstructedOWMForecast(value: JSONObject?) {
+        reconstructedOWMForecast = value
+    }
+
+    fun initializeCache(cacheManager: WeatherCacheManager) {
+        this.cacheManager = cacheManager
+
+        cacheManager.load { loadedSpecs ->
+            weatherSpecs.clear()
+            weatherSpecs.addAll(loadedSpecs)
+        }
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherCacheManager.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherCacheManager.kt
new file mode 100644
index 0000000000..d86c4b1dd6
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherCacheManager.kt
@@ -0,0 +1,59 @@
+package nodomain.freeyourgadget.gadgetbridge.model
+
+import kotlinx.coroutines.*
+import org.slf4j.LoggerFactory
+import java.io.*
+
+class WeatherCacheManager(
+    cacheDir: File,
+    private val useCache: Boolean
+) {
+    private val LOG = LoggerFactory.getLogger("WeatherCacheManager")
+    private val cacheFile = File(cacheDir, "weatherCache.bin")
+
+
+    fun load(onLoaded: (List<WeatherSpec>) -> Unit) {
+        if (!useCache || !cacheFile.exists()) return
+
+        CoroutineScope(Dispatchers.IO).launch {
+            try {
+                ObjectInputStream(FileInputStream(cacheFile)).use { input ->
+                    val specs = input.readObject() as? ArrayList<WeatherSpec>
+                    specs?.let { onLoaded(it) }
+                    LOG.info("Loaded ${specs?.size ?: 0} weather specs from cache")
+                }
+            } catch (e: Exception) {
+                LOG.error("Failed to load weather cache", e)
+            }
+        }
+    }
+
+    fun save(specs: List<WeatherSpec>) {
+        if (!useCache || specs.isEmpty()) return
+
+        CoroutineScope(Dispatchers.IO).launch {
+            try {
+                ObjectOutputStream(FileOutputStream(cacheFile)).use { output ->
+                    output.writeObject(ArrayList(specs))
+                }
+                LOG.info("Saved weather specs to cache: ${cacheFile.path}")
+            } catch (e: Exception) {
+                LOG.error("Failed to save weather cache", e)
+            }
+        }
+    }
+
+    fun clear() {
+        if (cacheFile.exists()) {
+            try {
+                if (cacheFile.delete()) {
+                    LOG.info("Deleted cache file: ${cacheFile.path}")
+                } else {
+                    LOG.warn("Failed to delete cache file: ${cacheFile.path}")
+                }
+            } catch (e: Exception) {
+                LOG.error("Error deleting cache file", e)
+            }
+        }
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherMapper.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherMapper.kt
new file mode 100644
index 0000000000..0422f1b4ff
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherMapper.kt
@@ -0,0 +1,404 @@
+package nodomain.freeyourgadget.gadgetbridge.model
+
+import android.content.Context
+import nodomain.freeyourgadget.gadgetbridge.R
+
+object WeatherMapper {
+
+    fun mapToOpenWeatherMapIcon(code: Int): String = when {
+        //see https://openweathermap.org/weather-conditions
+        code in 200..299 -> "11d"
+        code in 300..499 -> "09d"
+        code in 500..509 -> "10d"
+        code in 511..599 -> "09d"
+        code in 600..699 -> "13d"
+        code in 700..799 -> "50d"
+        code == 800 -> "01d" //TODO: night?
+        code == 801 -> "02d" //TODO: night?
+        code == 802 -> "03d" //TODO: night?
+        code == 803 || code == 804 -> "04d" //TODO: night?
+        else -> "02d" // fallback
+    }
+
+    fun mapToOpenWeatherMapCondition(yahooCondition: Int): Int {
+        //yahoo weather conditions:
+//https://developer.yahoo.com/weather/documentation.html
+        return when (yahooCondition) {
+            0 -> 900
+            1 -> 901
+            2 -> 962
+            3 -> 212
+            4 -> 211
+            5, 6 -> 616
+            7 -> 600
+            8, 9 -> 301
+            10 -> 511
+            11, 12 -> 521
+            13, 14 -> 620
+            15, 41, 42, 43, 46 -> 602
+            16 -> 601
+            17, 35 -> 906
+            18 -> 611
+            19 -> 761
+            20 -> 741
+            21 -> 721
+            22 -> 711
+            23, 24 -> 905
+            25 -> 903
+            26, 27, 28 -> 804
+            29, 30 -> 801
+            31, 32 -> 800
+            33, 34 -> 801
+            36 -> 904
+            37, 38, 39 -> 210
+            40 -> 520
+            44 -> 801
+            45, 47 -> 211
+            3200 -> -1
+            else -> -1
+        }
+    }
+
+    fun getConditionString(context: Context, code: Int): String = when (code) {
+        200 -> context.getString(R.string.weather_condition_thunderstorm_with_light_rain)
+        201 -> context.getString(R.string.weather_condition_thunderstorm_with_rain)
+        202 -> context.getString(R.string.weather_condition_thunderstorm_with_heavy_rain)
+        210 -> context.getString(R.string.weather_condition_light_thunderstorm)
+        211 -> context.getString(R.string.weather_condition_thunderstorm)
+        230 -> context.getString(R.string.weather_condition_thunderstorm_with_light_drizzle)
+        231 -> context.getString(R.string.weather_condition_thunderstorm_with_drizzle)
+        232 -> context.getString(R.string.weather_condition_thunderstorm_with_heavy_drizzle)
+        212 -> context.getString(R.string.weather_condition_heavy_thunderstorm)
+        221 -> context.getString(R.string.weather_condition_ragged_thunderstorm)
+        // Group 3xx: Drizzle
+        300 -> context.getString(R.string.weather_condition_light_intensity_drizzle)
+        301 -> context.getString(R.string.weather_condition_drizzle)
+        302 -> context.getString(R.string.weather_condition_heavy_intensity_drizzle)
+        310 -> context.getString(R.string.weather_condition_light_intensity_drizzle_rain)
+        311 -> context.getString(R.string.weather_condition_drizzle_rain)
+        312 -> context.getString(R.string.weather_condition_heavy_intensity_drizzle_rain)
+        313 -> context.getString(R.string.weather_condition_shower_rain_and_drizzle)
+        314 -> context.getString(R.string.weather_condition_heavy_shower_rain_and_drizzle)
+        321 -> context.getString(R.string.weather_condition_shower_drizzle)
+        // Group 5xx: Rain
+        500 -> context.getString(R.string.weather_condition_light_rain)
+        501 -> context.getString(R.string.weather_condition_moderate_rain)
+        502 -> context.getString(R.string.weather_condition_heavy_intensity_rain)
+        503 -> context.getString(R.string.weather_condition_very_heavy_rain)
+        504 -> context.getString(R.string.weather_condition_extreme_rain)
+        511 -> context.getString(R.string.weather_condition_freezing_rain)
+        520 -> context.getString(R.string.weather_condition_light_intensity_shower_rain)
+        521 -> context.getString(R.string.weather_condition_shower_rain)
+        522 -> context.getString(R.string.weather_condition_heavy_intensity_shower_rain)
+        531 -> context.getString(R.string.weather_condition_ragged_shower_rain)
+        // Group 6xx: Snow
+        600 -> context.getString(R.string.weather_condition_light_snow)
+        601 -> context.getString(R.string.weather_condition_snow)
+        602 -> context.getString(R.string.weather_condition_heavy_snow)
+        611 -> context.getString(R.string.weather_condition_sleet)
+        612 -> context.getString(R.string.weather_condition_shower_sleet)
+        615 -> context.getString(R.string.weather_condition_light_rain_and_snow)
+        616 -> context.getString(R.string.weather_condition_rain_and_snow)
+        620 -> context.getString(R.string.weather_condition_light_shower_snow)
+        621 -> context.getString(R.string.weather_condition_shower_snow)
+        622 -> context.getString(R.string.weather_condition_heavy_shower_snow)
+        // Group 7xx: Atmosphere
+        701 -> context.getString(R.string.weather_condition_mist)
+        711 -> context.getString(R.string.weather_condition_smoke)
+        721 -> context.getString(R.string.weather_condition_haze)
+        731 -> context.getString(R.string.weather_condition_sandcase_dust_whirls)
+        741 -> context.getString(R.string.weather_condition_fog)
+        751 -> context.getString(R.string.weather_condition_sand)
+        761 -> context.getString(R.string.weather_condition_dust)
+        762 -> context.getString(R.string.weather_condition_volcanic_ash)
+        771 -> context.getString(R.string.weather_condition_squalls)
+        781, 900 -> context.getString(R.string.weather_condition_tornado)
+        // Group 80x: Clouds
+        800 -> context.getString(R.string.weather_condition_clear_sky)
+        801 -> context.getString(R.string.weather_condition_few_clouds)
+        802 -> context.getString(R.string.weather_condition_scattered_clouds)
+        803 -> context.getString(R.string.weather_condition_broken_clouds)
+        804 -> context.getString(R.string.weather_condition_overcast_clouds)
+        // Group 90x: Extreme
+        901 -> context.getString(R.string.weather_condition_tropical_storm)
+        902, 962 -> context.getString(R.string.weather_condition_hurricane)
+        903 -> context.getString(R.string.weather_condition_cold)
+        904 -> context.getString(R.string.weather_condition_hot)
+        905 -> context.getString(R.string.weather_condition_windy)
+        906 -> context.getString(R.string.weather_condition_hail)
+        // Group 9xx: Additional
+        951 -> context.getString(R.string.weather_condition_calm)
+        952 -> context.getString(R.string.weather_condition_light_breeze)
+        953 -> context.getString(R.string.weather_condition_gentle_breeze)
+        954 -> context.getString(R.string.weather_condition_moderate_breeze)
+        955 -> context.getString(R.string.weather_condition_fresh_breeze)
+        956 -> context.getString(R.string.weather_condition_strong_breeze)
+        957 -> context.getString(R.string.weather_condition_high_windcase_near_gale)
+        958 -> context.getString(R.string.weather_condition_gale)
+        959 -> context.getString(R.string.weather_condition_severe_gale)
+        960 -> context.getString(R.string.weather_condition_storm)
+        961 -> context.getString(R.string.weather_condition_violent_storm)
+
+        else -> ""
+    }
+
+    fun getAqiLevelString(context: Context, aqi: Int): String = when {
+        // Uses the [2023 Plume index](https://plumelabs.files.wordpress.com/2023/06/plume_aqi_2023.pdf) as a reference
+        aqi < 0   -> context.getString(R.string.aqi_level_unknown)
+        aqi < 20  -> context.getString(R.string.aqi_level_excellent)
+        aqi < 50  -> context.getString(R.string.aqi_level_fair)
+        aqi < 100 -> context.getString(R.string.aqi_level_poor)
+        aqi < 150 -> context.getString(R.string.aqi_level_unhealthy)
+        aqi < 250 -> context.getString(R.string.aqi_level_very_unhealthy)
+        else      -> context.getString(R.string.aqi_level_dangerous)
+    }
+
+    fun mapToPebbleCondition(openWeatherMapCondition: Int): Byte {
+        /* deducted values:
+    0 = sun + cloud
+    1 = clouds
+    2 = some snow
+    3 = some rain
+    4 = heavy rain
+    5 = heavy snow
+    6 = sun + cloud + rain (default icon?)
+    7 = sun
+    8 = rain + snow
+    9 = 6
+    10, 11, ... = empty icon
+ */
+        return when (openWeatherMapCondition) {
+            200, 201, 202, 210, 211, 230, 231, 232, 212, 221 -> 4
+            300, 301, 302, 310, 311, 312, 313, 314, 321, 500, 501 -> 3
+            502, 503, 504, 511, 520, 521, 522, 531 -> 4
+            600, 601, 620 -> 2
+            602, 611, 612, 621, 622 -> 5
+            615, 616 -> 8
+            701, 711, 721, 731, 741, 751, 761, 762, 771, 781, 900 -> 6
+            800 -> 7
+            801, 802, 803, 804 -> 0
+            901, 903, 904, 905, 906, 951, 952, 953, 954, 955, 956, 957, 958, 959, 960, 961, 902, 962 -> 6
+
+            else -> 6
+
+        }
+    }
+
+    fun mapToYahooCondition(openWeatherMapCondition: Int): Int {
+        // openweathermap.org conditions:
+        // http://openweathermap.org/weather-conditions
+        return when (openWeatherMapCondition) {
+            200, 201, 202, 210, 211, 230, 231, 232 -> 4
+            212, 221 -> 3
+            300, 301, 302, 310, 311, 312 -> 9
+            313, 314, 321 -> 11
+            500, 501, 502, 503, 504, 511 -> 10
+            520 -> 40
+            521, 522, 531 -> 12
+            600 -> 7
+            601 -> 16
+            602 -> 15
+            611, 612 -> 18
+            615, 616 -> 5
+            620 -> 14
+            621 -> 46
+            622, 701, 711 -> 22
+            721 -> 21
+            731 -> 3200
+            741 -> 20
+            751, 761 -> 19
+            762, 771 -> 3200
+            781, 900 -> 0
+            800 -> 32
+            801, 802 -> 34
+            803, 804 -> 44
+            901 -> 1
+            903 -> 25
+            904 -> 36
+            905 -> 24
+            906 -> 17
+            951, 952, 953, 954, 955 -> 34
+            956, 957 -> 24
+            958, 959, 960, 961 -> 3200
+            902, 962 -> 2
+            else -> 3200
+
+        }
+    }
+
+
+    fun mapToZeTimeConditionOld(openWeatherMapCondition: Int): Byte {
+        /* deducted values:
+    0 = partly cloudy
+    1 = cloudy
+    2 = sunny
+    3 = windy/gale
+    4 = heavy rain
+    5 = snowy
+    6 = storm
+ */
+        return when (openWeatherMapCondition) {
+            200, 201, 202, 210, 211, 230, 231, 232, 212, 221, 771, 781, 900, 901, 960, 961, 902, 962 -> 6
+            300, 301, 302, 310, 311, 312, 313, 314, 321, 500, 501, 502, 503, 504, 511, 520, 521, 522, 531, 906 -> 4
+            600, 601, 620, 602, 611, 612, 621, 622, 615, 616, 903 -> 5
+            701, 711, 721, 731, 741, 751, 761, 762 -> 1
+            800, 904 -> 2
+            801, 802, 803, 804 -> 0
+
+            905, 951, 952, 953, 954, 955, 956, 957, 958, 959 -> 3
+            else -> 0
+
+        }
+    }
+
+    fun mapToZeTimeCondition(openWeatherMapCondition: Int): Byte {
+        /* deducted values:
+    0 = tornado
+    1 = typhoon
+    2 = hurricane
+    3 = thunderstorm
+    4 = rain and snow
+    5 = unavailable
+    6 = freezing rain
+    7 = drizzle
+    8 = showers
+    9 = snow flurries
+    10 = blowing snow
+    11 = snow
+    12 = sleet
+    13 = foggy
+    14 = windy
+    15 = cloudy
+    16 = partly cloudy (night)
+    17 = partly cloudy (day)
+    18 = clear night
+    19 = sunny
+    20 = thundershower
+    21 = hot
+    22 = scattered thunders
+    23 = snow showers
+    24 = heavy snow
+ */
+        return when (openWeatherMapCondition) {
+            210 -> 22
+
+            200, 201, 202, 230, 231, 232 -> 20
+
+            211, 212, 221 -> 3
+
+            781, 900 -> 0
+
+            901 -> 1
+
+            771, 960, 961, 902, 962 -> 2
+
+            300, 301, 302, 310, 311, 312, 313, 314, 321 -> 7
+
+            500, 501, 502, 503, 504, 520, 521, 522, 531, 906 -> 8
+
+            511 -> 6
+
+            620, 621, 622 -> 23
+
+            615, 616 -> 4
+
+            611, 612 -> 12
+
+            600, 601 -> 11
+            602 -> 24
+
+            701, 711, 721, 731, 741, 751, 761, 762 -> 13
+
+            800 -> 19
+
+            904 -> 21
+
+            801, 802, 803 -> 17
+
+            804 -> 15
+
+            905, 951, 952, 953, 954, 955, 956, 957, 958, 959 -> 14
+
+            903 -> 5
+            else -> 5
+        }
+    }
+
+    fun mapToCmfCondition(openWeatherMapCondition: Int): Byte {
+        /* deducted values:
+    1 = sunny
+    2 = cloudy
+    3 = overcast
+    4 = showers
+    5 = snow showers
+    6 = fog
+
+    9 = thunder showers
+
+    14 = sleet
+
+    19 = hot (extreme)
+    20 = cold (extreme)
+
+    21 = strong wind
+    22 = (night) sunny - with moon
+    23 = (night) sunny with stars
+    24 = (night) cloudy - with moon
+    25 = sun with haze
+    26 = cloudy (sun with cloud)
+ */
+        return when (openWeatherMapCondition) {
+            210, 200, 201, 202, 230, 231, 232, 211, 212, 221 -> 9
+
+            901, 781, 900, 771, 960, 961, 902, 962 -> 21
+
+            300, 301, 302, 310, 311, 312, 313, 314, 321, 500, 501, 502, 503, 504, 520, 521, 522, 531 -> 4
+
+            906, 615, 616, 511 -> 14
+
+            611, 612, 600, 601, 602, 620, 621, 622 -> 5
+
+
+            701, 711, 721, 731, 741, 751, 761, 762 -> 6
+
+            800 -> 1
+
+            904 -> 19
+
+            801, 802 -> 26
+            803 -> 2
+
+            804 -> 3
+
+            905, 951, 952, 953, 954, 955, 956, 957, 958, 959 -> 21
+
+            903 -> 20
+            else -> 20
+        }
+    }
+
+    fun mapToFitProCondition(openWeatherMapCondition: Int): Byte {
+        return when (openWeatherMapCondition) {
+            100 -> 1
+            104 -> 2
+            101, 102, 103 -> 3
+            305, 309 -> 4
+            306, 314, 399 -> 5
+            307, 308, 310, 311, 312, 315, 316, 317, 318 -> 6
+            300, 301, 302, 303 -> 7
+            400, 407 -> 8
+            401, 408, 499 -> 9
+            402, 403, 409, 410 -> 10
+            404, 405, 406 -> 11
+            500, 501, 502, 509, 510, 511, 512, 513, 514, 515 -> 12
+            304, 313 -> 13
+            503, 504, 507, 508 -> 14
+            200, 201, 202, 203, 204 -> 15
+            205, 206, 207, 208 -> 16
+            209, 210, 211 -> 17
+            212 -> 18
+            231 -> 19
+            else -> 3
+        }
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/banglejs/BangleJSDeviceSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/banglejs/BangleJSDeviceSupport.java
index e818c2c8f9..a6b49615d5 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/banglejs/BangleJSDeviceSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/banglejs/BangleJSDeviceSupport.java
@@ -1985,7 +1985,7 @@ public class BangleJSDeviceSupport extends AbstractBTLESingleDeviceSupport {
     private void handleWeather(JSONObject json)
     {
         if (!json.has("v")) {
-            handleWeatherV1(Weather.getInstance().getWeatherSpecs());
+            handleWeatherV1(Weather.INSTANCE.getWeatherSpecs());
             return;
         }
         try {
@@ -1995,9 +1995,9 @@ public class BangleJSDeviceSupport extends AbstractBTLESingleDeviceSupport {
                 forecast = json.getBoolean("f");
             }
             if (version == 1) {
-                handleWeatherV1(Weather.getInstance().getWeatherSpecs());
+                handleWeatherV1(Weather.INSTANCE.getWeatherSpecs());
             } else if (version == 2) {
-                handleWeatherV2(Weather.getInstance().getWeatherSpecs(), forecast);
+                handleWeatherV2(Weather.INSTANCE.getWeatherSpecs(), forecast);
             }
         } catch (JSONException e) {
             LOG.info("JSONException: " + e.getLocalizedMessage());
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/cmfwatchpro/CmfWatchProSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/cmfwatchpro/CmfWatchProSupport.java
index 504ed706ce..cf97284aba 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/cmfwatchpro/CmfWatchProSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/cmfwatchpro/CmfWatchProSupport.java
@@ -71,7 +71,7 @@ import nodomain.freeyourgadget.gadgetbridge.model.Contact;
 import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;
-import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 import nodomain.freeyourgadget.gadgetbridge.service.btle.AbstractBTLESingleDeviceSupport;
 import nodomain.freeyourgadget.gadgetbridge.service.btle.BLETypeConversions;
@@ -813,7 +813,7 @@ public class CmfWatchProSupport extends AbstractBTLESingleDeviceSupport implemen
         final int payloadLength = (7 * 9) + (24 * 2) + (supportsSunriseSunset ? 32 : 30) + (supportsSunriseSunset ? 7 * 8 : 0);
         final ByteBuffer buf = ByteBuffer.allocate(payloadLength).order(ByteOrder.BIG_ENDIAN);
         // start with the current day's weather
-        buf.put(Weather.mapToCmfCondition(weatherSpec.currentConditionCode));
+        buf.put(WeatherMapper.INSTANCE.mapToCmfCondition(weatherSpec.currentConditionCode));
         buf.put((byte) (weatherSpec.currentTemp - 273 + 100)); // convert Kelvin to C, add 100
         buf.put((byte) (weatherSpec.todayMaxTemp - 273 + 100)); // convert Kelvin to C, add 100
         buf.put((byte) (weatherSpec.todayMinTemp - 273 + 100)); // convert Kelvin to C, add 100
@@ -828,7 +828,7 @@ public class CmfWatchProSupport extends AbstractBTLESingleDeviceSupport implemen
         for (int i = 0; i < 6; i++) {
             if (i < maxForecastsAvailable) {
                 WeatherSpec.Daily forecastDay = weatherSpec.forecasts.get(i);
-                buf.put((byte) (Weather.mapToCmfCondition(forecastDay.conditionCode)));  // weather condition flag
+                buf.put((byte) (WeatherMapper.INSTANCE.mapToCmfCondition(forecastDay.conditionCode)));  // weather condition flag
                 buf.put((byte) (forecastDay.maxTemp - 273 + 100)); // temp in C (not shown in future days' forecasts)
                 buf.put((byte) (forecastDay.maxTemp - 273 + 100)); // max temp in C, + 100
                 buf.put((byte) (forecastDay.minTemp - 273 + 100)); // min temp in C, + 100
@@ -858,7 +858,7 @@ public class CmfWatchProSupport extends AbstractBTLESingleDeviceSupport implemen
                 buf.put((byte) forecastHr.conditionCode); // condition
             } else {
                 buf.put((byte) (weatherSpec.currentTemp - 273 + 100)); // assume current temp
-                buf.put((byte) (Weather.mapToCmfCondition(weatherSpec.currentConditionCode))); // current condition
+                buf.put((byte) (WeatherMapper.INSTANCE.mapToCmfCondition(weatherSpec.currentConditionCode))); // current condition
             }
         }
         // place name - watch scrolls after ~10 chars. Pad up to 32 bytes.
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/evenrealities/G1DeviceSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/evenrealities/G1DeviceSupport.java
index a2558a056e..81bbf0a62e 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/evenrealities/G1DeviceSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/evenrealities/G1DeviceSupport.java
@@ -356,7 +356,7 @@ public class G1DeviceSupport extends AbstractBTLEMultiDeviceSupport {
 
         // Pull the weather into a local variable so that if it changes between the two lenses being
         // updated, we won't end up with a skewed value.
-        @Nullable WeatherSpec weather = Weather.getInstance().getWeatherSpec();
+        @Nullable WeatherSpec weather = Weather.INSTANCE.getWeatherSpec();
 
         // Run in the background in case the command hangs and this was run from the UI thread.
         backgroundTasksHandler.post(() -> {
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/fitpro/FitProDeviceSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/fitpro/FitProDeviceSupport.java
index 6bf3fb56c8..90eb70c15a 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/fitpro/FitProDeviceSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/fitpro/FitProDeviceSupport.java
@@ -136,7 +136,7 @@ import nodomain.freeyourgadget.gadgetbridge.model.Alarm;
 import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.DeviceService;
 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;
-import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 import nodomain.freeyourgadget.gadgetbridge.service.btle.AbstractBTLESingleDeviceSupport;
 import nodomain.freeyourgadget.gadgetbridge.service.btle.GattService;
@@ -556,7 +556,7 @@ public class FitProDeviceSupport extends AbstractBTLESingleDeviceSupport {
             weatherUnit = 1;
         }
 
-        byte currentConditionCode = Weather.mapToFitProCondition(weatherSpec.currentConditionCode);
+        byte currentConditionCode = WeatherMapper.INSTANCE.mapToFitProCondition(weatherSpec.currentConditionCode);
         TransactionBuilder builder = createTransactionBuilder("weather");
         writeChunkedData(builder, craftData(CMD_GROUP_GENERAL, CMD_WEATHER, new byte[]{(byte) todayMin, (byte) todayMax, (byte) currentConditionCode, (byte) weatherUnit}));
         builder.queue();
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupport.java
index c5ec984d78..acb991052a 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupport.java
@@ -284,7 +284,7 @@ public class GarminSupport extends AbstractBTLESingleDeviceSupport implements IC
     @Override
     public void evaluateGBDeviceEvent(GBDeviceEvent deviceEvent) {
         if (deviceEvent instanceof WeatherRequestDeviceEvent) {
-            WeatherSpec weather = Weather.getInstance().getWeatherSpec();
+            WeatherSpec weather = Weather.INSTANCE.getWeatherSpec();
             if (weather != null) {
                 sendWeatherConditions(weather);
             }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/WeatherHandler.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/WeatherHandler.java
index df0ff71a38..272114e2ff 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/WeatherHandler.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/WeatherHandler.java
@@ -23,6 +23,7 @@ import java.util.Map;
 import lineageos.weather.util.WeatherUtils;
 import nodomain.freeyourgadget.gadgetbridge.GBApplication;
 import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 import nodomain.freeyourgadget.gadgetbridge.service.btle.BLETypeConversions;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.pebble.webview.CurrentPosition;
@@ -39,7 +40,7 @@ public class WeatherHandler {
         final String path = request.getPath();
         final Map<String, String> query = request.getQuery();
 
-        final WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        final WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
 
         if (weatherSpec == null) {
             LOG.warn("No weather in weather instance");
@@ -160,8 +161,8 @@ public class WeatherHandler {
 
         public WeatherForecastDay(final GregorianCalendar date, final WeatherSpec.Daily dailyForecast, final String tempUnit, final String speedUnit) {
             dayOfWeek = BLETypeConversions.dayOfWeekToRawBytes(date);
-            description = Weather.getConditionString(GBApplication.getContext(), dailyForecast.conditionCode);
-            summary = Weather.getConditionString(GBApplication.getContext(), dailyForecast.conditionCode);
+            description = WeatherMapper.INSTANCE.getConditionString(GBApplication.getContext(), dailyForecast.conditionCode);
+            summary = WeatherMapper.INSTANCE.getConditionString(GBApplication.getContext(), dailyForecast.conditionCode);
             high = getTemperature(dailyForecast.maxTemp, tempUnit);
             low = getTemperature(dailyForecast.minTemp, tempUnit);
             precipProb = dailyForecast.precipProbability;
@@ -212,7 +213,7 @@ public class WeatherHandler {
 
         public WeatherForecastHour(final WeatherSpec.Hourly hourlyForecast, final String tempUnit, final String speedUnit) {
             epochSeconds = hourlyForecast.timestamp;
-            description = Weather.getConditionString(GBApplication.getContext(), hourlyForecast.conditionCode);
+            description = WeatherMapper.INSTANCE.getConditionString(GBApplication.getContext(), hourlyForecast.conditionCode);
             temp = getTemperature(hourlyForecast.temp, tempUnit);
             precipProb = hourlyForecast.precipProbability;
             wind = new Wind(getSpeed(hourlyForecast.windSpeed, speedUnit), hourlyForecast.windDirection);
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/HuamiSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/HuamiSupport.java
index 955877e9c9..bd3cdc5e14 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/HuamiSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/HuamiSupport.java
@@ -135,7 +135,7 @@ import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;
 import nodomain.freeyourgadget.gadgetbridge.model.Reminder;
-import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.WorldClock;
 import nodomain.freeyourgadget.gadgetbridge.service.btle.BLETypeConversions;
@@ -2877,7 +2877,7 @@ public abstract class HuamiSupport extends AbstractBTLESingleDeviceSupport
             builder = performInitialized("Sending air quality index");
             int length = 8;
             int aqi = weatherSpec.airQuality != null ? weatherSpec.airQuality.aqi : -1;
-            String aqiString = Weather.getAqiLevelString(getContext(), aqi);
+            String aqiString = WeatherMapper.INSTANCE.getAqiLevelString(getContext(), aqi);
             if (supportsConditionString) {
                 length += aqiString.getBytes().length + 1;
             }
@@ -2916,7 +2916,7 @@ public abstract class HuamiSupport extends AbstractBTLESingleDeviceSupport
                 bytesPerDay = 5;
                 conditionsLength = weatherSpec.currentCondition.getBytes().length;
                 for (WeatherSpec.Daily forecast : weatherSpec.forecasts) {
-                    conditionsLength += Weather.getConditionString(getContext(), forecast.conditionCode).getBytes().length;
+                    conditionsLength += WeatherMapper.INSTANCE.getConditionString(getContext(), forecast.conditionCode).getBytes().length;
                 }
             }
 
@@ -2963,7 +2963,7 @@ public abstract class HuamiSupport extends AbstractBTLESingleDeviceSupport
                 buf.put((byte) forecastMinTemp);
 
                 if (supportsConditionString) {
-                    buf.put(Weather.getConditionString(getContext(), forecast.conditionCode).getBytes());
+                    buf.put(WeatherMapper.INSTANCE.getConditionString(getContext(), forecast.conditionCode).getBytes());
                     buf.put((byte) 0);
                 }
             }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/zeppos/ZeppOsWeatherHandler.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/zeppos/ZeppOsWeatherHandler.java
index 2b5658ba40..91b8c38882 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/zeppos/ZeppOsWeatherHandler.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/zeppos/ZeppOsWeatherHandler.java
@@ -91,7 +91,7 @@ public class ZeppOsWeatherHandler {
     }
 
     public Response handleHttpRequest(final String path, final Map<String, String> query) {
-        final WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        final WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
 
         if (weatherSpec == null) {
             LOG.error("No weather in weather instance");
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWeatherManager.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWeatherManager.java
index ecf258a0ce..d95e6b8cb2 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWeatherManager.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWeatherManager.java
@@ -277,7 +277,7 @@ public class HuaweiWeatherManager {
     public void handleAsyncMessage(HuaweiPacket response) {
         if (response.getTlv().getInteger(0x7f, -1) == 0x000186AA) {
             // Send weather
-            final ArrayList<WeatherSpec> specs = new ArrayList<>(nodomain.freeyourgadget.gadgetbridge.model.Weather.getInstance().getWeatherSpecs());
+            final ArrayList<WeatherSpec> specs = new ArrayList<>(nodomain.freeyourgadget.gadgetbridge.model.Weather.INSTANCE.getWeatherSpecs());
             if (specs.isEmpty()) {
                 LOG.debug("Weather specs empty, returning that weather is disabled.");
                 try {
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/moyoung/MoyoungDeviceSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/moyoung/MoyoungDeviceSupport.java
index 36d79cc011..7035cade55 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/moyoung/MoyoungDeviceSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/moyoung/MoyoungDeviceSupport.java
@@ -446,8 +446,8 @@ public class MoyoungDeviceSupport extends AbstractBTLESingleDeviceSupport {
 
         if (packetType == MoyoungConstants.CMD_NOTIFY_WEATHER_CHANGE) {
             LOG.info("Will transmit cached weather (if any) since the watch asks for it");
-            if (Weather.getInstance().getWeatherSpec() != null) {
-                final ArrayList<WeatherSpec> specs = new ArrayList<>(Weather.getInstance().getWeatherSpecs());
+            if (Weather.INSTANCE.getWeatherSpec() != null) {
+                final ArrayList<WeatherSpec> specs = new ArrayList<>(Weather.INSTANCE.getWeatherSpecs());
                 GBApplication.deviceService().onSendWeather(specs);
             }
             return true;
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerHealthify.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerHealthify.java
index 8442e27eff..3c51196f1d 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerHealthify.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerHealthify.java
@@ -69,7 +69,7 @@ class AppMessageHandlerHealthify extends AppMessageHandler {
 
     @Override
     public GBDeviceEvent[] onAppStart() {
-        WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
         if (weatherSpec == null) {
             return new GBDeviceEvent[]{null};
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerM7S.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerM7S.java
index 4700ed906e..3a3f366ee6 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerM7S.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerM7S.java
@@ -146,7 +146,7 @@ class AppMessageHandlerM7S extends AppMessageHandler {
 
     @Override
     public GBDeviceEvent[] onAppStart() {
-        WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
         if (weatherSpec == null) {
             return new GBDeviceEvent[]{null};
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerMarioTime.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerMarioTime.java
index a35232f166..a493bee123 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerMarioTime.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerMarioTime.java
@@ -55,7 +55,7 @@ class AppMessageHandlerMarioTime extends AppMessageHandler {
 
     @Override
     public GBDeviceEvent[] onAppStart() {
-        WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
         if (weatherSpec == null) {
             return new GBDeviceEvent[]{null};
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerObsidian.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerObsidian.java
index 24045e4399..ac11bab372 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerObsidian.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerObsidian.java
@@ -160,7 +160,7 @@ class AppMessageHandlerObsidian extends AppMessageHandler {
 
     @Override
     public GBDeviceEvent[] onAppStart() {
-        WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
         if (weatherSpec == null) {
             return new GBDeviceEvent[]{null};
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerPebStyle.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerPebStyle.java
index 29fcdd6a43..e62681eab4 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerPebStyle.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerPebStyle.java
@@ -28,6 +28,7 @@ import java.util.UUID;
 import nodomain.freeyourgadget.gadgetbridge.deviceevents.GBDeviceEvent;
 import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleColor;
 import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 
 class AppMessageHandlerPebStyle extends AppMessageHandler {
@@ -92,11 +93,11 @@ class AppMessageHandlerPebStyle extends AppMessageHandler {
 
 
         //WEATHER
-        WeatherSpec weather = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weather = Weather.INSTANCE.getWeatherSpec();
         if (weather != null) {
             //comment the same key in the general section above!
             pairs.add(new Pair<>(KEY_LOCATION_SERVICE, (Object) 0)); //0 auto, 1 manual
-            pairs.add(new Pair<>(KEY_WEATHER_CODE, (Object) Weather.mapToYahooCondition(weather.currentConditionCode)));
+            pairs.add(new Pair<>(KEY_WEATHER_CODE, (Object) WeatherMapper.INSTANCE.mapToYahooCondition(weather.currentConditionCode)));
             pairs.add(new Pair<>(KEY_WEATHER_TEMP, (Object) (weather.currentTemp - 273)));
         }
 
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerRealWeather.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerRealWeather.java
index 436cad81cf..d863eecc91 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerRealWeather.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerRealWeather.java
@@ -130,7 +130,7 @@ class AppMessageHandlerRealWeather extends AppMessageHandler {
 
     @Override
     public GBDeviceEvent[] onAppStart() {
-        WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
         if (weatherSpec == null) {
             return new GBDeviceEvent[]{null};
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerSimplyLight.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerSimplyLight.java
index 59845d2624..6c9a6b63dd 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerSimplyLight.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerSimplyLight.java
@@ -123,7 +123,7 @@ private int getConditionForConditionCode(int conditionCode) {
 
     @Override
     public GBDeviceEvent[] onAppStart() {
-        WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
         if (weatherSpec == null) {
             return new GBDeviceEvent[]{null};
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerSquare.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerSquare.java
index e15d3c69e6..6d5769135e 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerSquare.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerSquare.java
@@ -78,7 +78,7 @@ class AppMessageHandlerSquare extends AppMessageHandler {
 
     @Override
     public GBDeviceEvent[] onAppStart() {
-        WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
         if (weatherSpec == null) {
             return new GBDeviceEvent[]{null};
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerTimeStylePebble.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerTimeStylePebble.java
index e759b93c25..717753fd59 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerTimeStylePebble.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerTimeStylePebble.java
@@ -155,7 +155,7 @@ class AppMessageHandlerTimeStylePebble extends AppMessageHandler {
 
     @Override
     public GBDeviceEvent[] onAppStart() {
-        WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
         if (weatherSpec == null) {
             return new GBDeviceEvent[]{null};
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerTrekVolle.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerTrekVolle.java
index a0ade535c9..6b1ceacf7a 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerTrekVolle.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerTrekVolle.java
@@ -96,7 +96,7 @@ class AppMessageHandlerTrekVolle extends AppMessageHandler {
 
     @Override
     public GBDeviceEvent[] onAppStart() {
-        WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
         if (weatherSpec == null) {
             return new GBDeviceEvent[]{null};
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerYWeather.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerYWeather.java
index 3728978f20..1d9522d55a 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerYWeather.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerYWeather.java
@@ -228,7 +228,7 @@ class AppMessageHandlerYWeather extends AppMessageHandler {
 
     @Override
     public GBDeviceEvent[] onAppStart() {
-        WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
         if (weatherSpec == null) {
             return new GBDeviceEvent[]{null};
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerZalewszczak.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerZalewszczak.java
index 765e9a6e5f..e2370901f3 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerZalewszczak.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/AppMessageHandlerZalewszczak.java
@@ -83,7 +83,7 @@ class AppMessageHandlerZalewszczak extends AppMessageHandler {
 
     @Override
     public GBDeviceEvent[] onAppStart() {
-        WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+        WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
         if (weatherSpec == null) {
             return new GBDeviceEvent[]{null};
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/PebbleProtocol.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/PebbleProtocol.java
index 13e469a20a..06acb12526 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/PebbleProtocol.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/PebbleProtocol.java
@@ -66,7 +66,7 @@ import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec.Action;
 import nodomain.freeyourgadget.gadgetbridge.devices.pebble.PebbleNotification;
 import nodomain.freeyourgadget.gadgetbridge.model.NotificationType;
-import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 import nodomain.freeyourgadget.gadgetbridge.service.serial.GBDeviceProtocol;
 import nodomain.freeyourgadget.gadgetbridge.util.DateTimeUtils;
@@ -1183,10 +1183,10 @@ public class PebbleProtocol extends GBDeviceProtocol {
         buf.order(ByteOrder.LITTLE_ENDIAN);
         buf.put((byte) 3); // unknown, always 3?
         buf.putShort(currentTemp);
-        buf.put(Weather.mapToPebbleCondition(weatherSpec.currentConditionCode));
+        buf.put(WeatherMapper.INSTANCE.mapToPebbleCondition(weatherSpec.currentConditionCode));
         buf.putShort(todayMax);
         buf.putShort(todayMin);
-        buf.put(Weather.mapToPebbleCondition(tomorrowConditionCode));
+        buf.put(WeatherMapper.INSTANCE.mapToPebbleCondition(tomorrowConditionCode));
         buf.putShort(tomorrowMax);
         buf.putShort(tomorrowMin);
         buf.putInt(weatherSpec.timestamp);
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/webview/GBWebClient.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/webview/GBWebClient.java
index 328892529f..17b91f26c2 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/webview/GBWebClient.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/webview/GBWebClient.java
@@ -144,7 +144,7 @@ public class GBWebClient extends WebViewClient {
 
     private WebResourceResponse mimicOpenWeatherMapResponse(String type, String units) {
 
-        if (Weather.getInstance() == null) {
+        if (Weather.INSTANCE == null) {
             LOG.warn("WEBVIEW - Weather instance is null, cannot update weather");
             return null;
         }
@@ -152,7 +152,7 @@ public class GBWebClient extends WebViewClient {
         CurrentPosition currentPosition = new CurrentPosition();
 
         try {
-            JSONObject resp = Weather.getInstance().createReconstructedOWMWeatherReply();
+            JSONObject resp = Weather.INSTANCE.createReconstructedOWMWeatherReply();
             if ("/data/2.5/weather".equals(type) && resp != null) {
                 JSONObject main = resp.getJSONObject("main");
 
@@ -163,8 +163,8 @@ public class GBWebClient extends WebViewClient {
                 resp.put("cod", 200);
                 resp.put("coord", coordObject(currentPosition));
                 resp.put("sys", sysObject(currentPosition));
-//            } else if ("/data/2.5/forecast".equals(type) && Weather.getInstance().getWeather2().reconstructedOWMForecast != null) { //this is wrong, as we only have daily data. Unfortunately it looks like daily forecasts cannot be reconstructed
-//                resp = new JSONObject(Weather.getInstance().getWeather2().reconstructedOWMForecast.toString());
+//            } else if ("/data/2.5/forecast".equals(type) && Weather.INSTANCE.getWeather2().reconstructedOWMForecast != null) { //this is wrong, as we only have daily data. Unfortunately it looks like daily forecasts cannot be reconstructed
+//                resp = new JSONObject(Weather.INSTANCE.getWeather2().reconstructedOWMForecast.toString());
 //
 //                JSONObject city = resp.getJSONObject("city");
 //                city.put("coord", coordObject(currentPosition));
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/qhybrid/adapter/fossil_hr/FossilHRWatchAdapter.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/qhybrid/adapter/fossil_hr/FossilHRWatchAdapter.java
index 2ec22bfb56..dfbc849458 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/qhybrid/adapter/fossil_hr/FossilHRWatchAdapter.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/qhybrid/adapter/fossil_hr/FossilHRWatchAdapter.java
@@ -2003,7 +2003,7 @@ public class FossilHRWatchAdapter extends FossilWatchAdapter {
                     }
                 } else if (request.has("weatherInfo") || request.has("weatherApp._.config.locations")) {
                     LOG.info("Got weatherInfo request");
-                    WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+                    WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
                     if (weatherSpec != null) {
                         onSendWeather(weatherSpec);
                     } else {
@@ -2011,7 +2011,7 @@ public class FossilHRWatchAdapter extends FossilWatchAdapter {
                     }
                 } else if (request.has("widgetChanceOfRain._.config.info")) {
                     LOG.info("Got widgetChanceOfRain request");
-                    WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+                    WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
                     if (weatherSpec != null) {
                         onSendChanceOfRain(weatherSpec);
                     } else {
@@ -2019,7 +2019,7 @@ public class FossilHRWatchAdapter extends FossilWatchAdapter {
                     }
                 } else if (request.has("widgetUV._.config.info")) {
                     LOG.info("Got widgetUV request");
-                    WeatherSpec weatherSpec = Weather.getInstance().getWeatherSpec();
+                    WeatherSpec weatherSpec = Weather.INSTANCE.getWeatherSpec();
                     if (weatherSpec != null) {
                         onSendUVIndex(weatherSpec);
                     } else {
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/xiaomi/services/XiaomiWeatherService.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/xiaomi/services/XiaomiWeatherService.java
index c6940e7529..57349fed58 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/xiaomi/services/XiaomiWeatherService.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/xiaomi/services/XiaomiWeatherService.java
@@ -517,7 +517,7 @@ public class XiaomiWeatherService extends AbstractXiaomiService {
             if (!TextUtils.isEmpty(locationKey) && !TextUtils.isEmpty(locationName)) {
                 LOG.debug("Received request for conditions (location key = {}, name = {})", locationKey, locationName);
 
-                final List<WeatherSpec> knownWeathers = Weather.getInstance().getWeatherSpecs();
+                final List<WeatherSpec> knownWeathers = Weather.INSTANCE.getWeatherSpecs();
                 for (WeatherSpec spec : knownWeathers) {
                     if (TextUtils.equals(spec.location, locationName)) {
                         sendWeatherSpec(spec);
@@ -529,14 +529,14 @@ public class XiaomiWeatherService extends AbstractXiaomiService {
             }
         }
 
-        final WeatherSpec spec = Weather.getInstance().getWeatherSpec();
+        final WeatherSpec spec = Weather.INSTANCE.getWeatherSpec();
 
         if (spec == null) {
             LOG.warn("Not sending weather conditions: active weather spec is null!");
             return;
         }
 
-        sendWeatherSpec(Weather.getInstance().getWeatherSpec());
+        sendWeatherSpec(Weather.INSTANCE.getWeatherSpec());
     }
 
     private static String[] weatherLocationsToStringArray(final Collection<XiaomiProto.WeatherLocation> locations) {
@@ -567,7 +567,7 @@ public class XiaomiWeatherService extends AbstractXiaomiService {
             locationsInitialized = true;
 
             // now that the feature flag has been updated, send cached weather
-            onSendWeather(Weather.getInstance().getWeatherSpecs());
+            onSendWeather(Weather.INSTANCE.getWeatherSpecs());
 
             return;
         }
@@ -614,7 +614,7 @@ public class XiaomiWeatherService extends AbstractXiaomiService {
 
         final Set<XiaomiProto.WeatherLocation> specLocations = new HashSet<>();
 
-        for (final WeatherSpec s : Weather.getInstance().getWeatherSpecs()) {
+        for (final WeatherSpec s : Weather.INSTANCE.getWeatherSpecs()) {
             specLocations.add(getWeatherLocationFromSpec(s));
         }
 
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/zetime/ZeTimeDeviceSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/zetime/ZeTimeDeviceSupport.java
index 3ab6a122c0..db6cb71782 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/zetime/ZeTimeDeviceSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/zetime/ZeTimeDeviceSupport.java
@@ -62,7 +62,7 @@ import nodomain.freeyourgadget.gadgetbridge.model.CallSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.MusicSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.MusicStateSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.NotificationSpec;
-import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 import nodomain.freeyourgadget.gadgetbridge.service.btle.GattService;
 import nodomain.freeyourgadget.gadgetbridge.service.btle.TransactionBuilder;
@@ -617,9 +617,9 @@ public class ZeTimeDeviceSupport extends AbstractBTLESingleDeviceSupport {
             LOG.warn("We do not have a sane fw version string available, firmware too old/new?");
         }
         if (newWeather) {
-            weather[9] = Weather.mapToZeTimeCondition(weatherSpec.currentConditionCode);
+            weather[9] = WeatherMapper.INSTANCE.mapToZeTimeCondition(weatherSpec.currentConditionCode);
         } else {
-            weather[9] = Weather.mapToZeTimeConditionOld(weatherSpec.currentConditionCode);
+            weather[9] = WeatherMapper.INSTANCE.mapToZeTimeConditionOld(weatherSpec.currentConditionCode);
         }
         for (int forecast = 0; forecast < 3; forecast++) {
             weather[10 + (forecast * 5)] = 0; // celsius
@@ -627,9 +627,9 @@ public class ZeTimeDeviceSupport extends AbstractBTLESingleDeviceSupport {
             weather[12 + (forecast * 5)] = (byte) (weatherSpec.forecasts.get(forecast).minTemp - 273);
             weather[13 + (forecast * 5)] = (byte) (weatherSpec.forecasts.get(forecast).maxTemp - 273);
             if (newWeather) {
-                weather[14 + (forecast * 5)] = Weather.mapToZeTimeCondition(weatherSpec.forecasts.get(forecast).conditionCode);
+                weather[14 + (forecast * 5)] = WeatherMapper.INSTANCE.mapToZeTimeCondition(weatherSpec.forecasts.get(forecast).conditionCode);
             } else {
-                weather[14 + (forecast * 5)] = Weather.mapToZeTimeConditionOld(weatherSpec.forecasts.get(forecast).conditionCode);
+                weather[14 + (forecast * 5)] = WeatherMapper.INSTANCE.mapToZeTimeConditionOld(weatherSpec.forecasts.get(forecast).conditionCode);
             }
         }
         System.arraycopy(weatherSpec.location.getBytes(StandardCharsets.UTF_8), 0, weather, 25, weatherSpec.location.getBytes(StandardCharsets.UTF_8).length);
diff --git a/app/src/main/java/ru/gelin/android/weather/notification/ParcelableWeather2.java b/app/src/main/java/ru/gelin/android/weather/notification/ParcelableWeather2.java
index b7d0963b04..1914d1b474 100644
--- a/app/src/main/java/ru/gelin/android/weather/notification/ParcelableWeather2.java
+++ b/app/src/main/java/ru/gelin/android/weather/notification/ParcelableWeather2.java
@@ -27,7 +27,7 @@ import org.json.JSONObject;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
-import nodomain.freeyourgadget.gadgetbridge.model.Weather;
+import nodomain.freeyourgadget.gadgetbridge.model.WeatherMapper;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 
 public class ParcelableWeather2 implements Parcelable {
@@ -99,7 +99,7 @@ public class ParcelableWeather2 implements Parcelable {
                     condition.put("id", forecastConditionCode);
                     condition.put("main", forecastBundle.getString("weather_condition_text"));
                     condition.put("description", forecastBundle.getString("weather_condition_text"));
-                    condition.put("icon", Weather.mapToOpenWeatherMapIcon(forecastConditionCode));
+                    condition.put("icon", WeatherMapper.INSTANCE.mapToOpenWeatherMapIcon(forecastConditionCode));
                     weather.put(condition);
 
                     main.put("temp", forecastBundle.getInt("weather_current_temp"));
diff --git a/app/src/test/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherMapperTest.java b/app/src/test/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherMapperTest.java
new file mode 100644
index 0000000000..a6ef760615
--- /dev/null
+++ b/app/src/test/java/nodomain/freeyourgadget/gadgetbridge/model/WeatherMapperTest.java
@@ -0,0 +1,1260 @@
+/*  Copyright (C) 2023 José Rebelo
+
+    This file is part of Gadgetbridge.
+
+    Gadgetbridge is free software: you can redistribute it and/or modify
+    it under the terms of the GNU Affero General Public License as published
+    by the Free Software Foundation, either version 3 of the License, or
+    (at your option) any later version.
+
+    Gadgetbridge is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU Affero General Public License for more details.
+
+    You should have received a copy of the GNU Affero General Public License
+    along with this program.  If not, see <http://www.gnu.org/licenses/>. */
+package nodomain.freeyourgadget.gadgetbridge.model;
+
+import android.content.Context;
+
+import androidx.annotation.Nullable;
+
+import org.json.JSONArray;
+import org.json.JSONException;
+import org.json.JSONObject;
+import org.junit.Assert;
+import org.junit.Test;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
+import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.io.ObjectInputStream;
+import java.io.ObjectOutputStream;
+import java.io.ObjectStreamException;
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.List;
+
+import nodomain.freeyourgadget.gadgetbridge.R;
+import nodomain.freeyourgadget.gadgetbridge.test.TestBase;
+
+public class WeatherMapperTest extends TestBase {
+    @Test
+    public void ensureConversionToKotlin() {
+
+        for (int i = 0; i <= 3200; i++) {
+            Assert.assertEquals(Weather.mapToPebbleCondition(i), WeatherMapper.INSTANCE.mapToPebbleCondition(i));
+            Assert.assertEquals(Weather.mapToYahooCondition(i), WeatherMapper.INSTANCE.mapToYahooCondition(i));
+            Assert.assertEquals(Weather.mapToOpenWeatherMapIcon(i), WeatherMapper.INSTANCE.mapToOpenWeatherMapIcon(i));
+            Assert.assertEquals(Weather.mapToOpenWeatherMapCondition(i), WeatherMapper.INSTANCE.mapToOpenWeatherMapCondition(i));
+            Assert.assertEquals(Weather.getConditionString(getContext(), i), WeatherMapper.INSTANCE.getConditionString(getContext(), i));
+            Assert.assertEquals(Weather.getAqiLevelString(getContext(), i), WeatherMapper.INSTANCE.getAqiLevelString(getContext(), i));
+            Assert.assertEquals(Weather.mapToZeTimeConditionOld(i), WeatherMapper.INSTANCE.mapToZeTimeConditionOld(i));
+            Assert.assertEquals(Weather.mapToZeTimeCondition(i), WeatherMapper.INSTANCE.mapToZeTimeCondition(i));
+            Assert.assertEquals(Weather.mapToCmfCondition(i), WeatherMapper.INSTANCE.mapToCmfCondition(i));
+            Assert.assertEquals(Weather.mapToFitProCondition(i), WeatherMapper.INSTANCE.mapToFitProCondition(i));
+        }
+    }
+
+    private class Weather {
+        private static final Logger LOG = LoggerFactory.getLogger(Weather.class);
+
+        private final ArrayList<WeatherSpec> weatherSpecs = new ArrayList<>();
+
+        private JSONObject reconstructedOWMForecast = null;
+
+        private File cacheFile;
+
+        private Weather() {
+            // Use getInstance
+        }
+
+        @Nullable
+        public WeatherSpec getWeatherSpec() {
+            if (weatherSpecs.isEmpty()) {
+                return null;
+            }
+
+            return weatherSpecs.get(0);
+        }
+
+        public List<WeatherSpec> getWeatherSpecs() {
+            return weatherSpecs;
+        }
+
+        public void setWeatherSpec(final Collection<WeatherSpec> newWeatherSpecs) {
+            weatherSpecs.clear();
+            weatherSpecs.addAll(newWeatherSpecs);
+            saveToCache();
+        }
+
+        @Nullable
+        public JSONObject createReconstructedOWMWeatherReply() {
+            final WeatherSpec weatherSpec = getWeatherSpec();
+            if (weatherSpec == null) {
+                return null;
+            }
+            JSONObject reconstructedOWMWeather = new JSONObject();
+            JSONArray weather = new JSONArray();
+            JSONObject condition = new JSONObject();
+            JSONObject main = new JSONObject();
+            JSONObject wind = new JSONObject();
+
+            try {
+                condition.put("id", weatherSpec.currentConditionCode);
+                condition.put("main", weatherSpec.currentCondition);
+                condition.put("description", weatherSpec.currentCondition);
+                condition.put("icon", Weather.mapToOpenWeatherMapIcon(weatherSpec.currentConditionCode));
+                weather.put(condition);
+
+
+                main.put("temp", weatherSpec.currentTemp);
+                main.put("humidity", weatherSpec.currentHumidity);
+                main.put("temp_min", weatherSpec.todayMinTemp);
+                main.put("temp_max", weatherSpec.todayMaxTemp);
+
+                wind.put("speed", (weatherSpec.windSpeed / 3.6f)); //meter per second
+                wind.put("deg", weatherSpec.windDirection);
+
+                reconstructedOWMWeather.put("weather", weather);
+                reconstructedOWMWeather.put("main", main);
+                reconstructedOWMWeather.put("name", weatherSpec.location);
+                reconstructedOWMWeather.put("wind", wind);
+
+            } catch (JSONException e) {
+                LOG.error("Error while reconstructing OWM weather reply");
+                return null;
+            }
+            LOG.debug("Weather JSON for WEBVIEW: " + reconstructedOWMWeather.toString());
+            return reconstructedOWMWeather;
+        }
+
+        public JSONObject getReconstructedOWMForecast() {
+            return reconstructedOWMForecast;
+        }
+
+        public void setReconstructedOWMForecast(JSONObject reconstructedOWMForecast) {
+            this.reconstructedOWMForecast = reconstructedOWMForecast;
+        }
+
+//        private static final Weather weather = new Weather();
+//        public static Weather getInstance() { return weather; }
+
+        public static byte mapToPebbleCondition(int openWeatherMapCondition) {
+/* deducted values:
+    0 = sun + cloud
+    1 = clouds
+    2 = some snow
+    3 = some rain
+    4 = heavy rain
+    5 = heavy snow
+    6 = sun + cloud + rain (default icon?)
+    7 = sun
+    8 = rain + snow
+    9 = 6
+    10, 11, ... = empty icon
+ */
+            switch (openWeatherMapCondition) {
+//Group 2xx: Thunderstorm
+                case 200:  //thunderstorm with light rain:  //11d
+                case 201:  //thunderstorm with rain:  //11d
+                case 202:  //thunderstorm with heavy rain:  //11d
+                case 210:  //light thunderstorm::  //11d
+                case 211:  //thunderstorm:  //11d
+                case 230:  //thunderstorm with light drizzle:  //11d
+                case 231:  //thunderstorm with drizzle:  //11d
+                case 232:  //thunderstorm with heavy drizzle:  //11d
+                case 212:  //heavy thunderstorm:  //11d
+                case 221:  //ragged thunderstorm:  //11d
+                    return 4;
+//Group 3xx: Drizzle
+                case 300:  //light intensity drizzle:  //09d
+                case 301:  //drizzle:  //09d
+                case 302:  //heavy intensity drizzle:  //09d
+                case 310:  //light intensity drizzle rain:  //09d
+                case 311:  //drizzle rain:  //09d
+                case 312:  //heavy intensity drizzle rain:  //09d
+                case 313:  //shower rain and drizzle:  //09d
+                case 314:  //heavy shower rain and drizzle:  //09d
+                case 321:  //shower drizzle:  //09d
+                case 500:  //light rain:  //10d
+                case 501:  //moderate rain:  //10d
+                    return 3;
+//Group 5xx: Rain
+                case 502:  //heavy intensity rain:  //10d
+                case 503:  //very heavy rain:  //10d
+                case 504:  //extreme rain:  //10d
+                case 511:  //freezing rain:  //13d
+                case 520:  //light intensity shower rain:  //09d
+                case 521:  //shower rain:  //09d
+                case 522:  //heavy intensity shower rain:  //09d
+                case 531:  //ragged shower rain:  //09d
+                    return 4;
+//Group 6xx: Snow
+                case 600:  //light snow:  //[[file:13d.png]]
+                case 601:  //snow:  //[[file:13d.png]]
+                case 620:  //light shower snow:  //[[file:13d.png]]
+                    return 2;
+                case 602:  //heavy snow:  //[[file:13d.png]]
+                case 611:  //sleet:  //[[file:13d.png]]
+                case 612:  //shower sleet:  //[[file:13d.png]]
+                case 621:  //shower snow:  //[[file:13d.png]]
+                case 622:  //heavy shower snow:  //[[file:13d.png]]
+                    return 5;
+                case 615:  //light rain and snow:  //[[file:13d.png]]
+                case 616:  //rain and snow:  //[[file:13d.png]]
+                    return 8;
+//Group 7xx: Atmosphere
+                case 701:  //mist:  //[[file:50d.png]]
+                case 711:  //smoke:  //[[file:50d.png]]
+                case 721:  //haze:  //[[file:50d.png]]
+                case 731:  //sandcase  dust whirls:  //[[file:50d.png]]
+                case 741:  //fog:  //[[file:50d.png]]
+                case 751:  //sand:  //[[file:50d.png]]
+                case 761:  //dust:  //[[file:50d.png]]
+                case 762:  //volcanic ash:  //[[file:50d.png]]
+                case 771:  //squalls:  //[[file:50d.png]]
+                case 781:  //tornado:  //[[file:50d.png]]
+                case 900:  //tornado
+                    return 6;
+//Group 800: Clear
+                case 800:  //clear sky:  //[[file:01d.png]] [[file:01n.png]]
+                    return 7;
+//Group 80x: Clouds
+                case 801:  //few clouds:  //[[file:02d.png]] [[file:02n.png]]
+                case 802:  //scattered clouds:  //[[file:03d.png]] [[file:03d.png]]
+                case 803:  //broken clouds:  //[[file:04d.png]] [[file:03d.png]]
+                case 804:  //overcast clouds:  //[[file:04d.png]] [[file:04d.png]]
+                    return 0;
+//Group 90x: Extreme
+                case 901:  //tropical storm
+                case 903:  //cold
+                case 904:  //hot
+                case 905:  //windy
+                case 906:  //hail
+//Group 9xx: Additional
+                case 951:  //calm
+                case 952:  //light breeze
+                case 953:  //gentle breeze
+                case 954:  //moderate breeze
+                case 955:  //fresh breeze
+                case 956:  //strong breeze
+                case 957:  //high windcase  near gale
+                case 958:  //gale
+                case 959:  //severe gale
+                case 960:  //storm
+                case 961:  //violent storm
+                case 902:  //hurricane
+                case 962:  //hurricane
+                default:
+                    return 6;
+
+            }
+        }
+
+        public static int mapToYahooCondition(int openWeatherMapCondition) {
+            // openweathermap.org conditions:
+            // http://openweathermap.org/weather-conditions
+            switch (openWeatherMapCondition) {
+//Group 2xx: Thunderstorm
+                case 200:  //thunderstorm with light rain:  //11d
+                case 201:  //thunderstorm with rain:  //11d
+                case 202:  //thunderstorm with heavy rain:  //11d
+                case 210:  //light thunderstorm::  //11d
+                case 211:  //thunderstorm:  //11d
+                case 230:  //thunderstorm with light drizzle:  //11d
+                case 231:  //thunderstorm with drizzle:  //11d
+                case 232:  //thunderstorm with heavy drizzle:  //11d
+                    return 4;
+                case 212:  //heavy thunderstorm:  //11d
+                case 221:  //ragged thunderstorm:  //11d
+                    return 3;
+//Group 3xx: Drizzle
+                case 300:  //light intensity drizzle:  //09d
+                case 301:  //drizzle:  //09d
+                case 302:  //heavy intensity drizzle:  //09d
+                case 310:  //light intensity drizzle rain:  //09d
+                case 311:  //drizzle rain:  //09d
+                case 312:  //heavy intensity drizzle rain:  //09d
+                    return 9;
+                case 313:  //shower rain and drizzle:  //09d
+                case 314:  //heavy shower rain and drizzle:  //09d
+                case 321:  //shower drizzle:  //09d
+                    return 11;
+//Group 5xx: Rain
+                case 500:  //light rain:  //10d
+                case 501:  //moderate rain:  //10d
+                case 502:  //heavy intensity rain:  //10d
+                case 503:  //very heavy rain:  //10d
+                case 504:  //extreme rain:  //10d
+                case 511:  //freezing rain:  //13d
+                    return 10;
+                case 520:  //light intensity shower rain:  //09d
+                    return 40;
+                case 521:  //shower rain:  //09d
+                case 522:  //heavy intensity shower rain:  //09d
+                case 531:  //ragged shower rain:  //09d
+                    return 12;
+//Group 6xx: Snow
+                case 600:  //light snow:  //[[file:13d.png]]
+                    return 7;
+                case 601:  //snow:  //[[file:13d.png]]
+                    return 16;
+                case 602:  //heavy snow:  //[[file:13d.png]]
+                    return 15;
+                case 611:  //sleet:  //[[file:13d.png]]
+                case 612:  //shower sleet:  //[[file:13d.png]]
+                    return 18;
+                case 615:  //light rain and snow:  //[[file:13d.png]]
+                case 616:  //rain and snow:  //[[file:13d.png]]
+                    return 5;
+                case 620:  //light shower snow:  //[[file:13d.png]]
+                    return 14;
+                case 621:  //shower snow:  //[[file:13d.png]]
+                    return 46;
+                case 622:  //heavy shower snow:  //[[file:13d.png]]
+//Group 7xx: Atmosphere
+                case 701:  //mist:  //[[file:50d.png]]
+                case 711:  //smoke:  //[[file:50d.png]]
+                    return 22;
+                case 721:  //haze:  //[[file:50d.png]]
+                    return 21;
+                case 731:  //sandcase  dust whirls:  //[[file:50d.png]]
+                    return 3200;
+                case 741:  //fog:  //[[file:50d.png]]
+                    return 20;
+                case 751:  //sand:  //[[file:50d.png]]
+                case 761:  //dust:  //[[file:50d.png]]
+                    return 19;
+                case 762:  //volcanic ash:  //[[file:50d.png]]
+                case 771:  //squalls:  //[[file:50d.png]]
+                    return 3200;
+                case 781:  //tornado:  //[[file:50d.png]]
+                case 900:  //tornado
+                    return 0;
+//Group 800: Clear
+                case 800:  //clear sky:  //[[file:01d.png]] [[file:01n.png]]
+                    return 32;
+//Group 80x: Clouds
+                case 801:  //few clouds:  //[[file:02d.png]] [[file:02n.png]]
+                case 802:  //scattered clouds:  //[[file:03d.png]] [[file:03d.png]]
+                    return 34;
+                case 803:  //broken clouds:  //[[file:04d.png]] [[file:03d.png]]
+                case 804:  //overcast clouds:  //[[file:04d.png]] [[file:04d.png]]
+                    return 44;
+//Group 90x: Extreme
+                case 901:  //tropical storm
+                    return 1;
+                case 903:  //cold
+                    return 25;
+                case 904:  //hot
+                    return 36;
+                case 905:  //windy
+                    return 24;
+                case 906:  //hail
+                    return 17;
+//Group 9xx: Additional
+                case 951:  //calm
+                case 952:  //light breeze
+                case 953:  //gentle breeze
+                case 954:  //moderate breeze
+                case 955:  //fresh breeze
+                    return 34;
+                case 956:  //strong breeze
+                case 957:  //high windcase  near gale
+                    return 24;
+                case 958:  //gale
+                case 959:  //severe gale
+                case 960:  //storm
+                case 961:  //violent storm
+                    return 3200;
+                case 902:  //hurricane
+                case 962:  //hurricane
+                    return 2;
+                default:
+                    return 3200;
+
+            }
+        }
+
+        public static String mapToOpenWeatherMapIcon(int openWeatherMapCondition) {
+            //see https://openweathermap.org/weather-conditions
+            String condition = "02d"; //generic "variable" icon
+
+            if (openWeatherMapCondition >= 200 && openWeatherMapCondition < 300) {
+                condition = "11d";
+            } else if (openWeatherMapCondition >= 300 && openWeatherMapCondition < 500) {
+                condition = "09d";
+            } else if (openWeatherMapCondition >= 500 && openWeatherMapCondition < 510) {
+                condition = "10d";
+            } else if (openWeatherMapCondition >= 511 && openWeatherMapCondition < 600) {
+                condition = "09d";
+            } else if (openWeatherMapCondition >= 600 && openWeatherMapCondition < 700) {
+                condition = "13d";
+            } else if (openWeatherMapCondition >= 700 && openWeatherMapCondition < 800) {
+                condition = "50d";
+            } else if (openWeatherMapCondition == 800) {
+                condition = "01d"; //TODO: night?
+            } else if (openWeatherMapCondition == 801) {
+                condition = "02d"; //TODO: night?
+            } else if (openWeatherMapCondition == 802) {
+                condition = "03d"; //TODO: night?
+            } else if (openWeatherMapCondition == 803 || openWeatherMapCondition == 804) {
+                condition = "04d"; //TODO: night?
+            }
+
+            return condition;
+        }
+
+        public static int mapToOpenWeatherMapCondition(int yahooCondition) {
+            switch (yahooCondition) {
+//yahoo weather conditions:
+//https://developer.yahoo.com/weather/documentation.html
+                case 0:  //tornado
+                    return 900;
+                case 1:  //tropical storm
+                    return 901;
+                case 2:  //hurricane
+                    return 962;
+                case 3:  //severe thunderstorms
+                    return 212;
+                case 4:  //thunderstorms
+                    return 211;
+                case 5:  //mixed rain and snow
+                case 6:  //mixed rain and sleet
+                    return 616;
+                case 7:  //mixed snow and sleet
+                    return 600;
+                case 8:  //freezing drizzle
+                case 9:  //drizzle
+                    return 301;
+                case 10:  //freezing rain
+                    return 511;
+                case 11:  //showers
+                case 12:  //showers
+                    return 521;
+                case 13:  //snow flurries
+                case 14:  //light snow showers
+                    return 620;
+                case 15:  //blowing snow
+                case 41:  //heavy snow
+                case 42:  //scattered snow showers
+                case 43:  //heavy snow
+                case 46:  //snow showers
+                    return 602;
+                case 16:  //snow
+                    return 601;
+                case 17:  //hail
+                case 35:  //mixed rain and hail
+                    return 906;
+                case 18:  //sleet
+                    return 611;
+                case 19:  //dust
+                    return 761;
+                case 20:  //foggy
+                    return 741;
+                case 21:  //haze
+                    return 721;
+                case 22:  //smoky
+                    return 711;
+                case 23:  //blustery
+                case 24:  //windy
+                    return 905;
+                case 25:  //cold
+                    return 903;
+                case 26:  //cloudy
+                case 27:  //mostly cloudy (night)
+                case 28:  //mostly cloudy (day)
+                    return 804;
+                case 29:  //partly cloudy (night)
+                case 30:  //partly cloudy (day)
+                    return 801;
+                case 31:  //clear (night)
+                case 32:  //sunny
+                    return 800;
+                case 33:  //fair (night)
+                case 34:  //fair (day)
+                    return 801;
+                case 36:  //hot
+                    return 904;
+                case 37:  //isolated thunderstorms
+                case 38:  //scattered thunderstorms
+                case 39:  //scattered thunderstorms
+                    return 210;
+                case 40:  //scattered showers
+                    return 520;
+                case 44:  //partly cloudy
+                    return 801;
+                case 45:  //thundershowers
+                case 47:  //isolated thundershowers
+                    return 211;
+                case 3200:  //not available
+                default:
+                    return -1;
+            }
+        }
+
+        public static String getConditionString(final Context context, int openWeatherMapCondition) {
+            switch (openWeatherMapCondition) {
+                case 200:
+                    return context.getString(R.string.weather_condition_thunderstorm_with_light_rain);
+                case 201:
+                    return context.getString(R.string.weather_condition_thunderstorm_with_rain);
+                case 202:
+                    return context.getString(R.string.weather_condition_thunderstorm_with_heavy_rain);
+                case 210:
+                    return context.getString(R.string.weather_condition_light_thunderstorm);
+                case 211:
+                    return context.getString(R.string.weather_condition_thunderstorm);
+                case 230:
+                    return context.getString(R.string.weather_condition_thunderstorm_with_light_drizzle);
+                case 231:
+                    return context.getString(R.string.weather_condition_thunderstorm_with_drizzle);
+                case 232:
+                    return context.getString(R.string.weather_condition_thunderstorm_with_heavy_drizzle);
+                case 212:
+                    return context.getString(R.string.weather_condition_heavy_thunderstorm);
+                case 221:
+                    return context.getString(R.string.weather_condition_ragged_thunderstorm);
+                // Group 3xx: Drizzle
+                case 300:
+                    return context.getString(R.string.weather_condition_light_intensity_drizzle);
+                case 301:
+                    return context.getString(R.string.weather_condition_drizzle);
+                case 302:
+                    return context.getString(R.string.weather_condition_heavy_intensity_drizzle);
+                case 310:
+                    return context.getString(R.string.weather_condition_light_intensity_drizzle_rain);
+                case 311:
+                    return context.getString(R.string.weather_condition_drizzle_rain);
+                case 312:
+                    return context.getString(R.string.weather_condition_heavy_intensity_drizzle_rain);
+                case 313:
+                    return context.getString(R.string.weather_condition_shower_rain_and_drizzle);
+                case 314:
+                    return context.getString(R.string.weather_condition_heavy_shower_rain_and_drizzle);
+                case 321:
+                    return context.getString(R.string.weather_condition_shower_drizzle);
+                // Group 5xx: Rain
+                case 500:
+                    return context.getString(R.string.weather_condition_light_rain);
+                case 501:
+                    return context.getString(R.string.weather_condition_moderate_rain);
+                case 502:
+                    return context.getString(R.string.weather_condition_heavy_intensity_rain);
+                case 503:
+                    return context.getString(R.string.weather_condition_very_heavy_rain);
+                case 504:
+                    return context.getString(R.string.weather_condition_extreme_rain);
+                case 511:
+                    return context.getString(R.string.weather_condition_freezing_rain);
+                case 520:
+                    return context.getString(R.string.weather_condition_light_intensity_shower_rain);
+                case 521:
+                    return context.getString(R.string.weather_condition_shower_rain);
+                case 522:
+                    return context.getString(R.string.weather_condition_heavy_intensity_shower_rain);
+                case 531:
+                    return context.getString(R.string.weather_condition_ragged_shower_rain);
+                // Group 6xx: Snow
+                case 600:
+                    return context.getString(R.string.weather_condition_light_snow);
+                case 601:
+                    return context.getString(R.string.weather_condition_snow);
+                case 620:
+                    return context.getString(R.string.weather_condition_light_shower_snow);
+                case 602:
+                    return context.getString(R.string.weather_condition_heavy_snow);
+                case 611:
+                    return context.getString(R.string.weather_condition_sleet);
+                case 612:
+                    return context.getString(R.string.weather_condition_shower_sleet);
+                case 621:
+                    return context.getString(R.string.weather_condition_shower_snow);
+                case 622:
+                    return context.getString(R.string.weather_condition_heavy_shower_snow);
+                case 615:
+                    return context.getString(R.string.weather_condition_light_rain_and_snow);
+                case 616:
+                    return context.getString(R.string.weather_condition_rain_and_snow);
+                // Group 7xx: Atmosphere
+                case 701:
+                    return context.getString(R.string.weather_condition_mist);
+                case 711:
+                    return context.getString(R.string.weather_condition_smoke);
+                case 721:
+                    return context.getString(R.string.weather_condition_haze);
+                case 731:
+                    return context.getString(R.string.weather_condition_sandcase_dust_whirls);
+                case 741:
+                    return context.getString(R.string.weather_condition_fog);
+                case 751:
+                    return context.getString(R.string.weather_condition_sand);
+                case 761:
+                    return context.getString(R.string.weather_condition_dust);
+                case 762:
+                    return context.getString(R.string.weather_condition_volcanic_ash);
+                case 771:
+                    return context.getString(R.string.weather_condition_squalls);
+                case 781:
+                    return context.getString(R.string.weather_condition_tornado);
+                case 900:
+                    return context.getString(R.string.weather_condition_tornado);
+                case 800:
+                    return context.getString(R.string.weather_condition_clear_sky);
+                // Group 80x: Clouds
+                case 801:
+                    return context.getString(R.string.weather_condition_few_clouds);
+                case 802:
+                    return context.getString(R.string.weather_condition_scattered_clouds);
+                case 803:
+                    return context.getString(R.string.weather_condition_broken_clouds);
+                case 804:
+                    return context.getString(R.string.weather_condition_overcast_clouds);
+                // Group 90x: Extreme
+                case 901:
+                    return context.getString(R.string.weather_condition_tropical_storm);
+                case 903:
+                    return context.getString(R.string.weather_condition_cold);
+                case 904:
+                    return context.getString(R.string.weather_condition_hot);
+                case 905:
+                    return context.getString(R.string.weather_condition_windy);
+                case 906:
+                    return context.getString(R.string.weather_condition_hail);
+                // Group 9xx: Additional
+                case 951:
+                    return context.getString(R.string.weather_condition_calm);
+                case 952:
+                    return context.getString(R.string.weather_condition_light_breeze);
+                case 953:
+                    return context.getString(R.string.weather_condition_gentle_breeze);
+                case 954:
+                    return context.getString(R.string.weather_condition_moderate_breeze);
+                case 955:
+                    return context.getString(R.string.weather_condition_fresh_breeze);
+                case 956:
+                    return context.getString(R.string.weather_condition_strong_breeze);
+                case 957:
+                    return context.getString(R.string.weather_condition_high_windcase_near_gale);
+                case 958:
+                    return context.getString(R.string.weather_condition_gale);
+                case 959:
+                    return context.getString(R.string.weather_condition_severe_gale);
+                case 960:
+                    return context.getString(R.string.weather_condition_storm);
+                case 961:
+                    return context.getString(R.string.weather_condition_violent_storm);
+                case 902:
+                    return context.getString(R.string.weather_condition_hurricane);
+                case 962:
+                    return context.getString(R.string.weather_condition_hurricane);
+                default:
+                    return "";
+            }
+        }
+
+        public static String getAqiLevelString(final Context context, int aqi) {
+            // Uses the [2023 Plume index](https://plumelabs.files.wordpress.com/2023/06/plume_aqi_2023.pdf) as a reference
+            if (aqi < 0) {
+                return context.getString(R.string.aqi_level_unknown);
+            }
+            if (aqi < 20) {
+                return context.getString(R.string.aqi_level_excellent);
+            } else if (aqi < 50) {
+                return context.getString(R.string.aqi_level_fair);
+            } else if (aqi < 100) {
+                return context.getString(R.string.aqi_level_poor);
+            } else if (aqi < 150) {
+                return context.getString(R.string.aqi_level_unhealthy);
+            } else if (aqi < 250) {
+                return context.getString(R.string.aqi_level_very_unhealthy);
+            } else {
+                return context.getString(R.string.aqi_level_dangerous);
+            }
+        }
+
+        public static byte mapToZeTimeConditionOld(int openWeatherMapCondition) {
+/* deducted values:
+    0 = partly cloudy
+    1 = cloudy
+    2 = sunny
+    3 = windy/gale
+    4 = heavy rain
+    5 = snowy
+    6 = storm
+ */
+            switch (openWeatherMapCondition) {
+//Group 2xx: Thunderstorm
+                case 200:  //thunderstorm with light rain:  //11d
+                case 201:  //thunderstorm with rain:  //11d
+                case 202:  //thunderstorm with heavy rain:  //11d
+                case 210:  //light thunderstorm::  //11d
+                case 211:  //thunderstorm:  //11d
+                case 230:  //thunderstorm with light drizzle:  //11d
+                case 231:  //thunderstorm with drizzle:  //11d
+                case 232:  //thunderstorm with heavy drizzle:  //11d
+                case 212:  //heavy thunderstorm:  //11d
+                case 221:  //ragged thunderstorm:  //11d
+//Group 7xx: Atmosphere
+                case 771:  //squalls:  //[[file:50d.png]]
+                case 781:  //tornado:  //[[file:50d.png]]
+//Group 90x: Extreme
+                case 900:  //tornado
+                case 901:  //tropical storm
+//Group 9xx: Additional
+                case 960:  //storm
+                case 961:  //violent storm
+                case 902:  //hurricane
+                case 962:  //hurricane
+                    return 6;
+//Group 3xx: Drizzle
+                case 300:  //light intensity drizzle:  //09d
+                case 301:  //drizzle:  //09d
+                case 302:  //heavy intensity drizzle:  //09d
+                case 310:  //light intensity drizzle rain:  //09d
+                case 311:  //drizzle rain:  //09d
+                case 312:  //heavy intensity drizzle rain:  //09d
+                case 313:  //shower rain and drizzle:  //09d
+                case 314:  //heavy shower rain and drizzle:  //09d
+                case 321:  //shower drizzle:  //09d
+//Group 5xx: Rain
+                case 500:  //light rain:  //10d
+                case 501:  //moderate rain:  //10d
+                case 502:  //heavy intensity rain:  //10d
+                case 503:  //very heavy rain:  //10d
+                case 504:  //extreme rain:  //10d
+                case 511:  //freezing rain:  //13d
+                case 520:  //light intensity shower rain:  //09d
+                case 521:  //shower rain:  //09d
+                case 522:  //heavy intensity shower rain:  //09d
+                case 531:  //ragged shower rain:  //09d
+//Group 90x: Extreme
+                case 906:  //hail
+                    return 4;
+//Group 6xx: Snow
+                case 600:  //light snow:  //[[file:13d.png]]
+                case 601:  //snow:  //[[file:13d.png]]
+                case 620:  //light shower snow:  //[[file:13d.png]]
+                case 602:  //heavy snow:  //[[file:13d.png]]
+                case 611:  //sleet:  //[[file:13d.png]]
+                case 612:  //shower sleet:  //[[file:13d.png]]
+                case 621:  //shower snow:  //[[file:13d.png]]
+                case 622:  //heavy shower snow:  //[[file:13d.png]]
+                case 615:  //light rain and snow:  //[[file:13d.png]]
+                case 616:  //rain and snow:  //[[file:13d.png]]
+//Group 90x: Extreme
+                case 903:  //cold
+                    return 5;
+//Group 7xx: Atmosphere
+                case 701:  //mist:  //[[file:50d.png]]
+                case 711:  //smoke:  //[[file:50d.png]]
+                case 721:  //haze:  //[[file:50d.png]]
+                case 731:  //sandcase  dust whirls:  //[[file:50d.png]]
+                case 741:  //fog:  //[[file:50d.png]]
+                case 751:  //sand:  //[[file:50d.png]]
+                case 761:  //dust:  //[[file:50d.png]]
+                case 762:  //volcanic ash:  //[[file:50d.png]]
+                    return 1;
+//Group 800: Clear
+                case 800:  //clear sky:  //[[file:01d.png]] [[file:01n.png]]
+//Group 90x: Extreme
+                case 904:  //hot
+                    return 2;
+//Group 80x: Clouds
+                case 801:  //few clouds:  //[[file:02d.png]] [[file:02n.png]]
+                case 802:  //scattered clouds:  //[[file:03d.png]] [[file:03d.png]]
+                case 803:  //broken clouds:  //[[file:04d.png]] [[file:03d.png]]
+                case 804:  //overcast clouds:  //[[file:04d.png]] [[file:04d.png]]
+                default:
+                    return 0;
+
+//Group 9xx: Additional
+                case 905:  //windy
+                case 951:  //calm
+                case 952:  //light breeze
+                case 953:  //gentle breeze
+                case 954:  //moderate breeze
+                case 955:  //fresh breeze
+                case 956:  //strong breeze
+                case 957:  //high windcase  near gale
+                case 958:  //gale
+                case 959:  //severe gale
+                    return 3;
+            }
+        }
+
+        public static byte mapToZeTimeCondition(int openWeatherMapCondition) {
+/* deducted values:
+    0 = tornado
+    1 = typhoon
+    2 = hurricane
+    3 = thunderstorm
+    4 = rain and snow
+    5 = unavailable
+    6 = freezing rain
+    7 = drizzle
+    8 = showers
+    9 = snow flurries
+    10 = blowing snow
+    11 = snow
+    12 = sleet
+    13 = foggy
+    14 = windy
+    15 = cloudy
+    16 = partly cloudy (night)
+    17 = partly cloudy (day)
+    18 = clear night
+    19 = sunny
+    20 = thundershower
+    21 = hot
+    22 = scattered thunders
+    23 = snow showers
+    24 = heavy snow
+ */
+            switch (openWeatherMapCondition) {
+//Group 2xx: Thunderstorm
+                case 210:  //light thunderstorm::  //11d
+                    return 22;
+
+//Group 2xx: Thunderstorm
+                case 200:  //thunderstorm with light rain:  //11d
+                case 201:  //thunderstorm with rain:  //11d
+                case 202:  //thunderstorm with heavy rain:  //11d
+                case 230:  //thunderstorm with light drizzle:  //11d
+                case 231:  //thunderstorm with drizzle:  //11d
+                case 232:  //thunderstorm with heavy drizzle:  //11d
+                    return 20;
+
+//Group 2xx: Thunderstorm
+                case 211:  //thunderstorm:  //11d
+                case 212:  //heavy thunderstorm:  //11d
+                case 221:  //ragged thunderstorm:  //11d
+                    return 3;
+
+//Group 7xx: Atmosphere
+                case 781:  //tornado:  //[[file:50d.png]]
+//Group 90x: Extreme
+                case 900:  //tornado
+                    return 0;
+
+//Group 90x: Extreme
+                case 901:  //tropical storm
+                    return 1;
+
+// Group 7xx: Atmosphere
+                case 771:  //squalls:  //[[file:50d.png]]
+//Group 9xx: Additional
+                case 960:  //storm
+                case 961:  //violent storm
+                case 902:  //hurricane
+                case 962:  //hurricane
+                    return 2;
+
+//Group 3xx: Drizzle
+                case 300:  //light intensity drizzle:  //09d
+                case 301:  //drizzle:  //09d
+                case 302:  //heavy intensity drizzle:  //09d
+                case 310:  //light intensity drizzle rain:  //09d
+                case 311:  //drizzle rain:  //09d
+                case 312:  //heavy intensity drizzle rain:  //09d
+                case 313:  //shower rain and drizzle:  //09d
+                case 314:  //heavy shower rain and drizzle:  //09d
+                case 321:  //shower drizzle:  //09d
+                    return 7;
+
+//Group 5xx: Rain
+                case 500:  //light rain:  //10d
+                case 501:  //moderate rain:  //10d
+                case 502:  //heavy intensity rain:  //10d
+                case 503:  //very heavy rain:  //10d
+                case 504:  //extreme rain:  //10d
+                case 520:  //light intensity shower rain:  //09d
+                case 521:  //shower rain:  //09d
+                case 522:  //heavy intensity shower rain:  //09d
+                case 531:  //ragged shower rain:  //09d
+//Group 90x: Extreme
+                case 906:  //hail
+                    return 8;
+
+//Group 5xx: Rain
+                case 511:  //freezing rain:  //13d
+                    return 6;
+
+//Group 6xx: Snow
+                case 620:  //light shower snow:  //[[file:13d.png]]
+                case 621:  //shower snow:  //[[file:13d.png]]
+                case 622:  //heavy shower snow:  //[[file:13d.png]]
+                    return 23;
+
+//Group 6xx: Snow
+                case 615:  //light rain and snow:  //[[file:13d.png]]
+                case 616:  //rain and snow:  //[[file:13d.png]]
+                    return 4;
+
+//Group 6xx: Snow
+                case 611:  //sleet:  //[[file:13d.png]]
+                case 612:  //shower sleet:  //[[file:13d.png]]
+                    return 12;
+
+//Group 6xx: Snow
+                case 600:  //light snow:  //[[file:13d.png]]
+                case 601:  //snow:  //[[file:13d.png]]
+                    return 11;
+//Group 6xx: Snow
+                case 602:  //heavy snow:  //[[file:13d.png]]
+                    return 24;
+
+//Group 7xx: Atmosphere
+                case 701:  //mist:  //[[file:50d.png]]
+                case 711:  //smoke:  //[[file:50d.png]]
+                case 721:  //haze:  //[[file:50d.png]]
+                case 731:  //sandcase  dust whirls:  //[[file:50d.png]]
+                case 741:  //fog:  //[[file:50d.png]]
+                case 751:  //sand:  //[[file:50d.png]]
+                case 761:  //dust:  //[[file:50d.png]]
+                case 762:  //volcanic ash:  //[[file:50d.png]]
+                    return 13;
+
+//Group 800: Clear
+                case 800:  //clear sky:  //[[file:01d.png]] [[file:01n.png]]
+                    return 19;
+
+//Group 90x: Extreme
+                case 904:  //hot
+                    return 21;
+
+//Group 80x: Clouds
+                case 801:  //few clouds:  //[[file:02d.png]] [[file:02n.png]]
+                case 802:  //scattered clouds:  //[[file:03d.png]] [[file:03d.png]]
+                case 803:  //broken clouds:  //[[file:04d.png]] [[file:03d.png]]
+                    return 17;
+
+//Group 80x: Clouds
+                case 804:  //overcast clouds:  //[[file:04d.png]] [[file:04d.png]]
+                    return 15;
+
+//Group 9xx: Additional
+                case 905:  //windy
+                case 951:  //calm
+                case 952:  //light breeze
+                case 953:  //gentle breeze
+                case 954:  //moderate breeze
+                case 955:  //fresh breeze
+                case 956:  //strong breeze
+                case 957:  //high windcase  near gale
+                case 958:  //gale
+                case 959:  //severe gale
+                    return 14;
+
+                default:
+//Group 90x: Extreme
+                case 903:  //cold
+                    return 5;
+            }
+        }
+        public static byte mapToCmfCondition(int openWeatherMapCondition) {
+/* deducted values:
+    1 = sunny
+    2 = cloudy
+    3 = overcast
+    4 = showers
+    5 = snow showers
+    6 = fog
+
+    9 = thunder showers
+
+    14 = sleet
+
+    19 = hot (extreme)
+    20 = cold (extreme)
+
+    21 = strong wind
+    22 = (night) sunny - with moon
+    23 = (night) sunny with stars
+    24 = (night) cloudy - with moon
+    25 = sun with haze
+    26 = cloudy (sun with cloud)
+ */
+            switch (openWeatherMapCondition) {
+//Group 2xx: Thunderstorm
+                case 210:  //light thunderstorm::  //11d
+                case 200:  //thunderstorm with light rain:  //11d
+                case 201:  //thunderstorm with rain:  //11d
+                case 202:  //thunderstorm with heavy rain:  //11d
+                case 230:  //thunderstorm with light drizzle:  //11d
+                case 231:  //thunderstorm with drizzle:  //11d
+                case 232:  //thunderstorm with heavy drizzle:  //11d
+                case 211:  //thunderstorm:  //11d
+                case 212:  //heavy thunderstorm:  //11d
+                case 221:  //ragged thunderstorm:  //11d
+                    return 9;
+
+//Group 90x: Extreme
+                case 901:  //tropical storm
+//Group 7xx: Atmosphere
+                case 781:  //tornado:  //[[file:50d.png]]
+//Group 90x: Extreme
+                case 900:  //tornado
+// Group 7xx: Atmosphere
+                case 771:  //squalls:  //[[file:50d.png]]
+//Group 9xx: Additional
+                case 960:  //storm
+                case 961:  //violent storm
+                case 902:  //hurricane
+                case 962:  //hurricane
+                    return 21;
+
+//Group 3xx: Drizzle
+                case 300:  //light intensity drizzle:  //09d
+                case 301:  //drizzle:  //09d
+                case 302:  //heavy intensity drizzle:  //09d
+                case 310:  //light intensity drizzle rain:  //09d
+                case 311:  //drizzle rain:  //09d
+                case 312:  //heavy intensity drizzle rain:  //09d
+                case 313:  //shower rain and drizzle:  //09d
+                case 314:  //heavy shower rain and drizzle:  //09d
+                case 321:  //shower drizzle:  //09d
+//Group 5xx: Rain
+                case 500:  //light rain:  //10d
+                case 501:  //moderate rain:  //10d
+                case 502:  //heavy intensity rain:  //10d
+                case 503:  //very heavy rain:  //10d
+                case 504:  //extreme rain:  //10d
+                case 520:  //light intensity shower rain:  //09d
+                case 521:  //shower rain:  //09d
+                case 522:  //heavy intensity shower rain:  //09d
+                case 531:  //ragged shower rain:  //09d
+                    return 4;
+
+//Group 90x: Extreme
+                case 906:  //hail
+                case 615:  //light rain and snow:  //[[file:13d.png]]
+                case 616:  //rain and snow:  //[[file:13d.png]]
+                case 511:  //freezing rain:  //13d
+                    return 14;
+
+//Group 6xx: Snow
+                case 611:  //sleet:  //[[file:13d.png]]
+                case 612:  //shower sleet:  //[[file:13d.png]]
+//Group 6xx: Snow
+                case 600:  //light snow:  //[[file:13d.png]]
+                case 601:  //snow:  //[[file:13d.png]]
+//Group 6xx: Snow
+                case 602:  //heavy snow:  //[[file:13d.png]]
+//Group 6xx: Snow
+                case 620:  //light shower snow:  //[[file:13d.png]]
+                case 621:  //shower snow:  //[[file:13d.png]]
+                case 622:  //heavy shower snow:  //[[file:13d.png]]
+                    return 5;
+
+
+//Group 7xx: Atmosphere
+                case 701:  //mist:  //[[file:50d.png]]
+                case 711:  //smoke:  //[[file:50d.png]]
+                case 721:  //haze:  //[[file:50d.png]]
+                case 731:  //sandcase  dust whirls:  //[[file:50d.png]]
+                case 741:  //fog:  //[[file:50d.png]]
+                case 751:  //sand:  //[[file:50d.png]]
+                case 761:  //dust:  //[[file:50d.png]]
+                case 762:  //volcanic ash:  //[[file:50d.png]]
+                    return 6;
+
+//Group 800: Clear
+                case 800:  //clear sky:  //[[file:01d.png]] [[file:01n.png]]
+                    return 1;
+
+//Group 90x: Extreme
+                case 904:  //hot
+                    return 19;
+
+//Group 80x: Clouds
+                case 801:  //few clouds:  //[[file:02d.png]] [[file:02n.png]]
+                case 802:  //scattered clouds:  //[[file:03d.png]] [[file:03d.png]]
+                    return 26;
+                case 803:  //broken clouds:  //[[file:04d.png]] [[file:03d.png]]
+                    return 2;
+
+//Group 80x: Clouds
+                case 804:  //overcast clouds:  //[[file:04d.png]] [[file:04d.png]]
+                    return 3;
+
+//Group 9xx: Additional
+                case 905:  //windy
+                case 951:  //calm
+                case 952:  //light breeze
+                case 953:  //gentle breeze
+                case 954:  //moderate breeze
+                case 955:  //fresh breeze
+                case 956:  //strong breeze
+                case 957:  //high windcase  near gale
+                case 958:  //gale
+                case 959:  //severe gale
+                    return 21;
+
+                default:
+//Group 90x: Extreme
+                case 903:  //cold
+                    return 20;
+            }
+        }
+
+        public static byte mapToFitProCondition(int openWeatherMapCondition) {
+            switch (openWeatherMapCondition) {
+                case 100:
+                    return 1;
+                case 104:
+                    return 2;
+                case 101:
+                case 102:
+                case 103:
+                    return 3;
+                case 305:
+                case 309:
+                    return 4;
+                case 306:
+                case 314:
+                case 399:
+                    return 5;
+                case 307:
+                case 308:
+                case 310:
+                case 311:
+                case 312:
+                case 315:
+                case 316:
+                case 317:
+                case 318:
+                    return 6;
+                case 300:
+                case 301:
+                case 302:
+                case 303:
+                    return 7;
+                case 400:
+                case 407:
+                    return 8;
+                case 401:
+                case 408:
+                case 499:
+                    return 9;
+                case 402:
+                case 403:
+                case 409:
+                case 410:
+                    return 10;
+                case 404:
+                case 405:
+                case 406:
+                    return 11;
+                case 500:
+                case 501:
+                case 502:
+                case 509:
+                case 510:
+                case 511:
+                case 512:
+                case 513:
+                case 514:
+                case 515:
+                    return 12;
+                case 304:
+                case 313:
+                    return 13;
+                case 503:
+                case 504:
+                case 507:
+                case 508:
+                    return 14;
+                case 200:
+                case 201:
+                case 202:
+                case 203:
+                case 204:
+                    return 15;
+                case 205:
+                case 206:
+                case 207:
+                case 208:
+                    return 16;
+                case 209:
+                case 210:
+                case 211:
+                    return 17;
+                case 212:
+                    return 18;
+                case 231:
+                    return 19;
+                default:
+                    return 3;
+            }
+        }
+
+        /**
+         * Set the weather cache file. If enabled and the current weather is null, load the cache file.
+         *
+         * @param cacheDir the cache directory, where the cache file will be created
+         * @param enabled whether caching is enabled
+         */
+        public void setCacheFile(final File cacheDir, final boolean enabled) {
+            // FIXME: Do not use serializable for this
+
+            cacheFile = new File(cacheDir, "weatherCache.bin");
+
+            if (enabled) {
+                LOG.info("Setting weather cache file to {}", cacheFile.getPath());
+
+                if (cacheFile.isFile() && weatherSpecs.isEmpty()) {
+                    try (final ObjectInputStream o = new ObjectInputStream(new FileInputStream(cacheFile))) {
+                        final ArrayList<WeatherSpec> cachedSpecs = (ArrayList<WeatherSpec>) o.readObject();
+                        weatherSpecs.addAll(cachedSpecs);
+                    } catch (final ObjectStreamException e) {
+                        LOG.error("Failed to deserialize weather from cache", e);
+                        // keep cacheFile set - it's most likely an older version
+                    } catch (final IOException e) {
+                        LOG.error("Failed to read weather cache file", e);
+                        // Something is wrong with the file
+                        cacheFile = null;
+                    } catch (final Throwable e) {
+                        LOG.error("Failed to read weather from cache", e);
+                        // keep cacheFile set - it's most likely an older version
+                    }
+                } else if (!weatherSpecs.isEmpty()) {
+                    saveToCache();
+                }
+            } else {
+                if (cacheFile.isFile()) {
+                    LOG.info("Deleting weather cache file {}", cacheFile.getPath());
+
+                    try {
+                        cacheFile.delete();
+                    } catch (final Throwable e) {
+                        LOG.error("Failed to delete cache file", e);
+                        cacheFile = null;
+                    }
+                }
+            }
+        }
+
+        /**
+         * Save the current weather to cache, if a cache file is enabled and the weather is not null.
+         */
+        public void saveToCache() {
+            if (weatherSpecs.isEmpty() || cacheFile == null) {
+                return;
+            }
+
+            LOG.info("Loading weather from cache {}", cacheFile.getPath());
+
+            try (ObjectOutputStream o = new ObjectOutputStream(new FileOutputStream(cacheFile))) {
+                o.writeObject(weatherSpecs);
+            } catch (final Throwable e) {
+                LOG.error("Failed to save weather to cache", e);
+            }
+        }
+    }
+}
```
-----------------------------------
