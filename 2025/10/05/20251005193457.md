# Commit: d9cfcc025ebdfed452039ef08def6a8c457fe1cf
## Message: Huawei: extend weather
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiCoordinator.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/Weather.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWeatherManager.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendWeatherCurrentRequest.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendWeatherForecastRequest.java

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiCoordinator.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiCoordinator.java
index 69e911eaee..bcfd3d4831 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiCoordinator.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiCoordinator.java
@@ -638,6 +638,10 @@ public class HuaweiCoordinator {
         return supportsExpandCapability(0x2f);
     }
 
+    public boolean supportsWeatherExtendedHourForecast() {
+        return supportsExpandCapability(0xc0);
+    }
+
     public boolean supportsWorkouts() {
         return supportsCommandForService(0x17, 0x01);
     }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/Weather.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/Weather.java
index 8f5142363e..6398809498 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/Weather.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/Weather.java
@@ -43,6 +43,7 @@ public class Weather {
         public boolean timeSupported = false;
         public boolean sourceSupported = false;
         public boolean weatherIconSupported = false;
+        public boolean extendedHourlyForecast = false;
 
         // WeatherSunMoonSupport
         public boolean sunRiseSetSupported = false;
@@ -382,7 +383,10 @@ public class Weather {
                 Short airQualityIndex,
                 Integer observationTime,
                 Float uvIndex,
-                String sourceName
+                String sourceName,
+                Byte humidity,
+                Integer windSpeedValue,
+                Integer feelLikeTemperature
         ) {
             super(paramsProvider);
 
@@ -438,6 +442,16 @@ public class Weather {
             if (uvIndex != null && settings.uvIndexSupported)
                 this.tlv.put(0x0f, uvIndex.byteValue());
 
+            if(settings.extendedHourlyForecast) {
+                if(humidity != null)
+                    this.tlv.put(0x10, humidity);
+                if(windSpeedValue != null)
+                    this.tlv.put(0x11, windSpeedValue);
+                if(feelLikeTemperature != null)
+                    this.tlv.put(0x12, feelLikeTemperature);
+
+            }
+
             this.isEncrypted = true;
             this.complete = true;
         }
@@ -586,6 +600,8 @@ public class Weather {
             public int timestamp;
             public WeatherIcon icon;
             public Byte temperature;
+            public Byte precipitation;
+            public Byte uvIndex;
 
             @NonNull
             @Override
@@ -596,6 +612,8 @@ public class Weather {
                         ", timestamp=" + timestampStr +
                         ", icon=" + icon +
                         ", temperature=" + temperature +
+                        ", precipitation=" + precipitation +
+                        ", uvIndex=" + uvIndex +
                         '}';
             }
         }
@@ -652,6 +670,14 @@ public class Weather {
                             timeTlv.put(0x04, iconToByte(timeData.icon));
                         if (timeData.temperature != null && (settings.temperatureSupported || settings.currentTemperatureSupported))
                             timeTlv.put(0x05, timeData.temperature);
+                        if(settings.extendedHourlyForecast) {
+                            if (timeData.precipitation != null) {
+                                timeTlv.put(0x06, timeData.precipitation);
+                            }
+                            if (timeData.uvIndex != null) {
+                                timeTlv.put(0x07, timeData.uvIndex);
+                            }
+                        }
                         timeDataTlv.put(0x82, timeTlv);
                     }
                     this.tlv.put(0x81, timeDataTlv);
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWeatherManager.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWeatherManager.java
index 3192cf470f..653f16807f 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWeatherManager.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWeatherManager.java
@@ -227,6 +227,7 @@ public class HuaweiWeatherManager {
 
         Weather.Settings weatherSettings = new Weather.Settings();
         weatherSettings.uvIndexSupported = supportProvider.getHuaweiCoordinator().supportsWeatherUvIndex();
+        weatherSettings.extendedHourlyForecast = supportProvider.getHuaweiCoordinator().supportsWeatherExtendedHourForecast();
 
         SendWeatherStartRequest weatherStartRequest = new SendWeatherStartRequest(supportProvider, weatherSettings);
         weatherStartRequest.setFinalizeReq(errorHandler);
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendWeatherCurrentRequest.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendWeatherCurrentRequest.java
index 5d3f3fcefb..dfc715b80e 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendWeatherCurrentRequest.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendWeatherCurrentRequest.java
@@ -66,7 +66,10 @@ public class SendWeatherCurrentRequest extends Request {
                     aqi,
                     weatherSpec.getTimestamp(),
                     weatherSpec.getUvIndex(),
-                    "Gadgetbridge"
+                    "Gadgetbridge",
+                    (byte) weatherSpec.getCurrentHumidity(),
+                    (int) weatherSpec.getWindSpeed(),
+                    (weatherSpec.getFeelsLikeTemp() - 273)
                 ).serialize();
         } catch (HuaweiPacket.CryptoException e) {
             throw new RequestCreationException(e);
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendWeatherForecastRequest.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendWeatherForecastRequest.java
index f205b48d27..e96b2c4339 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendWeatherForecastRequest.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendWeatherForecastRequest.java
@@ -50,6 +50,8 @@ public class SendWeatherForecastRequest extends Request {
             timeData.timestamp = hourly.getTimestamp();
             timeData.icon = supportProvider.openWeatherMapConditionCodeToHuaweiIcon(hourly.getConditionCode());
             timeData.temperature = (byte) (hourly.getTemp() - 273);
+            timeData.precipitation = (byte) hourly.getPrecipProbability();
+            timeData.uvIndex = (byte) hourly.getUvIndex();
             timeDataArrayList.add(timeData);
         }
 
```
-----------------------------------
