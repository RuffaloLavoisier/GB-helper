# Commit: f5e015ff57f73cfeb35db8a966b6aa11a00b6c1c
## Message: ui: optionally disable fetching new data from connected devices when swiping down

1) add new preference Settings / User interface / refresh on swipe
2) adjusted ControlCenterv2, AbstractChartsActivity and WorkoutListActivity
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/ControlCenterv2.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/AbstractChartsActivity.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/workouts/WorkoutListActivity.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/GBPrefs.java

app/src/main/res/values/strings.xml

app/src/main/res/xml/preferences.xml

app/src/main/res/drawable/ic_swipe_down.xml

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/ControlCenterv2.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/ControlCenterv2.java
index 44ffebe4c4..ca64677fa0 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/ControlCenterv2.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/ControlCenterv2.java
@@ -76,8 +76,8 @@ import nodomain.freeyourgadget.gadgetbridge.util.AndroidUtils;
 import nodomain.freeyourgadget.gadgetbridge.util.DeviceHelper;
 import nodomain.freeyourgadget.gadgetbridge.util.GB;
 import nodomain.freeyourgadget.gadgetbridge.util.GBChangeLog;
+import nodomain.freeyourgadget.gadgetbridge.util.GBPrefs;
 import nodomain.freeyourgadget.gadgetbridge.util.PermissionsUtils;
-import nodomain.freeyourgadget.gadgetbridge.util.Prefs;
 
 //TODO: extend AbstractGBActivity, but it requires actionbar that is not available
 public class ControlCenterv2 extends AppCompatActivity
@@ -149,7 +149,7 @@ public class ControlCenterv2 extends AppCompatActivity
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_main);
 
-        Prefs prefs = GBApplication.getPrefs();
+        GBPrefs prefs = GBApplication.getPrefs();
 
         // Determine availability of device with activity tracking functionality
         boolean activityTrackerAvailable = false;
@@ -259,17 +259,21 @@ public class ControlCenterv2 extends AppCompatActivity
         // Set pull-down-to-refresh action
         swipeLayout = findViewById(R.id.dashboard_swipe_layout);
         swipeLayout.setOnRefreshListener(() -> {
-            // Fetch activity for all connected devices
-            GBApplication.deviceService().onFetchRecordedData(RecordedDataTypes.TYPE_SYNC);
-            // Hide 'refreshing' animation immediately if no health devices are connected
-            List<GBDevice> devices1 = GBApplication.app().getDeviceManager().getDevices();
-            for (GBDevice dev : devices1) {
-                if (dev.getDeviceCoordinator().supportsActivityDataFetching(dev) && dev.isInitialized()) {
-                    return;
+            if (prefs.refreshOnSwipe()) {
+                // Fetch activity for all connected devices
+                GBApplication.deviceService().onFetchRecordedData(RecordedDataTypes.TYPE_SYNC);
+                // Hide 'refreshing' animation immediately if no health devices are connected
+                List<GBDevice> devices1 = GBApplication.app().getDeviceManager().getDevices();
+                for (GBDevice dev : devices1) {
+                    if (dev.getDeviceCoordinator().supportsActivityDataFetching(dev) && dev.isInitialized()) {
+                        return;
+                    }
                 }
+                swipeLayout.setRefreshing(false);
+                GB.toast(getString(R.string.info_no_devices_connected), Toast.LENGTH_LONG, GB.WARN);
+            } else {
+                swipeLayout.setRefreshing(false);
             }
-            swipeLayout.setRefreshing(false);
-            GB.toast(getString(R.string.info_no_devices_connected), Toast.LENGTH_LONG, GB.WARN);
         });
 
         // Set up local intent listener
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/AbstractChartsActivity.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/AbstractChartsActivity.java
index d97909222e..23f68efc9c 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/AbstractChartsActivity.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/AbstractChartsActivity.java
@@ -16,7 +16,6 @@
     along with this program.  If not, see <https://www.gnu.org/licenses/>. */
 package nodomain.freeyourgadget.gadgetbridge.activities.charts;
 
-import android.app.Activity;
 import android.app.DatePickerDialog;
 import android.content.BroadcastReceiver;
 import android.content.Context;
@@ -341,7 +340,7 @@ public abstract class AbstractChartsActivity extends AbstractGBFragmentActivity
 
     @Override
     public void enableSwipeRefresh(final boolean enable) {
-        swipeLayout.setEnabled(enable && allowRefresh());
+        swipeLayout.setEnabled(enable && GBApplication.getPrefs().refreshOnSwipe() && allowRefresh());
     }
 
     protected abstract boolean supportsRefresh();
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/workouts/WorkoutListActivity.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/workouts/WorkoutListActivity.kt
index a6755d7141..2b1509de41 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/workouts/WorkoutListActivity.kt
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/workouts/WorkoutListActivity.kt
@@ -187,7 +187,13 @@ class WorkoutListActivity : AbstractListActivity<BaseActivitySummary>() {
         setItemAdapter(workoutSummariesAdapter)
 
         swipeLayout = findViewById(R.id.list_activity_swipe_layout)
-        swipeLayout.setOnRefreshListener { fetchTrackData() }
+        swipeLayout.setOnRefreshListener {
+            if (GBApplication.getPrefs().refreshOnSwipe()) {
+                fetchTrackData()
+            } else {
+                swipeLayout.isRefreshing = false
+            }
+        }
 
         val fab: FloatingActionButton = findViewById(R.id.fab)
         fab.setOnClickListener { fetchTrackData() }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/GBPrefs.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/GBPrefs.java
index 9f4ee1ffc3..78abade6e4 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/GBPrefs.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/GBPrefs.java
@@ -183,4 +183,8 @@ public class GBPrefs extends Prefs {
     public boolean syncTime() {
         return getBoolean("datetime_synconconnect", true);
     }
+
+    public boolean refreshOnSwipe() {
+        return getBoolean("pref_refresh_on_swipe", true);
+    }
 }
diff --git a/app/src/main/res/drawable/ic_swipe_down.xml b/app/src/main/res/drawable/ic_swipe_down.xml
new file mode 100644
index 0000000000..361b270757
--- /dev/null
+++ b/app/src/main/res/drawable/ic_swipe_down.xml
@@ -0,0 +1,10 @@
+<vector xmlns:android="http://schemas.android.com/apk/res/android"
+    android:width="24dp"
+    android:height="24dp"
+    android:viewportWidth="960"
+    android:viewportHeight="960"
+    android:tint="?attr/colorControlNormal">
+  <path
+      android:fillColor="@android:color/white"
+      android:pathData="M180,600L40,460L82,418L152,488Q146,461 143,434Q140,407 140,380Q140,298 167,221Q194,144 245,80L288,123Q245,179 222.5,244.5Q200,310 200,380Q200,406 203,431.5Q206,457 213,482L278,418L320,460L180,600ZM658,833Q635,841 611.5,840.5Q588,840 566,829L304,707L322,667Q332,647 350,634.5Q368,622 390,620L458,615L346,308Q340,292 347,277.5Q354,263 370,257Q386,251 400.5,258Q415,265 421,281L569,688L469,695L600,756Q607,759 615,759.5Q623,760 630,758L787,701Q818,690 832,659.5Q846,629 835,598L780,448Q774,432 781,417.5Q788,403 804,397Q820,391 834.5,398Q849,405 855,421L910,571Q933,634 905.5,693.5Q878,753 815,776L658,833ZM568,568L514,417Q508,401 515,386.5Q522,372 538,366Q554,360 568.5,367Q583,374 589,390L644,540L568,568ZM681,527L640,414Q634,398 641,383.5Q648,369 664,363Q680,357 694.5,364Q709,371 715,387L756,499L681,527ZM689,605L689,605L689,605Q689,605 689,605Q689,605 689,605L689,605Q689,605 689,605Q689,605 689,605L689,605L689,605Z"/>
+</vector>
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index 4641d4d44f..06ee6781b7 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -3893,6 +3893,8 @@
     <string name="pref_import_activity_files_summary">Manually import activity files from the phone storage</string>
     <string name="pref_fetch_unknown_files_title">Fetch unknown files</string>
     <string name="pref_fetch_unknown_files_summary">Fetch unknown activity files from the watch. They will not be processed, but will be saved in the phone.</string>
+    <string name="pref_refresh_on_swipe_summary">Swipe down to fetch new data from connected devices.</string>
+    <string name="pref_refresh_on_swipe_title">Refresh on swipe</string>
     <string name="cannot_upload_watchface_too_many_watchfaces_installed">Cannot upload watchface, too many watchfaces installed</string>
     <string name="insufficient_space_for_upload">Insufficient space for upload</string>
     <string name="file_already_exists">File already exists</string>
diff --git a/app/src/main/res/xml/preferences.xml b/app/src/main/res/xml/preferences.xml
index db2b66b5f9..401ae0683a 100644
--- a/app/src/main/res/xml/preferences.xml
+++ b/app/src/main/res/xml/preferences.xml
@@ -202,6 +202,14 @@
             android:summary="@string/pref_summary_block_screenshots"
             android:title="@string/pref_title_block_screenshot" />
 
+        <SwitchPreferenceCompat
+            android:defaultValue="true"
+            android:icon="@drawable/ic_swipe_down"
+            android:key="pref_refresh_on_swipe"
+            android:layout="@layout/preference_checkbox"
+            android:summary="@string/pref_refresh_on_swipe_summary"
+            android:title="@string/pref_refresh_on_swipe_title" />
+
         <PreferenceCategory
             android:key="pref_screen_theme"
             android:title="@string/pref_header_main_screen"
```
-----------------------------------
