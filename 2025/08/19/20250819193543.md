# Commit: c45374fd12255bf16bf84a9e94fd1ca8cb8f122d
## Message: Huawei: code cleanup and refactoring
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/Watchface.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiFwHelper.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWatchfaceManager.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SetLanguageSettingRequest.java

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/Watchface.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/Watchface.java
index 5ffb8954eb..0a4058ad8b 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/Watchface.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/Watchface.java
@@ -37,9 +37,9 @@ public class Watchface {
     }
 
     public static class InstalledWatchfaceInfo {
-        public String fileName = "";
-        public String version = "";
-        public byte type = 0;
+        public String fileName;
+        public String version;
+        public byte type;
         // bit 0 - is current
         // bit 1 - is factory preset
         // bit 2 - ???
@@ -47,42 +47,43 @@ public class Watchface {
         // bit 4 - video
         // bit 5 - photo
         // bit 6 - tryout (trial version)
-        // bit 7 - kaleidoskop
-        public byte expandedtype = 0;
+        // bit 7 - kaleidoscope
+        public byte expandedType = 0;
 
         public InstalledWatchfaceInfo(HuaweiTLV tlv) throws HuaweiPacket.MissingTagException {
             this.fileName = tlv.getString(0x03);
             this.version = tlv.getString(0x04);
             this.type = tlv.getByte(0x05);
             if (tlv.contains(0x07)) // optional
-                this.expandedtype = tlv.getByte(0x07);
+                this.expandedType = tlv.getByte(0x07);
         }
 
         public boolean isCurrent() {
             return (this.type & 1) == 1;
         }
         public boolean isFactory() {
-            return ((this.type  >> 1 )& 1) == 1;
+            return ((this.type >> 1) & 1) == 1;
         }
         public boolean isEditable() {
-            return ((this.type  >> 3 )& 1) == 1;
+            return ((this.type >> 3) & 1) == 1;
         }
         public boolean isVideo() {
-            return ((this.type  >> 4 )& 1) == 1;
+            return ((this.type >> 4) & 1) == 1;
         }
         public boolean isPhoto() {
-            return ((this.type  >> 5 )& 1) == 1;
+            return ((this.type >> 5) & 1) == 1;
         }
         public boolean isTryout() {
-            return ((this.type  >> 6 )& 1) == 1;
+            return ((this.type >> 6) & 1) == 1;
         }
-        public boolean isKaleidoskop() {
-            return ((this.type  >> 7 )& 1) == 1;
+        public boolean isKaleidoscope() {
+            return ((this.type >> 7) & 1) == 1;
         }
     }
 
     public static class WatchfaceParams {
         public static final byte id = 0x01;
+
         public static class Request extends HuaweiPacket {
 
             public Request(ParamsProvider paramsProvider) {
@@ -105,7 +106,8 @@ public class Watchface {
 
         public static class Response extends HuaweiPacket {
             public WatchfaceDeviceParams params = new WatchfaceDeviceParams();
-            public Response (ParamsProvider paramsProvider) {
+
+            public Response(ParamsProvider paramsProvider) {
                 super(paramsProvider);
             }
 
@@ -145,14 +147,15 @@ public class Watchface {
         public static class Response extends HuaweiPacket {
 
             public List<InstalledWatchfaceInfo> watchfaceInfoList;
-            public Response (ParamsProvider paramsProvider) {
+
+            public Response(ParamsProvider paramsProvider) {
                 super(paramsProvider);
             }
 
             @Override
             public void parseTlv() throws HuaweiPacket.ParseException {
                 watchfaceInfoList = new ArrayList<>();
-                if(this.tlv.contains(0x81)) {
+                if (this.tlv.contains(0x81)) {
                     for (HuaweiTLV subTlv : this.tlv.getObject(0x81).getObjects(0x82)) {
                         watchfaceInfoList.add(new Watchface.InstalledWatchfaceInfo(subTlv));
                     }
@@ -164,7 +167,7 @@ public class Watchface {
     public static class WatchfaceOperation {
         public static final byte id = 0x03;
 
-        public static final byte  operationActive = 1;
+        public static final byte operationActive = 1;
         public static final byte operationDelete = 2;
 
         public static class Request extends HuaweiPacket {
@@ -182,7 +185,7 @@ public class Watchface {
         }
 
         public static class Response extends HuaweiPacket {
-            public Response (ParamsProvider paramsProvider) {
+            public Response(ParamsProvider paramsProvider) {
                 super(paramsProvider);
             }
         }
@@ -197,13 +200,10 @@ public class Watchface {
                 super(paramsProvider);
                 this.serviceId = Watchface.id;
                 this.commandId = id;
-                String file = fileName.split("_")[0];
-                String version = "";
-                try {
-                    version = fileName.split("_")[1];
-                } catch (ArrayIndexOutOfBoundsException e) {
 
-                }
+                final String[] splitData = fileName.split("_");
+                final String file = splitData[0];
+                final String version = (splitData.length > 1) ? splitData[1] : "";
                 this.tlv = new HuaweiTLV()
                         .put(0x01, file)
                         .put(0x02, version)
@@ -214,7 +214,8 @@ public class Watchface {
         public static class Response extends HuaweiPacket {
             public byte reportType = 0;
             public String fileName;
-            public Response (ParamsProvider paramsProvider) {
+
+            public Response(ParamsProvider paramsProvider) {
                 super(paramsProvider);
             }
 
@@ -222,7 +223,7 @@ public class Watchface {
             public void parseTlv() throws HuaweiPacket.ParseException {
                 String name = this.tlv.getString(0x01);
                 String version = this.tlv.getString(0x02);
-                if(this.tlv.contains(0x03)) {
+                if (this.tlv.contains(0x03)) {
                     this.reportType = this.tlv.getByte(0x03);
                 }
                 this.fileName = name + "_" + version;
@@ -257,13 +258,14 @@ public class Watchface {
 
         public static class Response extends HuaweiPacket {
             public HashMap<String, String> watchFaceNames = new HashMap<>();
-            public Response (ParamsProvider paramsProvider) {
+
+            public Response(ParamsProvider paramsProvider) {
                 super(paramsProvider);
             }
 
             @Override
             public void parseTlv() throws HuaweiPacket.ParseException {
-                if(this.tlv.contains(0x82)) {
+                if (this.tlv.contains(0x82)) {
                     for (HuaweiTLV subTlv : this.tlv.getObject(0x82).getObjects(0x83)) {
                         watchFaceNames.put(subTlv.getString(0x04), subTlv.getString(0x05));
                     }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiFwHelper.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiFwHelper.java
index 7875041390..331fb6143d 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiFwHelper.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiFwHelper.java
@@ -263,7 +263,7 @@ public class HuaweiFwHelper {
                 previewBitmap = BitmapFactory.decodeByteArray(preview, 0, preview.length);
             }
 
-            String watchfacePath="";
+            String watchfacePath;
             if (watchfaceDescription.isHonor) {
                 watchfacePath ="com.honor.watchface";
             } else {
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWatchfaceManager.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWatchfaceManager.java
index c893cb5532..f8b85f22bf 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWatchfaceManager.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiWatchfaceManager.java
@@ -29,6 +29,7 @@ import java.io.StringReader;
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.List;
+import java.util.Locale;
 import java.util.Map;
 import java.util.Random;
 import java.util.UUID;
@@ -44,13 +45,13 @@ import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests.GetW
 import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests.Request;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests.SendWatchfaceOperation;
 
-public class HuaweiWatchfaceManager
-{
+public class HuaweiWatchfaceManager {
     static Logger LOG = LoggerFactory.getLogger(HuaweiCoordinator.class);
 
     public static class Resolution {
 
-        Map<String, Object> map = new HashMap<>();
+        Map<String, String> map = new HashMap<>();
+
         public Resolution() {
             // Huawei sizes    "height*width"
             map.put("HWHD01", "390*390");
@@ -68,29 +69,24 @@ public class HuaweiWatchfaceManager
             map.put("HWHD13", "480*408");
             //Honor sizes
             map.put("HNHD01", "466*466");
-            map.put("HNHD02","368*194");
-            map.put("HNHD03","450*390");
-            map.put("HNHD04","454*454");
-            map.put("QXHD01","402*256");
-            map.put("QXHD02","502*410");
+            map.put("HNHD02", "368*194");
+            map.put("HNHD03", "450*390");
+            map.put("HNHD04", "454*454");
+            map.put("QXHD01", "402*256");
+            map.put("QXHD02", "502*410");
         }
 
-        public boolean  isValid(String themeVersion, String screenResolution) {
-            if(!map.containsKey(themeVersion))
+        public boolean isValid(String themeVersion, String screenResolution) {
+            if (!map.containsKey(themeVersion))
                 return false;
-            String screen = map.get(themeVersion).toString();
-            if (screenResolution.equals(screen)) {
-                return true;
-            } else {
-                return false;
-            }
+            String screen = map.get(themeVersion);
+            return screenResolution.equals(screen);
         }
 
         public String screenByThemeVersion(String themeVersion) {
-            if(!map.containsKey(themeVersion))
+            if (!map.containsKey(themeVersion))
                 return "0x0";
-            String screen = map.get(themeVersion).toString();
-            return screen;
+            return map.get(themeVersion);
         }
 
     }
@@ -115,6 +111,7 @@ public class HuaweiWatchfaceManager
                 return "";
             }
         }
+
         public WatchfaceDescription(String xmlStr) {
             DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
             DocumentBuilder builder;
@@ -133,13 +130,13 @@ public class HuaweiWatchfaceManager
                 }
 
                 this.title = parseElement(doc, "title");
-                this.title_cn = parseElement(doc,"title-cn");
-                this.author = parseElement(doc,"author");
-                this.designer = parseElement(doc,"designer");
-                this.screen = parseElement(doc,"screen");
-                this.version = parseElement(doc,"version");
-                this.font = parseElement(doc,"font");
-                this.font_cn = parseElement(doc,"font-cn");
+                this.title_cn = parseElement(doc, "title-cn");
+                this.author = parseElement(doc, "author");
+                this.designer = parseElement(doc, "designer");
+                this.screen = parseElement(doc, "screen");
+                this.version = parseElement(doc, "version");
+                this.font = parseElement(doc, "font");
+                this.font_cn = parseElement(doc, "font-cn");
 
             } catch (Exception e) {
                 LOG.warn("exception in constructor", e);
@@ -150,7 +147,7 @@ public class HuaweiWatchfaceManager
     private List<Watchface.InstalledWatchfaceInfo> installedWatchfaceInfoList;
     private HashMap<String, String> watchfacesNames;
 
-    private HuaweiSupportProvider support;
+    private final HuaweiSupportProvider support;
 
     public HuaweiWatchfaceManager(HuaweiSupportProvider support) {
         this.support = support;
@@ -160,27 +157,19 @@ public class HuaweiWatchfaceManager
         this.installedWatchfaceInfoList = list;
     }
 
-    public List<Watchface.InstalledWatchfaceInfo> getInstalledWatchfaceInfoList()
-    {
+    public List<Watchface.InstalledWatchfaceInfo> getInstalledWatchfaceInfoList() {
         return installedWatchfaceInfoList;
     }
 
-    public void  setWatchfacesNames(HashMap<String, String> map) {
+    public void setWatchfacesNames(HashMap<String, String> map) {
         this.watchfacesNames = map;
     }
 
 
     public String getRandomName() {
         Random random = new Random();
-
-        String res="";
-        for (int i = 0; i < 9; i++) {
-            int ran = random.nextInt(9);
-            res += String.valueOf(ran);
-        }
-
-        res += "_1.0.0";
-        return res;
+        int value = random.nextInt(1_000_000_000); // 0..999,999,999
+        return String.format(Locale.ROOT, "%09d_1.0.0", value);
     }
 
     public static UUID toWatchfaceUUID(final String id) {
@@ -241,7 +230,6 @@ public class HuaweiWatchfaceManager
         } catch (IOException e) {
             LOG.error("Could not get watchface names", e);
         }
-
     }
 
     public void requestWatchfaceList() {
@@ -257,7 +245,6 @@ public class HuaweiWatchfaceManager
             }
         };
 
-
         try {
             GetWatchfacesList getWatchfacesList = new GetWatchfacesList(support);
             getWatchfacesList.setFinalizeReq(finalizeReq);
@@ -265,8 +252,7 @@ public class HuaweiWatchfaceManager
         } catch (IOException e) {
             LOG.error("Failed to get watchfaces list", e);
         }
-
-    };
+    }
 
     public void setWatchface(UUID uuid) {
         Request.RequestCallback finalizeReq = new Request.RequestCallback() {
@@ -325,7 +311,6 @@ public class HuaweiWatchfaceManager
                 break;
             }
         }
-        String filename = name + "_" + version;
-        return filename;
+        return name + "_" + version;
     }
 }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SetLanguageSettingRequest.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SetLanguageSettingRequest.java
index 125b4dbbfd..d4d5e09d39 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SetLanguageSettingRequest.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SetLanguageSettingRequest.java
@@ -51,21 +51,21 @@ public class SetLanguageSettingRequest extends Request {
         String localeString = GBApplication
             .getDeviceSpecificSharedPrefs(supportProvider.getDevice().getAddress())
             .getString(DeviceSettingsPreferenceConst.PREF_LANGUAGE, "auto");
-        if (localeString == null || localeString.equals("auto")) {
+        if (localeString.equals("auto")) {
             String language = Locale.getDefault().getLanguage();
             String country = Locale.getDefault().getCountry();
-            if (country.equals("")) {
+            if (country.isEmpty()) {
                 country = language;
             }
             localeString = language + "-" + country.toUpperCase();
         } else {
             localeString = localeString.replace("_", "-");
         }
-        LOG.debug("localeString: " + localeString);
+        LOG.debug("localeString: {}", localeString);
         String measurementString = GBApplication
             .getPrefs()
             .getString(SettingsActivity.PREF_MEASUREMENT_SYSTEM, getContext().getString(R.string.p_unit_metric));
-        LOG.debug("measurementString: " + measurementString);
+        LOG.debug("measurementString: {}", measurementString);
         byte measurement = measurementString.equals("metric") ? LocaleConfig.MeasurementSystem.metric : LocaleConfig.MeasurementSystem.imperial;
         try {
             return new SetLanguageSetting(paramsProvider, localeString.getBytes(StandardCharsets.UTF_8), measurement).serialize();
```
-----------------------------------
