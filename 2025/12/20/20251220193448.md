# Commit: f005db7e1de5a23a4b38432848969749bae4f6d2
## Message: Discard sleep sessions that are too small
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/SleepAnalysis.java

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/SleepAnalysis.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/SleepAnalysis.java
index 57e6194a23..7bb7c1f346 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/SleepAnalysis.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/SleepAnalysis.java
@@ -49,7 +49,9 @@ public class SleepAnalysis {
                 durationSinceLastSleep = 0;
             } else {
                 //exclude "not worn" times from sleep sessions as this makes a discrepancy with the charts
-                if (lightSleepDuration + deepSleepDuration + remSleepDuration + awakeSleepDuration > MIN_SESSION_LENGTH)
+                final boolean validTimes = sleepStart != null && sleepEnd != null && sleepEnd.getTime() - sleepStart.getTime() > MIN_SESSION_LENGTH;
+                final long durationLengths = lightSleepDuration + deepSleepDuration + remSleepDuration + awakeSleepDuration;
+                if (validTimes && durationLengths > MIN_SESSION_LENGTH)
                     result.add(new SleepSession(sleepStart, sleepEnd, lightSleepDuration, deepSleepDuration, remSleepDuration, awakeSleepDuration));
                 sleepStart = null;
                 sleepEnd = null;
```
-----------------------------------
