# Commit: 7ff237bdfdd00dc6af331a5efa61d9ed05fa6cd4
## Message: Prevent companion device connection with bluetooth off
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/BluetoothConnectReceiver.java

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/BluetoothConnectReceiver.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/BluetoothConnectReceiver.java
index 0c4d9b374e..fd082e11b2 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/BluetoothConnectReceiver.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/externalevents/BluetoothConnectReceiver.java
@@ -19,6 +19,7 @@ package nodomain.freeyourgadget.gadgetbridge.externalevents;
 import static nodomain.freeyourgadget.gadgetbridge.impl.GBDevice.State.WAITING_FOR_RECONNECT;
 import static nodomain.freeyourgadget.gadgetbridge.impl.GBDevice.State.WAITING_FOR_SCAN;
 
+import android.bluetooth.BluetoothAdapter;
 import android.bluetooth.BluetoothDevice;
 import android.content.BroadcastReceiver;
 import android.content.Context;
@@ -63,7 +64,7 @@ public class BluetoothConnectReceiver extends BroadcastReceiver {
        observedDevice(address);
     }
 
-    public static void observedDevice(String address) {
+    public static void observedDevice(final String address) {
         final DeviceManager manager = GBApplication.app().getDeviceManager();
         final GBDevice gbDevice = manager.getDeviceByAddress(address);
         if (gbDevice == null) {
@@ -71,6 +72,15 @@ public class BluetoothConnectReceiver extends BroadcastReceiver {
             return;
         }
 
+        final BluetoothAdapter adapter = BluetoothAdapter.getDefaultAdapter();
+        if (adapter == null) {
+            LOG.warn("Bluetooth adapter not found - ignoring observed device");
+            return;
+        } else if (!adapter.isEnabled()) {
+            LOG.warn("Bluetooth adapter is disabled - ignoring observed device");
+            return;
+        }
+
         final GBDevice.State state = gbDevice.getState();
         if (state == WAITING_FOR_RECONNECT || state == WAITING_FOR_SCAN) {
             LOG.debug("re-connecting to observed device due to state {}", state);
```
-----------------------------------
