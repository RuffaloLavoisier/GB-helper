# Commit: 05b9e6cdc56e3abc4f7d60183b81beba0e9406fb
## Message: Add iniital exprimental support for Zendure SolarFlow devices (so far only reads a few values)

Also generalizes the SolarEquipmentStatus activity to share with Marstek B2500
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/marstek/SolarEquipmentStatusActivity.java

app/src/main/AndroidManifest.xml

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/DeviceCoordinator.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/marstek/MarstekB2500DeviceCoordinator.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/DeviceType.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/marstek/MarstekB2500DeviceSupport.java

app/src/main/res/layout/activity_solar_equipment_status.xml

app/src/main/res/values/strings.xml

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/SolarEquipmentStatusActivity.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/zendure/SolarFlowDeviceCoordinator.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/zendure/SolarFlowDeviceSupport.java

## Diff:
```
diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml
index fcf6619498..6487a9f8c4 100644
--- a/app/src/main/AndroidManifest.xml
+++ b/app/src/main/AndroidManifest.xml
@@ -980,7 +980,7 @@
             android:exported="true" />
 
         <activity
-            android:name=".devices.marstek.SolarEquipmentStatusActivity"
+            android:name=".devices.SolarEquipmentStatusActivity"
             android:label="Solar Equipment Status"
             android:exported="true" />
 
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/DeviceCoordinator.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/DeviceCoordinator.java
index 1337e3d377..b65a5b365a 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/DeviceCoordinator.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/DeviceCoordinator.java
@@ -150,6 +150,7 @@ public interface DeviceCoordinator {
         BIKE_COMPUTER,
         SMART_CLOCK,
         THERMOMETER,
+        PV_EQUIPMENT,
     }
 
     /**
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/marstek/SolarEquipmentStatusActivity.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/SolarEquipmentStatusActivity.java
similarity index 78%
rename from app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/marstek/SolarEquipmentStatusActivity.java
rename to app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/SolarEquipmentStatusActivity.java
index 30dd60f476..f00b3b4ed7 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/marstek/SolarEquipmentStatusActivity.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/SolarEquipmentStatusActivity.java
@@ -14,7 +14,7 @@
 
     You should have received a copy of the GNU Affero General Public License
     along with this program.  If not, see <https://www.gnu.org/licenses/>. */
-package nodomain.freeyourgadget.gadgetbridge.devices.marstek;
+package nodomain.freeyourgadget.gadgetbridge.devices;
 
 import android.content.BroadcastReceiver;
 import android.content.Context;
@@ -23,6 +23,7 @@ import android.content.IntentFilter;
 import android.os.Bundle;
 import android.view.LayoutInflater;
 import android.view.View;
+import android.view.ViewGroup;
 import android.widget.ImageView;
 import android.widget.TextView;
 import android.widget.Toast;
@@ -51,6 +52,8 @@ public class SolarEquipmentStatusActivity extends AbstractGBActivity {
     public static String EXTRA_BATTERY_WH = "battery_wh";
     public static String EXTRA_PANEL1_WATT = "panel1_watt";
     public static String EXTRA_PANEL2_WATT = "panel2_watt";
+    public static String EXTRA_PANEL3_WATT = "panel3_watt";
+    public static String EXTRA_PANEL4_WATT = "panel4_watt";
     public static String EXTRA_OUTPUT1_WATT = "output1_watt";
     public static String EXTRA_OUTPUT2_WATT = "output2_watt";
     public static String EXTRA_TEMP1 = "temp1";
@@ -71,19 +74,56 @@ public class SolarEquipmentStatusActivity extends AbstractGBActivity {
                     int battery_wh = extras.getInt(EXTRA_BATTERY_WH);
                     int panel1_watt = extras.getInt(EXTRA_PANEL1_WATT);
                     int panel2_watt = extras.getInt(EXTRA_PANEL2_WATT);
+                    int panel3_watt = extras.getInt(EXTRA_PANEL3_WATT);
+                    int panel4_watt = extras.getInt(EXTRA_PANEL4_WATT);
                     int temp1 = extras.getInt(EXTRA_TEMP1);
                     int temp2 = extras.getInt(EXTRA_TEMP2);
                     int output1_watt = extras.getInt(EXTRA_OUTPUT1_WATT);
                     int output2_watt = extras.getInt(EXTRA_OUTPUT2_WATT);
                     String debug = extras.getString(EXTRA_DEBUG);
-                    updateGaugeWidget("battery", battery_pct + "%\n" + battery_wh + "Wh", (float) (battery_pct / 100.0));
-                    updateGaugeWidget("panel1", panel1_watt + "W", (float) (panel1_watt / 380.0));
-                    updateGaugeWidget("panel2", panel2_watt + "W", (float) (panel2_watt / 380.0));
+
+                    if (battery_wh >0) {
+                        updateGaugeWidget("battery", battery_pct + "%\n" + battery_wh + "Wh", (float) (battery_pct / 100.0));
+                    }
+                    else {
+                        updateGaugeWidget("battery", battery_pct + "%", (float) (battery_pct / 100.0));
+                    }
+                    if (panel1_watt >= 0) {
+                        updateGaugeWidget("panel1", panel1_watt + "W", (float) (panel1_watt / 380.0));
+                    } else {
+                        removeWidget("panel1");
+                    }
+                    if (panel2_watt >= 0) {
+                        updateGaugeWidget("panel2", panel2_watt + "W", (float) (panel2_watt / 380.0));
+                    } else {
+                        removeWidget("panel2");
+                    }
+                    if (panel3_watt >= 0) {
+                        updateGaugeWidget("panel3", panel3_watt + "W", (float) (panel3_watt / 380.0));
+                    } else {
+                        removeWidget("panel3");
+                    }
+                    if (panel4_watt >= 0) {
+                        updateGaugeWidget("panel4", panel4_watt + "W", (float) (panel4_watt / 380.0));
+                    } else {
+                        removeWidget("panel4");
+                    }
                     updateGaugeWidget("temp1", temp1 + "°C", (float) ((temp1 + 20) / 100.0));
                     updateGaugeWidget("temp2", temp2 + "°C", (float) ((temp2 + 20) / 100.0));
-                    updateGaugeWidget("output1", output1_watt + "W", (float) (output1_watt / 400.0));
-                    updateGaugeWidget("output2", output2_watt + "W", (float) (output2_watt / 400.0));
-                    updateTextWidget("debug",debug);
+                    if (output1_watt >= 0) {
+                        updateGaugeWidget("output1", output1_watt + "W", (float) (output1_watt / 400.0));
+                    } else {
+                        removeWidget("output1");
+                    }
+                    if (output2_watt >= 0) {
+                        updateGaugeWidget("output2", output2_watt + "W", (float) (output1_watt / 400.0));
+                    }
+                    if (debug != null) {
+                        updateTextWidget("debug", debug);
+                    }
+                    else {
+                        removeWidget("debug");
+                    }
                     swipeLayout.setRefreshing(false);
                 }
             }
@@ -172,6 +212,17 @@ public class SolarEquipmentStatusActivity extends AbstractGBActivity {
         }
     }
 
+    private void removeWidget(String name) {
+        View view = widgetMap.get(name);
+        if (view != null) {
+            ViewGroup parent = (ViewGroup) view.getParent();
+            if (parent != null) {
+                ((ViewGroup) parent.getParent()).removeView(parent);
+                widgetMap.remove(name);
+            }
+        }
+    }
+
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         Bundle extras = getIntent().getExtras();
@@ -183,6 +234,8 @@ public class SolarEquipmentStatusActivity extends AbstractGBActivity {
         gridLayout = findViewById(R.id.solarequipmentview_gridlayout);
         createWidget("panel1", "Panel 1", 1);
         createWidget("panel2", "Panel 2", 1);
+        createWidget("panel3", "Panel 3", 1);
+        createWidget("panel4", "Panel 4", 1);
         createWidget("battery", "Battery", 2);
         createWidget("temp1", "Temp 1", 1);
         createWidget("temp2", "Temp 2", 1);
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/marstek/MarstekB2500DeviceCoordinator.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/marstek/MarstekB2500DeviceCoordinator.java
index caa5758d82..5a1ea465ed 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/marstek/MarstekB2500DeviceCoordinator.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/marstek/MarstekB2500DeviceCoordinator.java
@@ -26,6 +26,7 @@ import java.util.regex.Pattern;
 import nodomain.freeyourgadget.gadgetbridge.R;
 import nodomain.freeyourgadget.gadgetbridge.devices.AbstractBLEDeviceCoordinator;
 import nodomain.freeyourgadget.gadgetbridge.devices.DeviceCoordinator;
+import nodomain.freeyourgadget.gadgetbridge.devices.SolarEquipmentStatusActivity;
 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
 import nodomain.freeyourgadget.gadgetbridge.service.DeviceSupport;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.marstek.MarstekB2500DeviceSupport;
@@ -89,6 +90,6 @@ public class MarstekB2500DeviceCoordinator extends AbstractBLEDeviceCoordinator
 
     @Override
     public DeviceCoordinator.DeviceKind getDeviceKind(@NonNull GBDevice device) {
-        return DeviceCoordinator.DeviceKind.UNKNOWN;
+        return DeviceKind.PV_EQUIPMENT;
     }
 }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/zendure/SolarFlowDeviceCoordinator.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/zendure/SolarFlowDeviceCoordinator.java
new file mode 100644
index 0000000000..a2ed3f5a89
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/zendure/SolarFlowDeviceCoordinator.java
@@ -0,0 +1,98 @@
+/*  Copyright (C) 2024 Andreas Shimokawa
+
+    This file is part of Gadgetbridge.
+
+    Gadgetbridge is free software: you can redistribute it and/or modify
+    it under the terms of the GNU Affero General Public License as published
+    by the Free Software Foundation, either version 3 of the License, or
+    (at your option) any later version.
+
+    Gadgetbridge is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU Affero General Public License for more details.
+
+    You should have received a copy of the GNU Affero General Public License
+    along with this program.  If not, see <https://www.gnu.org/licenses/>. */
+package nodomain.freeyourgadget.gadgetbridge.devices.zendure;
+
+
+import android.app.Activity;
+import android.bluetooth.le.ScanFilter;
+import android.os.ParcelUuid;
+
+import androidx.annotation.NonNull;
+
+import java.util.Collection;
+import java.util.Collections;
+import java.util.UUID;
+import java.util.regex.Pattern;
+
+import nodomain.freeyourgadget.gadgetbridge.R;
+import nodomain.freeyourgadget.gadgetbridge.devices.AbstractBLEDeviceCoordinator;
+import nodomain.freeyourgadget.gadgetbridge.devices.SolarEquipmentStatusActivity;
+import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
+import nodomain.freeyourgadget.gadgetbridge.service.DeviceSupport;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.zendure.SolarFlowDeviceSupport;
+
+
+public class SolarFlowDeviceCoordinator extends AbstractBLEDeviceCoordinator {
+    @Override
+    public int getDeviceNameResource() {
+        return R.string.devicetype_solarflow;
+    }
+
+    @Override
+    public int getDefaultIconResource() {
+        return R.drawable.ic_device_vesc;
+    }
+
+    @Override
+    public String getManufacturer() {
+        return "Zendure";
+    }
+
+    @NonNull
+    @Override
+    public Class<? extends DeviceSupport> getDeviceSupportClass(final GBDevice device) {
+        return SolarFlowDeviceSupport.class;
+    }
+
+    @NonNull
+    @Override
+    public Collection<? extends ScanFilter> createBLEScanFilters() {
+        ParcelUuid solarflowService = new ParcelUuid(UUID.fromString("0000a002-0000-1000-8000-00805f9b34fb"));
+        ScanFilter filter = new ScanFilter.Builder().setServiceUuid(solarflowService).build();
+        return Collections.singletonList(filter);
+    }
+
+    @Override
+    protected Pattern getSupportedDeviceName() {
+        return Pattern.compile("Zen.*");
+    }
+
+    @Override
+    public boolean supportsAppsManagement(final GBDevice device) {
+        return true;
+    }
+
+    @Override
+    public Class<? extends Activity> getAppsManagementActivity(final GBDevice device) {
+        return SolarEquipmentStatusActivity.class;
+    }
+
+    @Override
+    public int getBondingStyle() {
+        return BONDING_STYLE_NONE;
+    }
+
+    @Override
+    public boolean isExperimental() {
+        return true;
+    }
+
+    @Override
+    public DeviceKind getDeviceKind(@NonNull GBDevice device) {
+        return DeviceKind.PV_EQUIPMENT;
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/DeviceType.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/DeviceType.java
index 057b07022a..2fc18c75a9 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/DeviceType.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/model/DeviceType.java
@@ -431,6 +431,7 @@ import nodomain.freeyourgadget.gadgetbridge.devices.yawell.ring.ColmiR12Coordina
 import nodomain.freeyourgadget.gadgetbridge.devices.yawell.ring.H59Coordinator;
 import nodomain.freeyourgadget.gadgetbridge.devices.yawell.ring.YawellR10Coordinator;
 import nodomain.freeyourgadget.gadgetbridge.devices.yawell.ring.YawellR11Coordinator;
+import nodomain.freeyourgadget.gadgetbridge.devices.zendure.SolarFlowDeviceCoordinator;
 import nodomain.freeyourgadget.gadgetbridge.devices.zetime.ZeTimeCoordinator;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.gatt_client.BleGattClientCoordinator;
 
@@ -853,6 +854,7 @@ public enum DeviceType {
     COOSPO_HW807(CoospoHW807Coordinator.class),
     COOSPO_H9Z(CoospoH9ZCoordinator.class),
     GENERIC_WEIGHT_SCALE(GenericWeightScaleCoordinator.class),
+    SOLARFLOW(SolarFlowDeviceCoordinator.class),
     TEST(TestDeviceCoordinator.class);
 
     private DeviceCoordinator coordinator;
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/marstek/MarstekB2500DeviceSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/marstek/MarstekB2500DeviceSupport.java
index ddea50d330..3185be0bdf 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/marstek/MarstekB2500DeviceSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/marstek/MarstekB2500DeviceSupport.java
@@ -39,7 +39,7 @@ import java.util.SimpleTimeZone;
 import java.util.UUID;
 
 import nodomain.freeyourgadget.gadgetbridge.GBApplication;
-import nodomain.freeyourgadget.gadgetbridge.devices.marstek.SolarEquipmentStatusActivity;
+import nodomain.freeyourgadget.gadgetbridge.devices.SolarEquipmentStatusActivity;
 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
 import nodomain.freeyourgadget.gadgetbridge.service.btle.AbstractBTLESingleDeviceSupport;
 import nodomain.freeyourgadget.gadgetbridge.service.btle.TransactionBuilder;
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/zendure/SolarFlowDeviceSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/zendure/SolarFlowDeviceSupport.java
new file mode 100644
index 0000000000..197457088e
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/zendure/SolarFlowDeviceSupport.java
@@ -0,0 +1,221 @@
+/*  Copyright (C) 2024 Andreas Shimokawa
+
+    This file is part of Gadgetbridge.
+
+    Gadgetbridge is free software: you can redistribute it and/or modify
+    it under the terms of the GNU Affero General Public License as published
+    by the Free Software Foundation, either version 3 of the License, or
+    (at your option) any later version.
+
+    Gadgetbridge is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU Affero General Public License for more details.
+
+    You should have received a copy of the GNU Affero General Public License
+    along with this program.  If not, see <https://www.gnu.org/licenses/>. */
+package nodomain.freeyourgadget.gadgetbridge.service.devices.zendure;
+
+import android.bluetooth.BluetoothGatt;
+import android.bluetooth.BluetoothGattCharacteristic;
+import android.content.Intent;
+
+import androidx.localbroadcastmanager.content.LocalBroadcastManager;
+
+import org.json.JSONArray;
+import org.json.JSONException;
+import org.json.JSONObject;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
+import java.nio.charset.StandardCharsets;
+import java.util.UUID;
+
+import nodomain.freeyourgadget.gadgetbridge.devices.SolarEquipmentStatusActivity;
+import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
+import nodomain.freeyourgadget.gadgetbridge.service.btle.AbstractBTLESingleDeviceSupport;
+import nodomain.freeyourgadget.gadgetbridge.service.btle.TransactionBuilder;
+
+
+public class SolarFlowDeviceSupport extends AbstractBTLESingleDeviceSupport {
+    public static final UUID UUID_CHARACTERISTIC_READ = UUID.fromString("0000c305-0000-1000-8000-00805f9b34fb");
+    public static final UUID UUID_CHARACTERISTIC_WRITE = UUID.fromString("0000c304-0000-1000-8000-00805f9b34fb");
+    public static final UUID UUID_SERVICE_MAIN = UUID.fromString("0000a002-0000-1000-8000-00805f9b34fb");
+    private static final Logger LOG = LoggerFactory.getLogger(SolarFlowDeviceSupport.class);
+    private long messageId = 1;
+
+    // cached values from various messages
+    private long messageIdReport = -1;
+    private int solarPower1 = -1;
+    private int solarPower2 = -1;
+    private int solarPower3 = -1;
+    private int solarPower4 = -1;
+    private int outputHomePower = -1;
+    private int batteryTemp;
+    private int hyperTmp;
+    private int electricLevel = -1;
+
+    public SolarFlowDeviceSupport() {
+        super(LOG);
+        addSupportedService(UUID_SERVICE_MAIN);
+    }
+
+    @Override
+    public boolean onCharacteristicChanged(BluetoothGatt gatt, BluetoothGattCharacteristic characteristic, byte[] value) {
+        String message = new String(value, StandardCharsets.UTF_8);
+        LOG.info("got message from SolarFlow {}", message);
+        try {
+            JSONObject jsonMessage = new JSONObject(message);
+            if (jsonMessage.has("method")) {
+                String method = jsonMessage.getString("method");
+
+                if (method.equals("BLESPP")) {
+                    String deviceId = jsonMessage.getString("deviceId");
+                    JSONObject sendMessage = new JSONObject()
+                            .put("messageId", messageId++)
+                            .put("method", "BLESPP_OK");
+
+                    sendMessage(sendMessage);
+
+                    JSONObject sendMessageGetInfo = new JSONObject()
+                            .put("messageId", messageId++)
+                            .put("method", "getInfo")
+                            .put("timestamp", System.currentTimeMillis() / 1000);
+                    sendMessage(sendMessageGetInfo);
+
+                    JSONObject sendMessageGetAllInfos = new JSONObject()
+                            .put("messageId", messageId++)
+                            .put("deviceId", deviceId)
+                            .put("method", "read")
+                            .put("properties", new JSONArray().put("getAll"))
+                            .put("timestamp", System.currentTimeMillis() / 1000);
+                    sendMessage(sendMessageGetAllInfos);
+                } else if (method.equals("report")) {
+                    long messageIdReport = jsonMessage.getLong("messageId");
+                    if (messageIdReport != this.messageIdReport) {
+                        if (this.messageIdReport != -1) {
+                            reportToStatusActivity();
+                        } else {
+                            TransactionBuilder builder = createTransactionBuilder("setInitialized");
+                            builder.setDeviceState(GBDevice.State.INITIALIZED);
+                            builder.queue();
+                        }
+                        this.messageIdReport = messageIdReport;
+
+                    }
+                    if (jsonMessage.has("properties")) {
+                        return handleReportProperties(jsonMessage.getJSONObject("properties"));
+                    }
+                    if (jsonMessage.has("packData")) {
+                        return handleReportPackData(jsonMessage.getJSONArray("packData"));
+                    }
+
+                }
+            }
+        } catch (JSONException e) {
+            LOG.error("could not decode JSON: {}", e.getMessage());
+            return false;
+        }
+        return true;
+    }
+
+    @Override
+    protected TransactionBuilder initializeDevice(TransactionBuilder builder) {
+        builder.setDeviceState(GBDevice.State.INITIALIZING);
+        getDevice().setFirmwareVersion("N/A");
+        getDevice().setFirmwareVersion2("N/A");
+        builder.requestMtu(512);
+        builder.notify(UUID_CHARACTERISTIC_READ, true);
+        return builder;
+    }
+
+    @Override
+    public boolean useAutoConnect() {
+        return false;
+    }
+
+
+    @Override
+    public void onSendConfiguration(final String config) {
+        LOG.warn("Unknown config changed: {}", config);
+    }
+
+    private void sendMessage(JSONObject message) {
+        sendMessage(message.toString());
+    }
+
+    private boolean handleReportProperties(JSONObject properties) {
+        try {
+            if (properties.has("solarPower1")) {
+                solarPower1 = properties.getInt("solarPower1");
+            }
+            if (properties.has("solarPower2")) {
+                solarPower2 = properties.getInt("solarPower2");
+            }
+            if (properties.has("solarPower3")) {
+                solarPower3 = properties.getInt("solarPower3");
+            }
+            if (properties.has("solarPower4")) {
+                solarPower4 = properties.getInt("solarPower4");
+            }
+            if (properties.has("hyperTmp")) {
+                hyperTmp = (properties.getInt("hyperTmp") - 2731) / 10;
+            }
+            if (properties.has("electricLevel")) {
+                int electricLevel = properties.getInt("electricLevel");
+                if (electricLevel != this.electricLevel) {
+                    this.electricLevel = electricLevel;
+                    getDevice().setBatteryLevel(electricLevel);
+                    getDevice().sendDeviceUpdateIntent(getContext());
+                }
+            }
+            if (properties.has("outputHomePower")) {
+                outputHomePower = properties.getInt("outputHomePower");
+            }
+
+        } catch (JSONException e) {
+            LOG.error("JSON error while parsing report: {}", e.getMessage());
+            return false;
+        }
+        return true;
+    }
+
+    private boolean handleReportPackData(JSONArray packArray) {
+        try {
+            JSONObject packData = packArray.getJSONObject(0); // FIXME, there can be more packs
+
+            if (packData.has("maxTemp")) {
+                batteryTemp = (packData.getInt("maxTemp") - 2731) / 10;
+            }
+        } catch (JSONException e) {
+            LOG.error("JSON error while parsing pack data: {}", e.getMessage());
+            return false;
+        }
+        return true;
+    }
+
+    private void sendMessage(String message) {
+        TransactionBuilder builder = createTransactionBuilder("sendMessage");
+        BluetoothGattCharacteristic characteristic = getCharacteristic(UUID_CHARACTERISTIC_WRITE);
+        if (characteristic != null && message != null) {
+            builder.write(characteristic, message.getBytes(StandardCharsets.UTF_8));
+            builder.queue();
+        }
+    }
+
+    private void reportToStatusActivity() {
+        Intent intent = new Intent(SolarEquipmentStatusActivity.ACTION_SEND_SOLAR_EQUIPMENT_STATUS)
+                .putExtra(SolarEquipmentStatusActivity.EXTRA_BATTERY_PCT, electricLevel)
+                .putExtra(SolarEquipmentStatusActivity.EXTRA_TEMP1, hyperTmp)
+                .putExtra(SolarEquipmentStatusActivity.EXTRA_TEMP2, batteryTemp)
+                .putExtra(SolarEquipmentStatusActivity.EXTRA_OUTPUT1_WATT, outputHomePower)
+                .putExtra(SolarEquipmentStatusActivity.EXTRA_OUTPUT2_WATT, -1)
+                .putExtra(SolarEquipmentStatusActivity.EXTRA_PANEL1_WATT, solarPower1)
+                .putExtra(SolarEquipmentStatusActivity.EXTRA_PANEL2_WATT, solarPower2)
+                .putExtra(SolarEquipmentStatusActivity.EXTRA_PANEL3_WATT, solarPower3)
+                .putExtra(SolarEquipmentStatusActivity.EXTRA_PANEL4_WATT, solarPower4);
+
+        LocalBroadcastManager.getInstance(getContext()).sendBroadcast(intent);
+        getContext().sendBroadcast(intent);
+    }
+}
diff --git a/app/src/main/res/layout/activity_solar_equipment_status.xml b/app/src/main/res/layout/activity_solar_equipment_status.xml
index a5f071950a..ea5ca3d90c 100644
--- a/app/src/main/res/layout/activity_solar_equipment_status.xml
+++ b/app/src/main/res/layout/activity_solar_equipment_status.xml
@@ -6,7 +6,7 @@
     android:layout_width="match_parent"
     android:layout_height="match_parent"
     android:orientation="vertical"
-    tools:context=".devices.marstek.SolarEquipmentStatusActivity">
+    tools:context=".devices.SolarEquipmentStatusActivity">
 
     <androidx.core.widget.NestedScrollView
         android:layout_width="match_parent"
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index 93fddf15a4..8d6cd4a720 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -4479,4 +4479,5 @@
     <string name="notification_pebble_js_service_text">Running Pebble app/watchface JavaScript</string>
     <string name="internet_helper_banglejs_permission_missing_title">Permission missing</string>
     <string name="internet_helper_banglejs_permission_missing_text">Access to the Bangle.js app loader is currently not allowed by your settings. Please go to the internet helper settings in the external integrations settings to enable it.</string>
+    <string name="devicetype_solarflow">SolarFlow</string>
 </resources>
```
-----------------------------------
