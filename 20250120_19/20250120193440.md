# Commit: 7080649cb286417ac4444469fb931e183eb6366c
## Message: Huawei: DataSync service initial support added. Basic goals.
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiCoordinator.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiPacket.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/AsynchronousResponse.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiSupportProvider.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendP2PCommand.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/DataSync.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiDataSyncManager.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/datasync/HuaweiDataSyncCommon.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/datasync/HuaweiDataSyncGoals.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncConfigCommand.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncDataCommand.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncDictDataCommand.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncEventCommand.java

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiCoordinator.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiCoordinator.java
index aee2e0963..03ed263e5 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiCoordinator.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiCoordinator.java
@@ -55,7 +55,6 @@ import nodomain.freeyourgadget.gadgetbridge.entities.HuaweiWorkoutSummarySample;
 import nodomain.freeyourgadget.gadgetbridge.entities.HuaweiWorkoutSummarySampleDao;
 import nodomain.freeyourgadget.gadgetbridge.entities.HuaweiWorkoutSwimSegmentsSampleDao;
 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
-import nodomain.freeyourgadget.gadgetbridge.model.CannedMessagesSpec;
 import nodomain.freeyourgadget.gadgetbridge.util.GB;
 
 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.*;
@@ -698,6 +697,43 @@ public class HuaweiCoordinator {
         return false;
     }
 
+    public boolean supportsDeviceCommandConfig() {
+        if (supportsExpandCapability())
+            return supportsExpandCapability(83);
+        return false;
+    }
+
+
+    public boolean supportsDeviceCommandEvent() {
+        if (supportsExpandCapability())
+            return supportsExpandCapability(84);
+        return false;
+    }
+
+    public boolean supportsDeviceCommandData() {
+        if (supportsExpandCapability())
+            return supportsExpandCapability(85);
+        return false;
+    }
+
+    public boolean supportsDeviceCommandDictData() {
+        if (supportsExpandCapability())
+            return supportsExpandCapability(173);
+        return false;
+    }
+
+    public boolean supportsThreeCircle() {
+        if (supportsExpandCapability())
+            return supportsExpandCapability(154);
+        return false;
+    }
+
+    public boolean supportsThreeCircleLite() {
+        if (supportsExpandCapability())
+            return supportsExpandCapability(156);
+        return false;
+    }
+
     public boolean supportsPromptPushMessage () {
 //              do not ask for capabilities under specific condition
 //                  if (deviceType == 10 && deviceVersion == 73617766697368 && deviceSoftVersion == 372E312E31) -> leo device
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiPacket.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiPacket.java
index 7bd350a44..c30b3d5d7 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiPacket.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/HuaweiPacket.java
@@ -35,6 +35,7 @@ import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.App;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.Calls;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.CameraRemote;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.Contacts;
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.DataSync;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.Earphones;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.EphemerisFileUpload;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.FileDownloadService0A;
@@ -725,6 +726,20 @@ public class HuaweiPacket {
                         this.isEncrypted = this.attemptDecrypt(); // Helps with debugging
                         return this;
                 }
+            case DataSync.id:
+                switch (this.commandId) {
+                    case DataSync.ConfigCommand.id:
+                        return new DataSync.ConfigCommand.Response(paramsProvider).fromPacket(this);
+                    case DataSync.EventCommand.id:
+                        return new DataSync.EventCommand.Response(paramsProvider).fromPacket(this);
+                    case DataSync.DataCommand.id:
+                        return new DataSync.DataCommand.Response(paramsProvider).fromPacket(this);
+                    case DataSync.DictDataCommand.id:
+                        return new DataSync.DictDataCommand.Response(paramsProvider).fromPacket(this);
+                    default:
+                        this.isEncrypted = this.attemptDecrypt(); // Helps with debugging
+                        return this;
+                }
             default:
                 this.isEncrypted = this.attemptDecrypt(); // Helps with debugging
                 return this;
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/DataSync.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/DataSync.java
new file mode 100644
index 000000000..af5364f9d
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/huawei/packets/DataSync.java
@@ -0,0 +1,234 @@
+package nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.HuaweiPacket;
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.HuaweiTLV;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.datasync.HuaweiDataSyncCommon;
+
+public class DataSync {
+    public static final byte id = 0x37;
+
+    public static int getError(HuaweiTLV tlv) throws HuaweiPacket.MissingTagException {
+        if (tlv.contains(0x7f)) {
+            return tlv.getInteger(0x7f);
+        }
+        return HuaweiDataSyncCommon.REPLY_OK;
+    }
+
+    public static class ConfigCommand {
+        public static final byte id = 0x01;
+
+        public static class Request extends HuaweiPacket {
+
+            public Request(ParamsProvider paramsProvider,
+                           String srcPackage,
+                           String dstPackage,
+                           HuaweiDataSyncCommon.ConfigCommandData sendData) {
+                super(paramsProvider);
+                this.serviceId = DataSync.id;
+                this.commandId = id;
+
+                this.tlv = new HuaweiTLV()
+                        .put(0x01, srcPackage)
+                        .put(0x02, dstPackage);
+                // TODO: potentially can be not 83 tlv.
+                if(!sendData.getConfigDataList().isEmpty()) {
+                    HuaweiTLV tlvList = new HuaweiTLV();
+                    for(HuaweiDataSyncCommon.ConfigData dt: sendData.getConfigDataList()) {
+                        HuaweiTLV item = new HuaweiTLV();
+                        if(dt.configId != -1) {
+                            item.put(0x05, dt.configId);
+                        }
+                        if(dt.configAction != -1) {
+                            item.put(0x06, dt.configAction);
+                        }
+                        if(dt.configData != null) {
+                            item.put(0x07, dt.configData);
+                        }
+                        if(dt.configUnknown != -1) {
+                            item.put(0x08, dt.configUnknown);
+                        }
+                        tlvList.put(0x84, item);
+                    }
+                    this.tlv.put(0x83, tlvList);
+                }
+            }
+        }
+
+        public static class Response extends HuaweiPacket {
+            public String srcPackage;
+            public String dstPackage;
+            public HuaweiDataSyncCommon.ConfigCommandData data = new HuaweiDataSyncCommon.ConfigCommandData();
+            public Response (ParamsProvider paramsProvider) {
+                super(paramsProvider);
+            }
+
+            @Override
+            public void parseTlv() throws HuaweiPacket.ParseException {
+                srcPackage = this.tlv.getString(0x01);
+                dstPackage = this.tlv.getString(0x02);
+                int returnCode = getError(this.tlv);
+                if(returnCode != HuaweiDataSyncCommon.REPLY_OK) {
+                    data.setCode(returnCode);
+                    return;
+                }
+                // TODO: potentially can be not 83 tlv.
+                if(this.tlv.contains(0x83)) {
+                    List<HuaweiDataSyncCommon.ConfigData> respData = new ArrayList<>();
+                    List<HuaweiTLV> subContainers = this.tlv.getObject(0x83).getObjects(0x84);
+                    for(HuaweiTLV subTlv: subContainers) {
+                        HuaweiDataSyncCommon.ConfigData dt = new HuaweiDataSyncCommon.ConfigData();
+                        if(subTlv.contains(0x05)) {
+                            dt.configId = subTlv.getInteger(0x05);
+                        }
+                        if(subTlv.contains(0x06)) {
+                            dt.configAction = subTlv.getByte(0x06);
+                        }
+                        if(subTlv.contains(0x07)) {
+                            dt.configData = subTlv.getBytes(0x07);
+                        }
+                        if(subTlv.contains(0x08)) {
+                            dt.configUnknown = subTlv.getLong(0x08);
+                        }
+                        respData.add(dt);
+                    }
+                    data.setConfigDataList(respData);
+                }
+            }
+
+        }
+    }
+
+    public static class EventCommand {
+        public static final byte id = 0x02;
+
+        public static class Request extends HuaweiPacket {
+
+            public Request(ParamsProvider paramsProvider,
+                           String srcPackage,
+                           String dstPackage,
+                           HuaweiDataSyncCommon.EventCommandData sendData) {
+                super(paramsProvider);
+                this.serviceId = DataSync.id;
+                this.commandId = id;
+
+                this.tlv = new HuaweiTLV()
+                        .put(0x01, srcPackage)
+                        .put(0x02, dstPackage)
+                        .put(0x03, sendData.getEventId())
+                        .put(0x04, sendData.getEventLevel())
+                        .put(0x05, sendData.getData());
+            }
+        }
+
+        public static class Response extends HuaweiPacket {
+            public String srcPackage;
+            public String dstPackage;
+            public HuaweiDataSyncCommon.EventCommandData data = new HuaweiDataSyncCommon.EventCommandData();
+
+            public Response (ParamsProvider paramsProvider) {
+                super(paramsProvider);
+            }
+
+            @Override
+            public void parseTlv() throws HuaweiPacket.ParseException {
+                srcPackage = this.tlv.getString(0x01);
+                dstPackage = this.tlv.getString(0x02);
+                int returnCode = getError(this.tlv);
+                if(returnCode != HuaweiDataSyncCommon.REPLY_OK) {
+                    data.setCode(returnCode);
+                    return;
+                }
+                data.setEventId(this.tlv.getAsInteger(0x03));
+                data.setEventLevel(this.tlv.getAsInteger(0x04));
+                data.setData(this.tlv.getBytes(0x05));
+            }
+        }
+    }
+
+    public static class DataCommand {
+        public static final byte id = 0x03;
+
+        public static class Request extends HuaweiPacket {
+
+            public Request(ParamsProvider paramsProvider,
+                           String srcPackage,
+                           String dstPackage,
+                           HuaweiDataSyncCommon.DataCommandData sendData) {
+                super(paramsProvider);
+                this.serviceId = DataSync.id;
+                this.commandId = id;
+
+                // TODO: discover other data
+                this.tlv = new HuaweiTLV()
+                        .put(0x01, srcPackage)
+                        .put(0x02, dstPackage);
+            }
+        }
+
+        public static class Response extends HuaweiPacket {
+            public String srcPackage;
+            public String dstPackage;
+            public HuaweiDataSyncCommon.DataCommandData data = new HuaweiDataSyncCommon.DataCommandData();
+            public Response (ParamsProvider paramsProvider) {
+                super(paramsProvider);
+            }
+
+            @Override
+            public void parseTlv() throws HuaweiPacket.ParseException {
+                srcPackage = this.tlv.getString(0x01);
+                dstPackage = this.tlv.getString(0x02);
+                int returnCode = getError(this.tlv);
+                if(returnCode != HuaweiDataSyncCommon.REPLY_OK) {
+                    data.setCode(returnCode);
+                    return;
+                }
+                // TODO: discover and decode other data
+            }
+        }
+    }
+
+    public static class DictDataCommand {
+        public static final byte id = 0x04;
+
+        public static class Request extends HuaweiPacket {
+
+            public Request(ParamsProvider paramsProvider,
+                           String srcPackage,
+                           String dstPackage,
+                           HuaweiDataSyncCommon.DictDataCommandData sendData) {
+                super(paramsProvider);
+                this.serviceId = DataSync.id;
+                this.commandId = id;
+
+                // TODO: discover other data
+                this.tlv = new HuaweiTLV()
+                        .put(0x01, srcPackage)
+                        .put(0x02, dstPackage);
+            }
+        }
+
+        public static class Response extends HuaweiPacket {
+            public String srcPackage;
+            public String dstPackage;
+            public HuaweiDataSyncCommon.DictDataCommandData data = new HuaweiDataSyncCommon.DictDataCommandData();
+            public Response (ParamsProvider paramsProvider) {
+                super(paramsProvider);
+            }
+
+            @Override
+            public void parseTlv() throws HuaweiPacket.ParseException {
+                srcPackage = this.tlv.getString(0x01);
+                dstPackage = this.tlv.getString(0x02);
+                int returnCode = getError(this.tlv);
+                if(returnCode != HuaweiDataSyncCommon.REPLY_OK) {
+                    data.setCode(returnCode);
+                    return;
+                }
+                // TODO: discover other data
+            }
+        }
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/AsynchronousResponse.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/AsynchronousResponse.java
index db9446756..4cd09674c 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/AsynchronousResponse.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/AsynchronousResponse.java
@@ -49,6 +49,7 @@ import nodomain.freeyourgadget.gadgetbridge.devices.huawei.HuaweiPacket;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.App;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.Calls;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.CameraRemote;
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.DataSync;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.DeviceConfig;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.Ephemeris;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.EphemerisFileUpload;
@@ -131,6 +132,7 @@ public class AsynchronousResponse {
             handleAsyncBattery(response);
             handleNotifications(response);
             handlePermissionCheck(response);
+            handleDataSyncCommands(response);
         } catch (Request.ResponseParseException e) {
             LOG.error("Response parse exception", e);
         }
@@ -764,4 +766,35 @@ public class AsynchronousResponse {
             }
         }
     }
+
+    private void handleDataSyncCommands(HuaweiPacket response) throws Request.ResponseTypeMismatchException {
+        if (response.serviceId == DataSync.id) {
+            if (response.commandId == DataSync.ConfigCommand.id) {
+                if (!(response instanceof DataSync.ConfigCommand.Response)) {
+                    throw new Request.ResponseTypeMismatchException(response, DataSync.ConfigCommand.class);
+                }
+                DataSync.ConfigCommand.Response resp = (DataSync.ConfigCommand.Response) response;
+                support.getHuaweiDataSyncManager().handleConfigCommandResponse(resp.srcPackage, resp.dstPackage, resp.data);
+            } else if (response.commandId == DataSync.EventCommand.id) {
+                if (!(response instanceof DataSync.EventCommand.Response)) {
+                    throw new Request.ResponseTypeMismatchException(response, DataSync.EventCommand.class);
+                }
+                DataSync.EventCommand.Response resp = (DataSync.EventCommand.Response) response;
+                support.getHuaweiDataSyncManager().handleEventCommandResponse(resp.srcPackage, resp.dstPackage, resp.data);
+            } else if (response.commandId == DataSync.DataCommand.id) {
+                if (!(response instanceof DataSync.DataCommand.Response)) {
+                    throw new Request.ResponseTypeMismatchException(response, DataSync.EventCommand.class);
+                }
+                DataSync.DataCommand.Response resp = (DataSync.DataCommand.Response) response;
+                support.getHuaweiDataSyncManager().handleDataCommandResponse(resp.srcPackage, resp.dstPackage, resp.data);
+            } else if (response.commandId == DataSync.DictDataCommand.id) {
+                if (!(response instanceof DataSync.DictDataCommand.Response)) {
+                    throw new Request.ResponseTypeMismatchException(response, DataSync.EventCommand.class);
+                }
+                DataSync.DictDataCommand.Response resp = (DataSync.DictDataCommand.Response) response;
+                support.getHuaweiDataSyncManager().handleDictDataCommandResponse(resp.srcPackage, resp.dstPackage, resp.data);
+            }
+        }
+    }
+
 }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiDataSyncManager.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiDataSyncManager.java
new file mode 100644
index 000000000..5bb02c27a
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiDataSyncManager.java
@@ -0,0 +1,138 @@
+package nodomain.freeyourgadget.gadgetbridge.service.devices.huawei;
+
+import android.widget.Toast;
+
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
+import java.io.IOException;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.datasync.HuaweiDataSyncCommon;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.p2p.HuaweiBaseP2PService;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests.GetHiChainRequest;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests.GetPincodeRequest;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests.SendDataSyncConfigCommand;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests.SendDataSyncDataCommand;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests.SendDataSyncDictDataCommand;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests.SendDataSyncEventCommand;
+import nodomain.freeyourgadget.gadgetbridge.util.GB;
+
+public class HuaweiDataSyncManager {
+    private static final Logger LOG = LoggerFactory.getLogger(HuaweiDataSyncManager.class);
+
+    private final HuaweiSupportProvider support;
+
+    private final  Map<String, HuaweiDataSyncCommon.DataCallback> registeredCallbacks = new HashMap<>();
+
+    public HuaweiDataSyncManager(HuaweiSupportProvider support) {
+        this.support = support;
+    }
+
+    public void registerCallback(String pkg, HuaweiDataSyncCommon.DataCallback callback) {
+        registeredCallbacks.put(pkg, callback);
+    }
+
+    public void unregisterCallback(String pkg) {
+        registeredCallbacks.remove(pkg);
+    }
+
+    public void unregisterAll() {
+        registeredCallbacks.clear();
+    }
+
+    public void handleConfigCommandResponse(String srcPackage, String dstPackage, HuaweiDataSyncCommon.ConfigCommandData data) {
+        LOG.info("DataSync handleConfigCommandResponse SRC: {}, DST: {}", srcPackage, dstPackage);
+        HuaweiDataSyncCommon.DataCallback callback = registeredCallbacks.get(srcPackage);
+        if(callback != null) {
+            callback.onConfigCommand(data);
+        }
+    }
+
+    public void handleEventCommandResponse(String srcPackage, String dstPackage, HuaweiDataSyncCommon.EventCommandData data) {
+        LOG.info("DataSync handleSampleEventCommandResponse SRC: {}, DST: {}", srcPackage, dstPackage);
+        HuaweiDataSyncCommon.DataCallback callback = registeredCallbacks.get(srcPackage);
+        if(callback != null) {
+            callback.onEventCommand(data);
+        }
+    }
+
+    public void handleDataCommandResponse(String srcPackage, String dstPackage, HuaweiDataSyncCommon.DataCommandData data) {
+        LOG.info("DataSync handleSampleDataCommandResponse SRC: {}, DST: {}", srcPackage, dstPackage);
+        HuaweiDataSyncCommon.DataCallback callback = registeredCallbacks.get(srcPackage);
+        if(callback != null) {
+            callback.onDataCommand(data);
+        }
+    }
+
+    public void handleDictDataCommandResponse(String srcPackage, String dstPackage, HuaweiDataSyncCommon.DictDataCommandData data) {
+        LOG.info("DataSync handleDictDataCommandResponse SRC: {}, DST: {}", srcPackage, dstPackage);
+        HuaweiDataSyncCommon.DataCallback callback = registeredCallbacks.get(srcPackage);
+        if(callback != null) {
+            callback.onDictDataCommand(data);
+        }
+    }
+
+    public boolean sendConfigCommand(String srcPackage, String dstPackage, HuaweiDataSyncCommon.ConfigCommandData data) {
+        if(!this.support.getHuaweiCoordinator().supportsDeviceCommandConfig()) {
+            LOG.info("sendConfigCommand is not supported");
+            return false;
+        }
+        try {
+            SendDataSyncConfigCommand sendDataSyncConfigCommand = new SendDataSyncConfigCommand(this.support, srcPackage, dstPackage, data);
+            sendDataSyncConfigCommand.doPerform();
+        } catch (IOException e) {
+            LOG.error("SendDataSyncConfigCommand failed", e);
+            return false;
+        }
+        return true;
+    }
+
+    public boolean sendEventCommand(String srcPackage, String dstPackage, HuaweiDataSyncCommon.EventCommandData data) {
+        if(!this.support.getHuaweiCoordinator().supportsDeviceCommandEvent()) {
+            LOG.info("sendEventCommand is not supported");
+            return false;
+        }
+        try {
+            SendDataSyncEventCommand sendDataSyncEventCommand = new SendDataSyncEventCommand(this.support, srcPackage, dstPackage, data);
+            sendDataSyncEventCommand.doPerform();
+        } catch (IOException e) {
+            LOG.error("SendDataSyncEventCommand failed", e);
+            return false;
+        }
+        return true;
+    }
+
+    public boolean sendDataCommand(String srcPackage, String dstPackage, HuaweiDataSyncCommon.DataCommandData data) {
+        if(!this.support.getHuaweiCoordinator().supportsDeviceCommandData()) {
+            LOG.info("sendDataCommand is not supported");
+            return false;
+        }
+        try {
+            SendDataSyncDataCommand sendDataSyncDataCommand = new SendDataSyncDataCommand(this.support, srcPackage, dstPackage, data);
+            sendDataSyncDataCommand.doPerform();
+        } catch (IOException e) {
+            LOG.error("SendDataSyncDataCommand failed", e);
+            return false;
+        }
+        return true;
+    }
+
+    public boolean sendDictDataCommand(String srcPackage, String dstPackage, HuaweiDataSyncCommon.DictDataCommandData data) {
+        if(!this.support.getHuaweiCoordinator().supportsDeviceCommandDictData()) {
+            LOG.info("sendDictDataCommand is not supported");
+            return false;
+        }
+        try {
+            SendDataSyncDictDataCommand sendDataSyncDictDataCommand = new SendDataSyncDictDataCommand(this.support, srcPackage, dstPackage, data);
+            sendDataSyncDictDataCommand.doPerform();
+        } catch (IOException e) {
+            LOG.error("SendDataSyncDictDataCommand failed", e);
+            return false;
+        }
+        return true;
+    }
+
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiSupportProvider.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiSupportProvider.java
index 904c3d112..f8f43692f 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiSupportProvider.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/HuaweiSupportProvider.java
@@ -16,6 +16,8 @@
     along with this program.  If not, see <https://www.gnu.org/licenses/>. */
 package nodomain.freeyourgadget.gadgetbridge.service.devices.huawei;
 
+import static nodomain.freeyourgadget.gadgetbridge.model.ActivityUser.PREF_USER_GOAL_STANDING_TIME_HOURS;
+
 import android.bluetooth.BluetoothGattCharacteristic;
 import android.content.Context;
 import android.content.SharedPreferences;
@@ -108,6 +110,7 @@ import nodomain.freeyourgadget.gadgetbridge.model.RecordedDataTypes;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 
 import nodomain.freeyourgadget.gadgetbridge.service.btle.actions.SetDeviceStateAction;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.datasync.HuaweiDataSyncGoals;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.p2p.HuaweiP2PCalendarService;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.p2p.HuaweiP2PCannedRepliesService;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.p2p.HuaweiP2PTrackService;
@@ -252,6 +255,10 @@ public class HuaweiSupportProvider {
     //TODO: we need only one instance of manager and all it services.
     protected HuaweiP2PManager huaweiP2PManager = new HuaweiP2PManager(this);
 
+    protected HuaweiDataSyncManager huaweiDataSyncManager = new HuaweiDataSyncManager(this);
+
+
+    private HuaweiDataSyncGoals huaweiDataSyncTreeCircleGoals = null;
 
     public HuaweiCoordinatorSupplier getCoordinator() {
         return ((HuaweiCoordinatorSupplier) this.gbDevice.getDeviceCoordinator());
@@ -289,6 +296,10 @@ public class HuaweiSupportProvider {
         return huaweiMusicManager;
     }
 
+    public HuaweiDataSyncManager getHuaweiDataSyncManager() {
+        return huaweiDataSyncManager;
+    }
+
     public HuaweiSupportProvider(HuaweiBRSupport support) {
         this.brSupport = support;
     }
@@ -652,6 +663,8 @@ public class HuaweiSupportProvider {
             }
 
             huaweiP2PManager.unregisterAllService();
+            huaweiDataSyncManager.unregisterAll();
+            this.huaweiDataSyncTreeCircleGoals = null;
             stopBatteryRunnerDelayed();
             GetBatteryLevelRequest batteryLevelReq = new GetBatteryLevelRequest(this);
             batteryLevelReq.setFinalizeReq(new RequestCallback() {
@@ -877,7 +890,10 @@ public class HuaweiSupportProvider {
                             HuaweiP2PDataDictionarySyncService trackService = new HuaweiP2PDataDictionarySyncService(huaweiP2PManager);
                             trackService.register();
                         }
+                    }
 
+                    if(getHuaweiCoordinator().supportsThreeCircle() || getHuaweiCoordinator().supportsThreeCircleLite()) {
+                        huaweiDataSyncTreeCircleGoals = new HuaweiDataSyncGoals(HuaweiSupportProvider.this);
                     }
                 }
             });
@@ -1094,7 +1110,16 @@ public class HuaweiSupportProvider {
                     sendDebugRequest();
                     break;
                 case ActivityUser.PREF_USER_STEPS_GOAL:
-                    new SendFitnessGoalRequest(this).doPerform();
+                    setStepsGoal();
+                    break;
+                case ActivityUser.PREF_USER_CALORIES_BURNT:
+                    setCaloriesBurntGoal();
+                    break;
+                case ActivityUser.PREF_USER_GOAL_FAT_BURN_TIME_MINUTES:
+                    setFatBurnTime();
+                    break;
+                case ActivityUser.PREF_USER_GOAL_STANDING_TIME_HOURS:
+                    setStandingTime();
                     break;
                 case DeviceSettingsPreferenceConst.PREF_CAMERA_REMOTE:
                     if (GBApplication.getDeviceSpecificSharedPrefs(gbDevice.getAddress()).getBoolean(DeviceSettingsPreferenceConst.PREF_CAMERA_REMOTE, false)) {
@@ -1134,6 +1159,58 @@ public class HuaweiSupportProvider {
         }
     }
 
+    public void setStepsGoal() {
+        if(huaweiDataSyncTreeCircleGoals != null) {
+            int stepGoal = GBApplication.getPrefs().getInt(ActivityUser.PREF_USER_STEPS_GOAL, ActivityUser.defaultUserStepsGoal);
+            huaweiDataSyncTreeCircleGoals.sendStepsGoal(stepGoal);
+        } else {
+            try {
+                new SendFitnessGoalRequest(this).doPerform();
+            } catch (IOException e) {
+                LOG.error("SendFitnessGoalRequest failed", e);
+            }
+        }
+    }
+
+    public void setCaloriesBurntGoal() {
+        if(huaweiDataSyncTreeCircleGoals != null) {
+            int caloriesBurntGoal = GBApplication.getPrefs().getInt(ActivityUser.PREF_USER_CALORIES_BURNT, ActivityUser.defaultUserCaloriesBurntGoal);
+            huaweiDataSyncTreeCircleGoals.sendCaloriesBurntGoal(caloriesBurntGoal);
+        } else {
+            try {
+                new SendFitnessGoalRequest(this).doPerform();
+            } catch (IOException e) {
+                LOG.error("SendFitnessGoalRequest failed", e);
+            }
+        }
+    }
+
+    public void setFatBurnTime() {
+        if(huaweiDataSyncTreeCircleGoals != null) {
+            int fatBurnTimeGoal = GBApplication.getPrefs().getInt(ActivityUser.PREF_USER_GOAL_FAT_BURN_TIME_MINUTES, ActivityUser.defaultUserFatBurnTimeMinutes);
+            huaweiDataSyncTreeCircleGoals.sendExerciseGoal(fatBurnTimeGoal);
+        } else {
+            try {
+                new SendFitnessGoalRequest(this).doPerform();
+            } catch (IOException e) {
+                LOG.error("SendFitnessGoalRequest failed", e);
+            }
+        }
+    }
+
+    public void setStandingTime() {
+        if(huaweiDataSyncTreeCircleGoals != null) {
+            int standingTimeGoal = GBApplication.getPrefs().getInt(PREF_USER_GOAL_STANDING_TIME_HOURS, ActivityUser.defaultUserGoalStandingTimeHours);
+            huaweiDataSyncTreeCircleGoals.sendStandGoal(standingTimeGoal);
+        } else {
+            try {
+                new SendFitnessGoalRequest(this).doPerform();
+            } catch (IOException e) {
+                LOG.error("SendFitnessGoalRequest failed", e);
+            }
+        }
+    }
+
     public void onFetchRecordedData(int dataTypes) {
         for (int i = 1; i > -1; i <<= 1) {
             if ((dataTypes & i) != 0) {
@@ -2316,6 +2393,8 @@ public class HuaweiSupportProvider {
         stopBatteryRunnerDelayed();
         huaweiFileDownloadManager.dispose();
         huaweiP2PManager.unregisterAllService();
+        huaweiDataSyncManager.unregisterAll();
+        this.huaweiDataSyncTreeCircleGoals = null;
     }
 
     public boolean downloadTruSleepData(int start, int end) {
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/datasync/HuaweiDataSyncCommon.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/datasync/HuaweiDataSyncCommon.java
new file mode 100644
index 000000000..62352029f
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/datasync/HuaweiDataSyncCommon.java
@@ -0,0 +1,112 @@
+package nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.datasync;
+
+import java.util.List;
+
+public class HuaweiDataSyncCommon {
+
+    public static final int REPLY_OK = 100000;
+
+    public static class ConfigData {
+        public int configId = -1;
+        public byte configAction = -1;
+        public byte[] configData;
+        public long configUnknown = -1; //??
+    }
+
+    public static class ConfigCommandData {
+        private int code = REPLY_OK;
+        private List<ConfigData> configDataList;
+
+        public int getCode() {
+            return code;
+        }
+
+        public void setCode(int code) {
+            this.code = code;
+        }
+
+        public List<ConfigData> getConfigDataList() {
+            return configDataList;
+        }
+
+        public void setConfigDataList(List<ConfigData> configDataList) {
+            this.configDataList = configDataList;
+        }
+    }
+
+    public static class EventCommandData {
+        private int code = REPLY_OK;
+        private int eventId = 0;
+        private int eventLevel = 0;
+        private byte[] data = null;
+
+        public int getCode() {
+            return code;
+        }
+
+        public void setCode(int code) {
+            this.code = code;
+        }
+
+        public int getEventId() {
+            return eventId;
+        }
+
+        public void setEventId(int eventId) {
+            this.eventId = eventId;
+        }
+
+        public int getEventLevel() {
+            return eventLevel;
+        }
+
+        public void setEventLevel(int eventLevel) {
+            this.eventLevel = eventLevel;
+        }
+
+        public byte[] getData() {
+            return data;
+        }
+
+        public void setData(byte[] data) {
+            this.data = data;
+        }
+    }
+
+    public static class DataCommandData {
+        private int code = REPLY_OK;
+        //TODO: discover and implement
+
+        public int getCode() {
+            return code;
+        }
+
+        public void setCode(int code) {
+            this.code = code;
+        }
+    }
+
+    public static class DictDataCommandData {
+        private int code = REPLY_OK;
+        //TODO: discover and implement
+
+        public int getCode() {
+            return code;
+        }
+
+        public void setCode(int code) {
+            this.code = code;
+        }
+    }
+
+    public interface DataCallback {
+        void onConfigCommand(ConfigCommandData data);
+
+        void onEventCommand(EventCommandData data);
+
+        void onDataCommand(DataCommandData data);
+
+        void onDictDataCommand(DictDataCommandData data);
+    }
+
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/datasync/HuaweiDataSyncGoals.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/datasync/HuaweiDataSyncGoals.java
new file mode 100644
index 000000000..81acb95be
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/datasync/HuaweiDataSyncGoals.java
@@ -0,0 +1,126 @@
+package nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.datasync;
+
+import android.content.SharedPreferences;
+
+import java.util.ArrayList;
+import java.util.List;
+
+import nodomain.freeyourgadget.gadgetbridge.GBApplication;
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.HuaweiPacket;
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.HuaweiTLV;
+import nodomain.freeyourgadget.gadgetbridge.model.ActivityUser;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.HuaweiSupportProvider;
+
+public class HuaweiDataSyncGoals implements HuaweiDataSyncCommon.DataCallback {
+
+    private final HuaweiSupportProvider support;
+
+    public static final int STEPS_GOAL = 900200006;
+    public static final int CALORIES_GOAL = 900200007;
+    public static final int EXERCISES_GOAL = 900200008;
+    public static final int STAND_GOAL = 900200009;
+
+    public static final String SRC_PKG_NAME = "hw.sport.config";
+    public static final String PKG_NAME = "in.huawei.motion";
+
+    public HuaweiDataSyncGoals(HuaweiSupportProvider support) {
+        this.support = support;
+        this.support.getHuaweiDataSyncManager().registerCallback(PKG_NAME, this);
+    }
+
+    private boolean sendCommonGoal(int configId, int goal) {
+        int time = (int) (System.currentTimeMillis() / 1000);
+        HuaweiTLV tlv = new HuaweiTLV().put(0x01, time).put(0x02, goal);
+        HuaweiDataSyncCommon.ConfigCommandData data = new HuaweiDataSyncCommon.ConfigCommandData();
+        HuaweiDataSyncCommon.ConfigData goalConfigData = new HuaweiDataSyncCommon.ConfigData();
+        goalConfigData.configId = configId;
+        goalConfigData.configAction = 1;
+        goalConfigData.configData = tlv.serialize();
+        List<HuaweiDataSyncCommon.ConfigData> list = new ArrayList<>();
+        list.add(goalConfigData);
+        data.setConfigDataList(list);
+        return this.support.getHuaweiDataSyncManager().sendConfigCommand(SRC_PKG_NAME, PKG_NAME, data);
+    }
+
+    public boolean sendStepsGoal(int stepsGoal) {
+        return sendCommonGoal(STEPS_GOAL, stepsGoal);
+    }
+
+    public boolean sendCaloriesBurntGoal(int caloriesBurntGoal) {
+        return sendCommonGoal(CALORIES_GOAL, caloriesBurntGoal * 1000);
+    }
+
+    public boolean sendExerciseGoal(int exerciseGoal) {
+        return sendCommonGoal(EXERCISES_GOAL, exerciseGoal);
+    }
+
+    public boolean sendStandGoal(int standGoal) {
+        return sendCommonGoal(STAND_GOAL, standGoal);
+    }
+
+    @Override
+    public void onConfigCommand(HuaweiDataSyncCommon.ConfigCommandData data) {
+        if(data.getCode() != HuaweiDataSyncCommon.REPLY_OK) {
+            return;
+        }
+        List<HuaweiDataSyncCommon.ConfigData> list = data.getConfigDataList();
+        if(list.isEmpty()) {
+            return;
+        }
+        HuaweiDataSyncCommon.ConfigData config = list.get(0);
+        HuaweiTLV tlv = new HuaweiTLV();
+        tlv.parse(config.configData);
+        if(!tlv.contains(0x02)) {
+            return;
+        }
+        try {
+        switch(config.configId) {
+            case STEPS_GOAL: {
+                int goal = tlv.getInteger(0x02);
+                SharedPreferences prefs = GBApplication.getPrefs().getPreferences();
+                SharedPreferences.Editor editor = prefs.edit();
+                editor.putString(ActivityUser.PREF_USER_STEPS_GOAL, String.valueOf(goal));
+                editor.apply();
+            } break;
+            case CALORIES_GOAL: {
+                int goal = tlv.getInteger(0x02);
+                SharedPreferences prefs = GBApplication.getPrefs().getPreferences();
+                SharedPreferences.Editor editor = prefs.edit();
+                editor.putString(ActivityUser.PREF_USER_CALORIES_BURNT, String.valueOf(goal / 1000));
+                editor.apply();
+            } break;
+            case EXERCISES_GOAL: {
+                int goal = tlv.getInteger(0x02);
+                SharedPreferences prefs = GBApplication.getPrefs().getPreferences();
+                SharedPreferences.Editor editor = prefs.edit();
+                editor.putString(ActivityUser.PREF_USER_GOAL_FAT_BURN_TIME_MINUTES, String.valueOf(goal));
+                editor.apply();
+            } break;
+            case STAND_GOAL: {
+                int goal = tlv.getInteger(0x02);
+                SharedPreferences prefs = GBApplication.getPrefs().getPreferences();
+                SharedPreferences.Editor editor = prefs.edit();
+                editor.putString(ActivityUser.PREF_USER_GOAL_STANDING_TIME_HOURS, String.valueOf(goal));
+                editor.apply();
+            } break;
+        }
+        } catch (HuaweiPacket.MissingTagException e) {
+            throw new RuntimeException(e);
+        }
+    }
+
+    @Override
+    public void onEventCommand(HuaweiDataSyncCommon.EventCommandData data) {
+
+    }
+
+    @Override
+    public void onDataCommand(HuaweiDataSyncCommon.DataCommandData data) {
+
+    }
+
+    @Override
+    public void onDictDataCommand(HuaweiDataSyncCommon.DictDataCommandData data) {
+
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncConfigCommand.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncConfigCommand.java
new file mode 100644
index 000000000..292a0ef79
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncConfigCommand.java
@@ -0,0 +1,38 @@
+package nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests;
+
+import java.util.List;
+
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.HuaweiPacket;
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.DataSync;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.HuaweiSupportProvider;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.datasync.HuaweiDataSyncCommon;
+
+public class SendDataSyncConfigCommand extends Request {
+
+    private final String srcPackage;
+    private final String dstPackage;
+    private final HuaweiDataSyncCommon.ConfigCommandData data;
+
+    public SendDataSyncConfigCommand(HuaweiSupportProvider support,
+                                     String srcPackage,
+                                     String dstPackage,
+                                     HuaweiDataSyncCommon.ConfigCommandData data) {
+        super(support);
+        this.serviceId = DataSync.id;
+        this.commandId = DataSync.ConfigCommand.id;
+
+        this.srcPackage = srcPackage;
+        this.dstPackage = dstPackage;
+        this.data = data;
+        this.addToResponse = false;
+    }
+
+    @Override
+    protected List<byte[]> createRequest() throws RequestCreationException {
+        try {
+            return new DataSync.ConfigCommand.Request(paramsProvider, this.srcPackage, this.dstPackage, this.data).serialize();
+        } catch (HuaweiPacket.CryptoException e) {
+            throw new RequestCreationException(e);
+        }
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncDataCommand.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncDataCommand.java
new file mode 100644
index 000000000..cd8f04297
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncDataCommand.java
@@ -0,0 +1,38 @@
+package nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests;
+
+import java.util.List;
+
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.HuaweiPacket;
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.DataSync;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.HuaweiSupportProvider;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.datasync.HuaweiDataSyncCommon;
+
+public class SendDataSyncDataCommand extends Request {
+
+    private final String srcPackage;
+    private final String dstPackage;
+    private final HuaweiDataSyncCommon.DataCommandData data;
+
+    public SendDataSyncDataCommand(HuaweiSupportProvider support,
+                                    String srcPackage,
+                                    String dstPackage,
+                                    HuaweiDataSyncCommon.DataCommandData data) {
+        super(support);
+        this.serviceId = DataSync.id;
+        this.commandId = DataSync.DataCommand.id;
+
+        this.srcPackage = srcPackage;
+        this.dstPackage = dstPackage;
+        this.data = data;
+        this.addToResponse = false;
+    }
+
+    @Override
+    protected List<byte[]> createRequest() throws RequestCreationException {
+        try {
+            return new DataSync.DataCommand.Request(paramsProvider, this.srcPackage, this.dstPackage, this.data).serialize();
+        } catch (HuaweiPacket.CryptoException e) {
+            throw new RequestCreationException(e);
+        }
+    }
+}
\ No newline at end of file
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncDictDataCommand.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncDictDataCommand.java
new file mode 100644
index 000000000..07fa4fc8f
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncDictDataCommand.java
@@ -0,0 +1,38 @@
+package nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests;
+
+import java.util.List;
+
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.HuaweiPacket;
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.DataSync;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.HuaweiSupportProvider;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.datasync.HuaweiDataSyncCommon;
+
+public class SendDataSyncDictDataCommand extends Request {
+
+    private final String srcPackage;
+    private final String dstPackage;
+    private final HuaweiDataSyncCommon.DictDataCommandData data;
+
+    public SendDataSyncDictDataCommand(HuaweiSupportProvider support,
+                                   String srcPackage,
+                                   String dstPackage,
+                                   HuaweiDataSyncCommon.DictDataCommandData data) {
+        super(support);
+        this.serviceId = DataSync.id;
+        this.commandId = DataSync.DictDataCommand.id;
+
+        this.srcPackage = srcPackage;
+        this.dstPackage = dstPackage;
+        this.data = data;
+        this.addToResponse = false;
+    }
+
+    @Override
+    protected List<byte[]> createRequest() throws RequestCreationException {
+        try {
+            return new DataSync.DictDataCommand.Request(paramsProvider, this.srcPackage, this.dstPackage, this.data).serialize();
+        } catch (HuaweiPacket.CryptoException e) {
+            throw new RequestCreationException(e);
+        }
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncEventCommand.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncEventCommand.java
new file mode 100644
index 000000000..cd62aa643
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendDataSyncEventCommand.java
@@ -0,0 +1,38 @@
+package nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.requests;
+
+import java.util.List;
+
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.HuaweiPacket;
+import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.DataSync;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.HuaweiSupportProvider;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.datasync.HuaweiDataSyncCommon;
+
+public class SendDataSyncEventCommand extends Request {
+
+    private final String srcPackage;
+    private final String dstPackage;
+    private final HuaweiDataSyncCommon.EventCommandData data;
+
+    public SendDataSyncEventCommand(HuaweiSupportProvider support,
+                                     String srcPackage,
+                                     String dstPackage,
+                                     HuaweiDataSyncCommon.EventCommandData data) {
+        super(support);
+        this.serviceId = DataSync.id;
+        this.commandId = DataSync.EventCommand.id;
+
+        this.srcPackage = srcPackage;
+        this.dstPackage = dstPackage;
+        this.data = data;
+        this.addToResponse = false;
+    }
+
+    @Override
+    protected List<byte[]> createRequest() throws RequestCreationException {
+        try {
+            return new DataSync.EventCommand.Request(paramsProvider, this.srcPackage, this.dstPackage, this.data).serialize();
+        } catch (HuaweiPacket.CryptoException e) {
+            throw new RequestCreationException(e);
+        }
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendP2PCommand.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendP2PCommand.java
index f73658470..995f0bc66 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendP2PCommand.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huawei/requests/SendP2PCommand.java
@@ -5,24 +5,21 @@ import org.slf4j.LoggerFactory;
 
 import java.util.List;
 
-import nodomain.freeyourgadget.gadgetbridge.GBApplication;
-import nodomain.freeyourgadget.gadgetbridge.devices.huawei.HuaweiConstants;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.HuaweiPacket;
-import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.AccountRelated;
 import nodomain.freeyourgadget.gadgetbridge.devices.huawei.packets.P2P;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.huawei.HuaweiSupportProvider;
 
 public class SendP2PCommand extends Request {
-    private static final Logger LOG = LoggerFactory.getLogger(SendAccountRequest.class);
+    private static final Logger LOG = LoggerFactory.getLogger(SendP2PCommand.class);
 
-    private byte cmdId;
-    private short sequenceId;
-    private String srcPackage;
-    private String dstPackage;
-    private String srcFingerprint = null;
-    private String dstFingerprint = null;
-    private byte[] sendData = null;
-    private int sendCode = 0;
+    private final byte cmdId;
+    private final short sequenceId;
+    private final String srcPackage;
+    private final String dstPackage;
+    private final String srcFingerprint;
+    private final String dstFingerprint;
+    private final byte[] sendData;
+    private final int sendCode;
 
     public SendP2PCommand(HuaweiSupportProvider support,
                           byte cmdId,
```
-----------------------------------
