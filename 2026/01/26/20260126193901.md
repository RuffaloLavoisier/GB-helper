# Commit: c1adf8b37f5eec5b031085980dd3f01c6e93cb68
## Message: Add a line chart over all VO2max values on devices not supporting separate cycling/running VO2max

And also add a generic vo2max gauge.
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/VO2MaxFragment.java

app/src/main/res/layout/fragment_vo2max.xml

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/VO2MaxFragment.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/VO2MaxFragment.java
index bcaedfd7e5..6012747b2d 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/VO2MaxFragment.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/charts/VO2MaxFragment.java
@@ -67,12 +67,15 @@ public class VO2MaxFragment extends AbstractChartFragment<VO2MaxFragment.VO2MaxD
     private TextView mDateView;
     private TextView vo2MaxRunningValue;
     private TextView vo2MaxCyclingValue;
+    private TextView vo2MaxValue;
     private ImageView vo2MaxRunningGauge;
     private ImageView vo2MaxCyclingGauge;
+    private ImageView vo2MaxGauge;
     protected GaugeDrawer gaugeDrawer = new GaugeDrawer();
     private LineChart vo2MaxChart;
     private RelativeLayout vo2maxCyclingWrapper;
     private RelativeLayout vo2maxRunningWrapper;
+    private RelativeLayout vo2maxWrapper;
     private GridLayout tilesGridWrapper;
     private int tsFrom;
     GBDevice device;
@@ -88,11 +91,14 @@ public class VO2MaxFragment extends AbstractChartFragment<VO2MaxFragment.VO2MaxD
         mDateView = rootView.findViewById(R.id.vo2max_date_view);
         vo2MaxRunningValue = rootView.findViewById(R.id.vo2max_running_gauge_value);
         vo2MaxCyclingValue = rootView.findViewById(R.id.vo2max_cycling_gauge_value);
+        vo2MaxValue = rootView.findViewById(R.id.vo2max_gauge_value);
         vo2MaxRunningGauge = rootView.findViewById(R.id.vo2max_running_gauge);
         vo2MaxCyclingGauge = rootView.findViewById(R.id.vo2max_cycling_gauge);
+        vo2MaxGauge = rootView.findViewById(R.id.vo2max_gauge);
         vo2MaxChart = rootView.findViewById(R.id.vo2max_chart);
         vo2maxCyclingWrapper = rootView.findViewById(R.id.vo2max_cycling_card_layout);
         vo2maxRunningWrapper = rootView.findViewById(R.id.vo2max_running_card_layout);
+        vo2maxWrapper = rootView.findViewById(R.id.vo2max_card_layout);
         tilesGridWrapper = rootView.findViewById(R.id.tiles_grid_wrapper);
         device = getChartsHost().getDevice();
         if (!supportsVO2MaxCycling(device)) {
@@ -101,6 +107,9 @@ public class VO2MaxFragment extends AbstractChartFragment<VO2MaxFragment.VO2MaxD
         if (!supportsVO2MaxRunning(device)) {
             tilesGridWrapper.removeView(vo2maxRunningWrapper);
         }
+        if (supportsVO2MaxRunning(device) || supportsVO2MaxCycling(device)) {
+            tilesGridWrapper.removeView(vo2maxWrapper);
+        }
         setupVO2MaxChart();
         refresh();
         setupLegend(vo2MaxChart);
@@ -163,14 +172,17 @@ public class VO2MaxFragment extends AbstractChartFragment<VO2MaxFragment.VO2MaxD
 
         List<Entry> runningEntries = new ArrayList<>();
         List<Entry> cyclingEntries = new ArrayList<>();
+        List<Entry> allEntries = new ArrayList<>();
         vo2MaxData.records.forEach((record) -> {
             float nd = (float) (record.timestamp - this.tsFrom) / (60 * 60 * 24);
+            Entry entry = new Entry(nd, record.value);
+            allEntries.add(entry);
             switch (record.type) {
                 case RUNNING:
-                    runningEntries.add(new Entry(nd, record.value));
+                    runningEntries.add(entry);
                     break;
                 case CYCLING:
-                    cyclingEntries.add(new Entry(nd, record.value));
+                    cyclingEntries.add(entry);
                     break;
             }
         });
@@ -192,6 +204,13 @@ public class VO2MaxFragment extends AbstractChartFragment<VO2MaxFragment.VO2MaxD
             vo2MaxCyclingValue.setText(String.valueOf(latestCyclingRecord != null ? Math.round(latestCyclingRecord.value) : "-"));
             lineDataSets.add(createDataSet(cyclingEntries, getResources().getColor(R.color.vo2max_cycling_char_line_color), getString(R.string.vo2max_cycling)));
         }
+        if (!supportsVO2MaxRunning(device) && !supportsVO2MaxCycling(device)) {
+            VO2MaxRecord latestRecord = vo2MaxData.getLatestValue(Vo2MaxSample.Type.ANY);
+            float vO2MaxValue = calculateVO2maxGaugeValue(vo2MaxRanges, latestRecord != null ? latestRecord.value : 0);
+            gaugeDrawer.drawSegmentedGauge(vo2MaxGauge, colors, segments, vO2MaxValue, false, true);
+            vo2MaxValue.setText(String.valueOf(latestRecord != null ? Math.round(latestRecord.value) : "-"));
+            lineDataSets.add(createDataSet(allEntries, getResources().getColor(R.color.vo2max_running_char_line_color), getString(R.string.menuitem_vo2_max)));
+        }
         final LineData lineData = new LineData(lineDataSets);
         vo2MaxChart.getXAxis().setValueFormatter(getVO2MaxLineChartValueFormatter());
         vo2MaxChart.setData(lineData);
diff --git a/app/src/main/res/layout/fragment_vo2max.xml b/app/src/main/res/layout/fragment_vo2max.xml
index 726962500d..4ffd475e2a 100644
--- a/app/src/main/res/layout/fragment_vo2max.xml
+++ b/app/src/main/res/layout/fragment_vo2max.xml
@@ -98,7 +98,43 @@
                     android:text="@string/title_cycling" />
 
             </RelativeLayout>
+            <RelativeLayout
+                android:id="@+id/vo2max_card_layout"
+                android:layout_width="wrap_content"
+                android:layout_height="wrap_content"
+                android:layout_margin="8dp"
+                android:orientation="vertical"
+                tools:ignore="UselessParent"
+                android:layout_gravity="fill"
+                android:layout_columnWeight="1"
+                >
 
+                <ImageView
+                    android:id="@+id/vo2max_gauge"
+                    android:layout_width="150dp"
+                    android:layout_height="75dp"
+                    android:layout_centerHorizontal="true"
+                    android:scaleType="fitStart" />
+
+                <TextView
+                    android:id="@+id/vo2max_gauge_value"
+                    android:layout_width="wrap_content"
+                    android:layout_height="wrap_content"
+                    android:layout_centerHorizontal="true"
+                    android:layout_marginTop="28dp"
+                    android:text="@string/stats_empty_value"
+                    android:textColor="?attr/textColorPrimary"
+                    android:textSize="30sp" />
+
+                <TextView
+                    android:id="@+id/vo2max_gauge_label"
+                    android:layout_width="wrap_content"
+                    android:layout_height="wrap_content"
+                    android:layout_below="@+id/vo2max_gauge_value"
+                    android:layout_centerHorizontal="true"
+                    android:text="@string/menuitem_vo2_max" />
+
+            </RelativeLayout>
         </GridLayout>
         <TextView
             android:layout_marginTop="30dp"
```
-----------------------------------
