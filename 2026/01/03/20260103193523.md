# Commit: 58f3e2e357fe1a035cf6dfc99bc7080a19b7ac38
## Message: Divoom Pixoo: Switch to BTBR support class
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/divoom/PixooSupport.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/divoom/PixooIOThread.java

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/divoom/PixooIOThread.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/divoom/PixooIOThread.java
deleted file mode 100644
index 3834870684..0000000000
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/divoom/PixooIOThread.java
+++ /dev/null
@@ -1,61 +0,0 @@
-/*  Copyright (C) 2023-2024 Andreas Shimokawa
-
-    This file is part of Gadgetbridge.
-
-    Gadgetbridge is free software: you can redistribute it and/or modify
-    it under the terms of the GNU Affero General Public License as published
-    by the Free Software Foundation, either version 3 of the License, or
-    (at your option) any later version.
-
-    Gadgetbridge is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU Affero General Public License for more details.
-
-    You should have received a copy of the GNU Affero General Public License
-    along with this program.  If not, see <https://www.gnu.org/licenses/>. */
-
-package nodomain.freeyourgadget.gadgetbridge.service.devices.divoom;
-
-import static nodomain.freeyourgadget.gadgetbridge.util.GB.hexdump;
-
-import android.bluetooth.BluetoothAdapter;
-import android.content.Context;
-import android.net.Uri;
-
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import java.io.IOException;
-import java.io.InputStream;
-import java.util.Arrays;
-
-import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
-import nodomain.freeyourgadget.gadgetbridge.service.btclassic.BtClassicIoThread;
-
-public class PixooIOThread extends BtClassicIoThread {
-    private static final Logger LOG = LoggerFactory.getLogger(PixooIOThread.class);
-    private final PixooProtocol mPixooProtocol;
-
-
-    @Override
-    protected void initialize() {
-        write(mPixooProtocol.encodeReqestAlarms());
-
-        setUpdateState(GBDevice.State.INITIALIZED);
-    }
-
-    public PixooIOThread(GBDevice device, Context context, PixooProtocol deviceProtocol,
-                         PixooSupport PixooSupport, BluetoothAdapter bluetoothAdapter) {
-        super(device, context, deviceProtocol, PixooSupport, bluetoothAdapter);
-        mPixooProtocol = deviceProtocol;
-    }
-
-    @Override
-    protected byte[] parseIncoming(InputStream inStream) throws IOException {
-        byte[] buffer = new byte[1048576]; //HUGE read
-        int bytes = inStream.read(buffer);
-        LOG.debug("read " + bytes + " bytes. " + hexdump(buffer, 0, bytes));
-        return Arrays.copyOf(buffer, bytes);
-    }
-}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/divoom/PixooSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/divoom/PixooSupport.java
index ac9ac54d99..2d164ce841 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/divoom/PixooSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/divoom/PixooSupport.java
@@ -22,39 +22,27 @@ import android.os.Bundle;
 
 import androidx.annotation.NonNull;
 
-import nodomain.freeyourgadget.gadgetbridge.service.serial.AbstractSerialDeviceSupport;
-import nodomain.freeyourgadget.gadgetbridge.service.serial.GBDeviceIoThread;
-import nodomain.freeyourgadget.gadgetbridge.service.serial.GBDeviceProtocol;
+import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
+import nodomain.freeyourgadget.gadgetbridge.service.btbr.TransactionBuilder;
+import nodomain.freeyourgadget.gadgetbridge.service.serial.AbstractSerialDeviceSupportV2;
 
-public class PixooSupport extends AbstractSerialDeviceSupport {
+public class PixooSupport extends AbstractSerialDeviceSupportV2<PixooProtocol> {
     @Override
-    public void onSendConfiguration(String config) {
-        super.onSendConfiguration(config);
-    }
-
-    @Override
-    public synchronized PixooIOThread getDeviceIOThread() {
-        return (PixooIOThread) super.getDeviceIOThread();
-    }
-
-    @Override
-    public boolean useAutoConnect() {
-        return false;
-    }
-
-    @Override
-    protected GBDeviceProtocol createDeviceProtocol() {
+    protected PixooProtocol createDeviceProtocol() {
         return new PixooProtocol(getDevice());
     }
 
     @Override
-    public void onInstallApp(Uri uri, @NonNull final Bundle options) {
-        getDeviceIOThread().write(((PixooProtocol) getDeviceProtocol()).encodeShowFrame(uri));
+    public void onInstallApp(final Uri uri, @NonNull final Bundle options) {
+        final TransactionBuilder builder = createTransactionBuilder("show frame");
+        builder.write(mDeviceProtocol.encodeShowFrame(uri));
+        builder.queue();
     }
 
     @Override
-    protected GBDeviceIoThread createDeviceIOThread() {
-        return new PixooIOThread(getDevice(), getContext(), (PixooProtocol) getDeviceProtocol(),
-                PixooSupport.this, getBluetoothAdapter());
+    protected TransactionBuilder initializeDevice(final TransactionBuilder builder) {
+        builder.write(mDeviceProtocol.encodeReqestAlarms());
+        builder.setDeviceState(GBDevice.State.INITIALIZED);
+        return builder;
     }
 }
```
-----------------------------------
