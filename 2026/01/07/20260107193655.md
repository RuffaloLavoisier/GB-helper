# Commit: 3fe147247e9fe3f14b250bf7643c59352092289c
## Message: Fix last sample sync issue by making slice boundaries inclusive

Changed boundary checks from exclusive [start, end) to inclusive [start, end] to ensure samples occurring exactly at slice boundaries are synced correctly. This fixes the issue where the last sample in the database would never get synced because it was filtered out by the exclusive end boundary check while the sync state advanced to its timestamp.

Affected syncers:
- AbstractTimeSampleSyncer (HRV, SpO2, Weight, etc.)
- StepsSyncer
- HeartRateSyncer
- SleepSyncer
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/AbstractTimeSampleSyncer.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/HeartRateSync.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/SleepSyncer.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/StepsSync.kt

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/AbstractTimeSampleSyncer.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/AbstractTimeSampleSyncer.kt
index 493825ca30..cef7e0c3b9 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/AbstractTimeSampleSyncer.kt
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/AbstractTimeSampleSyncer.kt
@@ -102,7 +102,8 @@ internal abstract class AbstractTimeSampleSyncer<TSample : TimeSample, TRecord :
 
         val recordsToInsert = samples.filter {
             val timestamp = Instant.ofEpochMilli(it.timestamp)
-            if (timestamp.isBefore(sliceStartBoundary) || !timestamp.isBefore(sliceEndBoundary)) {
+            // Use inclusive boundaries [sliceStart, sliceEnd] to ensure last sample is included
+            if (timestamp.isBefore(sliceStartBoundary) || timestamp.isAfter(sliceEndBoundary)) {
                 logger.debug(
                     "Skipping sample for at {} as it's outside the slice {} - {}.",
                     timestamp,
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/HeartRateSync.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/HeartRateSync.kt
index ac79c54d3f..3450a068ed 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/HeartRateSync.kt
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/HeartRateSync.kt
@@ -77,8 +77,8 @@ internal object HeartRateSyncer : ActivitySampleSyncer {
         for (gbSample in validHRSamples) {
             val currentSampleTimestamp = Instant.ofEpochSecond(gbSample.timestamp.toLong())
 
-            // Ensure sample is strictly within the slice [sliceStartBoundary, sliceEndBoundary)
-            if (currentSampleTimestamp.isBefore(sliceStartBoundary) || !currentSampleTimestamp.isBefore(sliceEndBoundary)) {
+            // Use inclusive boundaries [sliceStart, sliceEnd] for the slice
+            if (currentSampleTimestamp.isBefore(sliceStartBoundary) || currentSampleTimestamp.isAfter(sliceEndBoundary)) {
                 skippedCount++
                 continue
             }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/SleepSyncer.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/SleepSyncer.kt
index f62c07dedf..83e1c1d6ba 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/SleepSyncer.kt
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/SleepSyncer.kt
@@ -122,8 +122,9 @@ internal object SleepSyncer : ContextualActivitySampleSyncer {
         val sessionBoundaryStart = analysisSession.sleepStart.toInstant()
         val sessionBoundaryEndInclusive = analysisSession.sleepEnd.toInstant()
 
-        // Check if session overlaps with the current slice
-        if (!sessionBoundaryStart.isBefore(sliceEndBoundary) || !sessionBoundaryEndInclusive.isAfter(sliceStartBoundary)) {
+        // Check if session overlaps with the current slice (inclusive boundaries [sliceStart, sliceEnd])
+        // Skip if: sessionStart > sliceEnd OR sessionEnd < sliceStart
+        if (sessionBoundaryStart.isAfter(sliceEndBoundary) || sessionBoundaryEndInclusive.isBefore(sliceStartBoundary)) {
             LOG.debug(
                 "Skipping sleep session (identified by SleepAnalysis) for device '{}' (Timeframe: {} to {}) as it does not overlap with current slice ({} to {}).",
                 deviceName,
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/StepsSync.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/StepsSync.kt
index 44ce1c12a3..7970b6ee09 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/StepsSync.kt
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/healthconnect/syncers/StepsSync.kt
@@ -69,8 +69,9 @@ internal object StepsSyncer : ActivitySampleSyncer {
                 val endTs = Instant.ofEpochSecond(currentSample.timestamp.toLong())
                 val startTs = endTs.minus(1, ChronoUnit.MINUTES)
 
-                // Ensure the record's interval [startTs, endTs) overlaps with the slice [sliceStartBoundary, sliceEndBoundary)
-                if (endTs.isAfter(sliceStartBoundary) && startTs.isBefore(sliceEndBoundary)) {
+                // Use inclusive boundaries [sliceStart, sliceEnd] for the slice
+                // Overlap check: interval overlaps if endTs > sliceStart AND startTs <= sliceEnd
+                if (endTs.isAfter(sliceStartBoundary) && !startTs.isAfter(sliceEndBoundary)) {
                     stepsRecordList.add(StepsRecord(startTs, offset, endTs, offset, stepsInMinute, metadata))
                 } else {
                     skippedCount++
```
-----------------------------------
