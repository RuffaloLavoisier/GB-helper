# Commit: 489bff52e206ada75be9833edb5b8fe74433b5d6
## Message: Garmin: Allow firewalled app internet access
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/internet/InternetFirewallActivity.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/internet/InternetFirewallRulesAdapter.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/FirewallAction.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/InternetFirewall.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/InternetRequestType.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/FirewallInterceptor.java

app/src/main/res/layout/activity_internet_firewall.xml

app/src/main/res/layout/dialog_firewall_add_rule.xml

app/src/main/res/layout/firewall_rule_item.xml

app/src/main/res/xml/devicesettings_device_internet_firewall.xml

app/src/main/res/xml/devicesettings_root_internet.xml

GBDaoGenerator/src/nodomain/freeyourgadget/gadgetbridge/daogen/GBDaoGenerator.java

app/src/main/AndroidManifest.xml

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/GBApplication.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/ExternalPebbleJSActivity.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/appmanager/RebbleAppStoreActivity.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/devicesettings/DeviceSpecificSettingsFragment.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/devicesettings/DeviceSpecificSettingsScreen.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinator.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/banglejs/AppsManagementActivity.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/garmin/GarminCoordinator.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupport.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/ProtocolBufferHandler.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/GarminHttpRequest.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/GarminHttpResponse.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/HttpHandler.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/AgpsInterceptor.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/ContactsInterceptor.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/ImageServiceInterceptor.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/WeatherInterceptor.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/zeppos/services/ZeppOsHttpService.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/webview/PebbleJsService.kt

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/HttpUtils.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/webview/GBWebClient.java

app/src/main/proto/garmin/gdi_http_service.proto

app/src/main/res/values/strings.xml

## Diff:
```
diff --git a/GBDaoGenerator/src/nodomain/freeyourgadget/gadgetbridge/daogen/GBDaoGenerator.java b/GBDaoGenerator/src/nodomain/freeyourgadget/gadgetbridge/daogen/GBDaoGenerator.java
index ca8668c19d..ed9d873339 100644
--- a/GBDaoGenerator/src/nodomain/freeyourgadget/gadgetbridge/daogen/GBDaoGenerator.java
+++ b/GBDaoGenerator/src/nodomain/freeyourgadget/gadgetbridge/daogen/GBDaoGenerator.java
@@ -72,7 +72,7 @@ public class GBDaoGenerator {
             outputDir.mkdirs();
         }
 
-        final Schema schema = new Schema(125, MAIN_PACKAGE + ".entities");
+        final Schema schema = new Schema(126, MAIN_PACKAGE + ".entities");
 
         Entity userAttributes = addUserAttributes(schema);
         Entity user = addUserInfo(schema, userAttributes);
@@ -80,6 +80,7 @@ public class GBDaoGenerator {
         Entity deviceAttributes = addDeviceAttributes(schema);
         Entity device = addDevice(schema, deviceAttributes);
         addHealthConnectSyncState(schema, device);
+        addInternetFirewallRule(schema, device);
 
         // yeah deep shit, has to be here (after device) for db upgrade and column order
         // because addDevice adds a property to deviceAttributes also....
@@ -1342,6 +1343,25 @@ public class GBDaoGenerator {
         healthConnectSyncState.addLongProperty("lastSyncTimestamp").notNull();
     }
 
+    private static void addInternetFirewallRule(Schema schema, Entity device) {
+        Entity firewall = addEntity(schema, "InternetFirewallRule");
+        firewall.addIdProperty().autoincrement();
+
+        Property domain = firewall.addStringProperty("domain").notNull().getProperty();
+        firewall.addStringProperty("action").notNull();
+
+        // Might be null for global rules
+        Property deviceId = firewall.addLongProperty("deviceId").getProperty();
+        firewall.addToOne(device, deviceId);
+
+        final Index indexUnique = new Index();
+        indexUnique.addProperty(domain);
+        indexUnique.addProperty(deviceId);
+        indexUnique.makeUnique();
+
+        firewall.addIndex(indexUnique);
+    }
+
     private static void addAlarms(Schema schema, Entity user, Entity device) {
         Entity alarm = addEntity(schema, "Alarm");
         alarm.implementsInterface("nodomain.freeyourgadget.gadgetbridge.model.Alarm");
diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml
index 9539a1e01c..e8c018841d 100644
--- a/app/src/main/AndroidManifest.xml
+++ b/app/src/main/AndroidManifest.xml
@@ -243,6 +243,10 @@
             android:name=".activities.InternetHelperPreferencesActivity"
             android:label="@string/prefs_internet_helper_title"
             android:parentActivityName=".activities.SettingsActivity" />
+        <activity
+            android:name=".activities.internet.InternetFirewallActivity"
+            android:label="@string/internet_firewall_title"
+            android:parentActivityName=".activities.InternetHelperPreferencesActivity" />
         <activity
             android:name=".activities.preferences.HealthConnectPreferencesActivity"
             android:label="@string/healthconnect_settings"
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/GBApplication.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/GBApplication.java
index 136d60cd83..44184e6f49 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/GBApplication.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/GBApplication.java
@@ -328,6 +328,9 @@ public class GBApplication extends Application {
         if (prefs.getBoolean(GBPrefs.HEALTH_CONNECT_ENABLED, false)) {
             HealthConnectPermissionManager.checkAndRectifyPermissions(this);
         }
+
+        // Ensure the InternetHelper is bound, so that it works on first usage
+        InternetHelperSingleton.INSTANCE.ensureInternetHelperBound();
     }
 
     private void startNotificationCollectorMonitorService() {
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/ExternalPebbleJSActivity.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/ExternalPebbleJSActivity.java
index 6211e15657..baff788d67 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/ExternalPebbleJSActivity.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/ExternalPebbleJSActivity.java
@@ -44,6 +44,7 @@ import nodomain.freeyourgadget.gadgetbridge.GBApplication;
 import nodomain.freeyourgadget.gadgetbridge.R;
 import nodomain.freeyourgadget.gadgetbridge.devices.DeviceManager;
 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
+import nodomain.freeyourgadget.gadgetbridge.internet.InternetRequestType;
 import nodomain.freeyourgadget.gadgetbridge.model.DeviceService;
 import nodomain.freeyourgadget.gadgetbridge.model.DeviceType;
 import nodomain.freeyourgadget.gadgetbridge.service.DeviceCommunicationService;
@@ -119,7 +120,7 @@ public class ExternalPebbleJSActivity extends AbstractGBActivity {
         setContentView(R.layout.activity_legacy_external_pebble_js);
         myWebView = findViewById(R.id.configureWebview);
         myWebView.clearCache(true);
-        GBWebClient gbWebClient = new GBWebClient(GBWebClient.REQUEST_TYPE_PEBBLE_APP_CONFIG);
+        GBWebClient gbWebClient = new GBWebClient(InternetRequestType.PEBBLE_APP_CONFIG, device);
         myWebView.setWebViewClient(gbWebClient);
         myWebView.setWebChromeClient(new GBChromeClient());
         WebSettings webSettings = myWebView.getSettings();
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/appmanager/RebbleAppStoreActivity.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/appmanager/RebbleAppStoreActivity.kt
index 4014882ee1..44090edc58 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/appmanager/RebbleAppStoreActivity.kt
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/appmanager/RebbleAppStoreActivity.kt
@@ -32,6 +32,7 @@ import nodomain.freeyourgadget.gadgetbridge.database.DBHelper
 import nodomain.freeyourgadget.gadgetbridge.devices.InstallHandler
 import nodomain.freeyourgadget.gadgetbridge.entities.PebbleAppstoreIdEntry
 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice
+import nodomain.freeyourgadget.gadgetbridge.internet.InternetRequestType
 import nodomain.freeyourgadget.gadgetbridge.model.DeviceService
 import nodomain.freeyourgadget.gadgetbridge.util.GB
 import nodomain.freeyourgadget.gadgetbridge.util.InternetUtils
@@ -46,7 +47,7 @@ import java.io.File
 
 class RebbleAppStoreActivity : AbstractGBActivity()  {
     val LOG: Logger = LoggerFactory.getLogger(RebbleAppStoreActivity::class.java)
-    private var mGBDevice: GBDevice? = null
+    private lateinit var mGBDevice: GBDevice
     private var webView: WebView? = null
     private var url = "https://apps.rebble.io/en_US/watchfaces"
 
@@ -54,12 +55,10 @@ class RebbleAppStoreActivity : AbstractGBActivity()  {
         super.onCreate(savedInstanceState)
         setContentView(R.layout.activity_banglejs_apps_management)
 
-        val extras = intent.extras
-        if (extras != null) {
-            mGBDevice = extras.getParcelable(GBDevice.EXTRA_DEVICE)
-            url = extras.getString(DeviceService.EXTRA_URI, url)
-        }
-        requireNotNull(mGBDevice) { "Must provide a device when invoking this activity" }
+        val gbDevice: GBDevice? = intent?.extras?.getParcelable(GBDevice.EXTRA_DEVICE)
+        requireNotNull(gbDevice) { "Must provide a device when invoking this activity" }
+        mGBDevice = gbDevice
+        url = intent?.extras?.getString(DeviceService.EXTRA_URI, url)!!
         initViews()
     }
 
@@ -136,7 +135,7 @@ class RebbleAppStoreActivity : AbstractGBActivity()  {
         settings.loadWithOverviewMode = true
         settings.useWideViewPort = true
 
-        val gbWebClient = object : GBWebClient(REQUEST_TYPE_PEBBLE_APP_STORE) {
+        val gbWebClient = object : GBWebClient(InternetRequestType.PEBBLE_APP_STORE, mGBDevice) {
             override fun shouldOverrideUrlLoading(
                 wv: WebView,
                 request: WebResourceRequest
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/devicesettings/DeviceSpecificSettingsFragment.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/devicesettings/DeviceSpecificSettingsFragment.java
index 1d5335d094..b1a18b0232 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/devicesettings/DeviceSpecificSettingsFragment.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/devicesettings/DeviceSpecificSettingsFragment.java
@@ -79,6 +79,7 @@ import nodomain.freeyourgadget.gadgetbridge.activities.ConfigureWorldClocks;
 import nodomain.freeyourgadget.gadgetbridge.activities.NotificationsAppIconUploadActivity;
 import nodomain.freeyourgadget.gadgetbridge.activities.app_specific_notifications.AppSpecificNotificationSettingsActivity;
 import nodomain.freeyourgadget.gadgetbridge.activities.audiorecordings.AudioRecordingsActivity;
+import nodomain.freeyourgadget.gadgetbridge.activities.internet.InternetFirewallActivity;
 import nodomain.freeyourgadget.gadgetbridge.activities.loyaltycards.LoyaltyCardsSettingsActivity;
 import nodomain.freeyourgadget.gadgetbridge.activities.loyaltycards.LoyaltyCardsSettingsConst;
 import nodomain.freeyourgadget.gadgetbridge.activities.multipoint.MultipointPairingActivity;
@@ -1509,6 +1510,16 @@ public class DeviceSpecificSettingsFragment extends AbstractPreferenceFragment i
             });
         }
 
+        final Preference firewallPref = findPreference("pref_key_internet_firewall");
+        if (firewallPref != null) {
+            firewallPref.setOnPreferenceClickListener(preference -> {
+                final Intent intent = new Intent(getContext(), InternetFirewallActivity.class);
+                intent.putExtra(GBDevice.EXTRA_DEVICE, getDevice());
+                startActivity(intent);
+                return true;
+            });
+        }
+
         final Preference multipointPref = findPreference(PREF_MULTIPOINT);
         if (multipointPref != null) {
             multipointPref.setOnPreferenceClickListener(preference -> {
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/devicesettings/DeviceSpecificSettingsScreen.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/devicesettings/DeviceSpecificSettingsScreen.java
index a7a8197649..39c0fc43dc 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/devicesettings/DeviceSpecificSettingsScreen.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/devicesettings/DeviceSpecificSettingsScreen.java
@@ -30,6 +30,7 @@ public enum DeviceSpecificSettingsScreen {
     CALENDAR("pref_screen_calendar", R.xml.devicesettings_root_calendar),
     CALLS_AND_NOTIFICATIONS("pref_screen_calls_and_notifications", R.xml.devicesettings_root_calls_and_notifications),
     CONNECTION("pref_screen_connection", R.xml.devicesettings_root_connection),
+    INTERNET("pref_screen_internet", R.xml.devicesettings_root_internet),
     DASHBOARD("pref_screen_dashboard", R.xml.devicesettings_root_dashboard),
     DEVELOPER("pref_screen_developer", R.xml.devicesettings_root_developer),
     DISPLAY("pref_screen_display", R.xml.devicesettings_root_display),
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/internet/InternetFirewallActivity.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/internet/InternetFirewallActivity.kt
new file mode 100644
index 0000000000..e9f32e0eb3
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/internet/InternetFirewallActivity.kt
@@ -0,0 +1,241 @@
+/*  Copyright (C) 2026 José Rebelo
+
+    This file is part of Gadgetbridge.
+
+    Gadgetbridge is free software: you can redistribute it and/or modify
+    it under the terms of the GNU Affero General Public License as published
+    by the Free Software Foundation, either version 3 of the License, or
+    (at your option) any later version.
+
+    Gadgetbridge is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU Affero General Public License for more details.
+
+    You should have received a copy of the GNU Affero General Public License
+    along with this program.  If not, see <https://www.gnu.org/licenses/>. */
+package nodomain.freeyourgadget.gadgetbridge.activities.internet
+
+import android.os.Bundle
+import android.view.LayoutInflater
+import android.view.View
+import android.widget.ArrayAdapter
+import androidx.appcompat.app.AlertDialog
+import androidx.recyclerview.widget.LinearLayoutManager
+import com.google.android.material.dialog.MaterialAlertDialogBuilder
+import nodomain.freeyourgadget.gadgetbridge.GBApplication
+import nodomain.freeyourgadget.gadgetbridge.R
+import nodomain.freeyourgadget.gadgetbridge.activities.AbstractGBActivity
+import nodomain.freeyourgadget.gadgetbridge.database.DBHelper
+import nodomain.freeyourgadget.gadgetbridge.databinding.ActivityInternetFirewallBinding
+import nodomain.freeyourgadget.gadgetbridge.databinding.DialogFirewallAddRuleBinding
+import nodomain.freeyourgadget.gadgetbridge.entities.InternetFirewallRule
+import nodomain.freeyourgadget.gadgetbridge.entities.InternetFirewallRuleDao
+import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice
+import nodomain.freeyourgadget.gadgetbridge.internet.FirewallAction
+import org.slf4j.Logger
+import org.slf4j.LoggerFactory
+
+class InternetFirewallActivity : AbstractGBActivity() {
+    private lateinit var binding: ActivityInternetFirewallBinding
+    private lateinit var adapter: InternetFirewallRulesAdapter
+    private var device: GBDevice? = null
+
+    override fun onCreate(savedInstanceState: Bundle?) {
+        super.onCreate(savedInstanceState)
+
+        @Suppress("DEPRECATION")
+        device = if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.TIRAMISU) {
+            intent.getParcelableExtra(GBDevice.EXTRA_DEVICE, GBDevice::class.java)
+        } else {
+            intent.getParcelableExtra(GBDevice.EXTRA_DEVICE)
+        }
+
+        binding = ActivityInternetFirewallBinding.inflate(layoutInflater)
+        setContentView(binding.root)
+
+        adapter = InternetFirewallRulesAdapter(
+            onRuleClick = { rule -> showDomainDialog(rule) }
+        )
+
+        binding.firewallRulesList.layoutManager = LinearLayoutManager(this)
+        binding.firewallRulesList.adapter = adapter
+
+        // FAB
+        binding.fabAddDomain.setOnClickListener { showDomainDialog(null) }
+
+        // Show empty state initially, will be hidden if rules exist after load
+        updateEmptyState(true)
+
+        loadRules()
+    }
+
+    private fun loadRules() {
+        try {
+            GBApplication.acquireDB().use { db ->
+                val qb = db.daoSession.internetFirewallRuleDao.queryBuilder()
+                if (device != null) {
+                    // device-specific rules
+                    val deviceFromDb = DBHelper.getDevice(device, db.daoSession)
+                    qb.where(InternetFirewallRuleDao.Properties.DeviceId.eq(deviceFromDb.id))
+                } else {
+                    // global rules
+                    qb.where(InternetFirewallRuleDao.Properties.DeviceId.isNull)
+                }
+                qb.orderAsc(InternetFirewallRuleDao.Properties.Domain)
+                val rules = qb.list()
+                LOG.debug("Loaded {} firewall rules from database", rules.size)
+                adapter.updateRules(rules)
+                updateEmptyState(rules.isEmpty())
+            }
+        } catch (e: Exception) {
+            LOG.error("Error loading rules from database", e)
+            updateEmptyState(true)
+        }
+    }
+
+    private fun updateEmptyState(isEmpty: Boolean) {
+        binding.emptyStateText.text = getString(
+            R.string.internet_firewall_no_domains,
+            getString(R.string.internet_firewall_block)
+        )
+        if (isEmpty) {
+            binding.firewallRulesList.visibility = View.GONE
+            binding.emptyStateText.visibility = View.VISIBLE
+        } else {
+            binding.firewallRulesList.visibility = View.VISIBLE
+            binding.emptyStateText.visibility = View.GONE
+        }
+    }
+
+    private fun showDomainDialog(existingRule: InternetFirewallRule? = null) {
+        val dialogBinding = DialogFirewallAddRuleBinding.inflate(LayoutInflater.from(this))
+        val isEditing = existingRule != null
+
+        // Pre-populate fields if editing
+        if (isEditing) {
+            dialogBinding.domainInputText.setText(existingRule.domain)
+        }
+
+        // Setup dropdown with actions
+        val textAllow = getString(R.string.internet_firewall_allow)
+        val textBlock = getString(R.string.internet_firewall_block)
+        if (textAllow == textBlock) {
+            throw RuntimeException("Allow and block actions have the same translation!")
+        }
+
+        val actions = arrayOf(textAllow, textBlock,).sorted()
+        val actionAdapter = ArrayAdapter(this, android.R.layout.simple_dropdown_item_1line, actions)
+        dialogBinding.actionDropdown.setAdapter(actionAdapter)
+
+        // Set default action
+        val defaultActionIndex = if (isEditing) {
+            if (existingRule.action == FirewallAction.ALLOW.name) actions.indexOf(textAllow) else actions.indexOf(textBlock)
+        } else {
+            actions.indexOf(textAllow) // Default to "Allow" for new entries
+        }
+        dialogBinding.actionDropdown.setText(actions[defaultActionIndex], false)
+
+        val dialogBuilder = MaterialAlertDialogBuilder(this)
+            .setView(dialogBinding.root)
+            .setCancelable(true)
+            .setTitle(if (isEditing) R.string.internet_firewall_edit_domain else R.string.internet_firewall_add_domain)
+            .setPositiveButton(if (isEditing) R.string.save else R.string.ok) { _, _ ->
+                val domain = dialogBinding.domainInputText.text.toString().trim()
+                val selectedAction = dialogBinding.actionDropdown.text.toString()
+                val action = if (selectedAction == textAllow) {
+                    FirewallAction.ALLOW.name
+                } else {
+                    FirewallAction.BLOCK.name
+                }
+
+                if (isEditing) {
+                    updateRuleInDatabase(existingRule, domain, action)
+                } else {
+                    saveRuleToDatabase(domain, action)
+                }
+                loadRules()
+            }.setNegativeButton(R.string.Cancel, null)
+
+        // Add delete button if editing
+        if (isEditing) {
+            dialogBuilder.setNeutralButton(R.string.Delete) { _, _ ->
+                deleteRuleFromDatabase(existingRule)
+                loadRules()
+            }
+        }
+
+        val dialog = dialogBuilder.show()
+
+        // Disable OK/Save button if adding new domain. When editing, it's valid from the start
+        val okButton = dialog.getButton(AlertDialog.BUTTON_POSITIVE)
+        if (!isEditing) {
+            okButton.isEnabled = false
+        }
+
+        // Ensure valid domain
+        dialogBinding.domainInputText.addTextChangedListener(object : android.text.TextWatcher {
+            override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) {}
+            override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) {}
+            override fun afterTextChanged(s: android.text.Editable?) {
+                val domain = s.toString().trim()
+                val isValid = domain.isNotBlank()
+                okButton.isEnabled = isValid
+
+                //if (domain.isEmpty() || isValid) {
+                //    dialogBinding.domainInputLayout.error = null
+                //} else {
+                //    dialogBinding.domainInputLayout.error = getString(R.string.invalid_domain)
+                //}
+            }
+        })
+    }
+
+    private fun saveRuleToDatabase(domain: String, action: String) {
+        try {
+            GBApplication.acquireDB().use { db ->
+                val rule = InternetFirewallRule()
+                rule.domain = domain
+                rule.action = action
+                if (device != null) {
+                    val deviceFromDb = DBHelper.getDevice(device, db.daoSession)
+                    rule.deviceId = deviceFromDb.id
+                }
+                db.daoSession.internetFirewallRuleDao.insert(rule)
+                LOG.info("Added firewall rule: {} -> {}", domain, action)
+            }
+        } catch (e: Exception) {
+            LOG.error("Error adding domain to database", e)
+        }
+    }
+
+    private fun updateRuleInDatabase(rule: InternetFirewallRule, newDomain: String, newAction: String) {
+        LOG.info("Updating firewall rule: {}/{} -> {}/{}", rule.domain, rule.action, newDomain, newAction)
+
+        try {
+            GBApplication.acquireDB().use { db ->
+                rule.domain = newDomain
+                rule.action = newAction
+                db.daoSession.internetFirewallRuleDao.update(rule)
+            }
+        } catch (e: Exception) {
+            LOG.error("Error updating rule in database", e)
+        }
+    }
+
+    private fun deleteRuleFromDatabase(rule: InternetFirewallRule) {
+        LOG.info("Deleting firewall rule: {}/{}", rule.domain, rule.action)
+
+        try {
+            GBApplication.acquireDB().use { db ->
+                db.daoSession.internetFirewallRuleDao.delete(rule)
+            }
+        } catch (e: Exception) {
+            LOG.error("Error deleting rule from database", e)
+        }
+    }
+
+    companion object {
+        private val LOG: Logger = LoggerFactory.getLogger(InternetFirewallActivity::class.java)
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/internet/InternetFirewallRulesAdapter.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/internet/InternetFirewallRulesAdapter.kt
new file mode 100644
index 0000000000..08dd996f1f
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/activities/internet/InternetFirewallRulesAdapter.kt
@@ -0,0 +1,65 @@
+/*  Copyright (C) 2026 José Rebelo
+
+    This file is part of Gadgetbridge.
+
+    Gadgetbridge is free software: you can redistribute it and/or modify
+    it under the terms of the GNU Affero General Public License as published
+    by the Free Software Foundation, either version 3 of the License, or
+    (at your option) any later version.
+
+    Gadgetbridge is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU Affero General Public License for more details.
+
+    You should have received a copy of the GNU Affero General Public License
+    along with this program.  If not, see <https://www.gnu.org/licenses/>. */
+package nodomain.freeyourgadget.gadgetbridge.activities.internet
+
+import android.annotation.SuppressLint
+import android.view.LayoutInflater
+import android.view.ViewGroup
+import androidx.recyclerview.widget.RecyclerView
+import nodomain.freeyourgadget.gadgetbridge.R
+import nodomain.freeyourgadget.gadgetbridge.databinding.FirewallRuleItemBinding
+import nodomain.freeyourgadget.gadgetbridge.entities.InternetFirewallRule
+
+class InternetFirewallRulesAdapter(
+    private val onRuleClick: (InternetFirewallRule) -> Unit
+) : RecyclerView.Adapter<InternetFirewallRulesAdapter.RuleViewHolder>() {
+
+    private val rules = mutableListOf<InternetFirewallRule>()
+
+    @SuppressLint("NotifyDataSetChanged")
+    fun updateRules(newRules: List<InternetFirewallRule>) {
+        rules.clear()
+        rules.addAll(newRules)
+        notifyDataSetChanged()
+    }
+
+    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RuleViewHolder {
+        val binding = FirewallRuleItemBinding.inflate(LayoutInflater.from(parent.context), parent, false)
+        return RuleViewHolder(binding)
+    }
+
+    override fun onBindViewHolder(holder: RuleViewHolder, position: Int) {
+        holder.bind(rules[position], onRuleClick)
+    }
+
+    override fun getItemCount(): Int = rules.size
+
+    class RuleViewHolder(val binding: FirewallRuleItemBinding) : RecyclerView.ViewHolder(binding.root) {
+        fun bind(rule: InternetFirewallRule, onRuleClick: (InternetFirewallRule) -> Unit) {
+            binding.domainText.text = rule.domain
+
+            val context = itemView.context
+            binding.actionText.text = when (rule.action) {
+                "ALLOW" -> context.getString(R.string.internet_firewall_allow)
+                "BLOCK" -> context.getString(R.string.internet_firewall_block)
+                else -> rule.action
+            }
+
+            itemView.setOnClickListener { onRuleClick(rule) }
+        }
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinator.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinator.java
index 2291a25aa2..e17ea2e5a7 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinator.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinator.java
@@ -77,6 +77,7 @@ import nodomain.freeyourgadget.gadgetbridge.entities.DeviceAttributesDao;
 import nodomain.freeyourgadget.gadgetbridge.entities.GenericTrainingLoadAcuteSample;
 import nodomain.freeyourgadget.gadgetbridge.entities.GenericTrainingLoadChronicSample;
 import nodomain.freeyourgadget.gadgetbridge.entities.HealthConnectSyncStateDao;
+import nodomain.freeyourgadget.gadgetbridge.entities.InternetFirewallRuleDao;
 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
 import nodomain.freeyourgadget.gadgetbridge.impl.GBDeviceCandidate;
 import nodomain.freeyourgadget.gadgetbridge.model.AbstractNotificationPattern;
@@ -226,6 +227,7 @@ public abstract class AbstractDeviceCoordinator implements DeviceCoordinator {
                 deleteBy(session.getBatteryLevelDao(), BatteryLevelDao.Properties.DeviceId, device.getId());
                 deleteBy(session.getAlarmDao(), AlarmDao.Properties.DeviceId, device.getId());
                 deleteBy(session.getHealthConnectSyncStateDao(), HealthConnectSyncStateDao.Properties.DeviceId, device.getId());
+                deleteBy(session.getInternetFirewallRuleDao(), InternetFirewallRuleDao.Properties.DeviceId, device.getId());
                 session.getDeviceDao().delete(device);
             } else {
                 LOG.info("device to delete not found in db: {}", gbDevice);
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/banglejs/AppsManagementActivity.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/banglejs/AppsManagementActivity.java
index 1612f3ec9a..21c072631f 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/banglejs/AppsManagementActivity.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/banglejs/AppsManagementActivity.java
@@ -50,6 +50,7 @@ import nodomain.freeyourgadget.gadgetbridge.R;
 import nodomain.freeyourgadget.gadgetbridge.activities.AbstractGBActivity;
 import nodomain.freeyourgadget.gadgetbridge.devices.DeviceCoordinator;
 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
+import nodomain.freeyourgadget.gadgetbridge.internet.InternetRequestType;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.banglejs.BangleJSDeviceSupport;
 import nodomain.freeyourgadget.gadgetbridge.util.Prefs;
 import nodomain.freeyourgadget.gadgetbridge.webview.GBChromeClient;
@@ -219,7 +220,7 @@ public class AppsManagementActivity extends AbstractGBActivity {
         webView.addJavascriptInterface(new WebViewInterface(this), "Android");
         webView.setWebContentsDebuggingEnabled(true); // FIXME
 
-        GBWebClient gbWebClient = new GBWebClient(GBWebClient.REQUEST_TYPE_BANGLE_APP_LOADER){
+        GBWebClient gbWebClient = new GBWebClient(InternetRequestType.BANGLE_APP_LOADER, mGBDevice){
             @Override
             public void onPageFinished(WebView view, String weburl){
                 //webView.loadUrl("javascript:showToast('WebView in Espruino')");
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/garmin/GarminCoordinator.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/garmin/GarminCoordinator.java
index 307185d16d..b839d0318e 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/garmin/GarminCoordinator.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/garmin/GarminCoordinator.java
@@ -277,6 +277,12 @@ public abstract class GarminCoordinator extends AbstractBLEDeviceCoordinator {
         final List<Integer> connection = deviceSpecificSettings.addRootScreen(DeviceSpecificSettingsScreen.CONNECTION);
         connection.add(R.xml.devicesettings_high_mtu);
 
+        if (GBApplication.hasInternetAccess()) {
+            final List<Integer> internet = deviceSpecificSettings.addRootScreen(DeviceSpecificSettingsScreen.INTERNET);
+            internet.add(R.xml.devicesettings_device_internet_access);
+            internet.add(R.xml.devicesettings_device_internet_firewall);
+        }
+
         final List<Integer> developer = deviceSpecificSettings.addRootScreen(DeviceSpecificSettingsScreen.DEVELOPER);
         developer.add(R.xml.devicesettings_import_activity_files);
         developer.add(R.xml.devicesettings_reprocess_activity_files);
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/FirewallAction.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/FirewallAction.kt
new file mode 100644
index 0000000000..5a9bc5c85a
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/FirewallAction.kt
@@ -0,0 +1,6 @@
+package nodomain.freeyourgadget.gadgetbridge.internet
+
+enum class FirewallAction {
+    ALLOW,
+    BLOCK,
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/InternetFirewall.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/InternetFirewall.kt
new file mode 100644
index 0000000000..2e39583414
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/InternetFirewall.kt
@@ -0,0 +1,115 @@
+package nodomain.freeyourgadget.gadgetbridge.internet
+
+import android.net.Uri
+import nodomain.freeyourgadget.gadgetbridge.GBApplication
+import nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst
+import nodomain.freeyourgadget.gadgetbridge.database.DBHelper
+import nodomain.freeyourgadget.gadgetbridge.entities.InternetFirewallRule
+import nodomain.freeyourgadget.gadgetbridge.entities.InternetFirewallRuleDao
+import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice
+import nodomain.freeyourgadget.gadgetbridge.util.Prefs
+import org.slf4j.LoggerFactory
+
+class InternetFirewall(
+    private val requestType: InternetRequestType,
+    private val device: GBDevice
+) {
+    fun isAllowed(uri: Uri): Boolean {
+        val prefs = GBApplication.getPrefs()
+
+        when (requestType) {
+            InternetRequestType.PEBBLE_APP_STORE -> return prefs.getBoolean(
+                "pref_key_internethelper_allow_pebble_appstore",
+                false
+            )
+
+            InternetRequestType.PEBBLE_APP_CONFIG -> return prefs.getBoolean(
+                "pref_key_internethelper_allow_pebble_configs",
+                false
+            )
+
+            InternetRequestType.PEBBLE_BACKGROUND_JS -> return prefs.getBoolean(
+                "pref_key_internethelper_allow_pebble_background_js",
+                false
+            )
+
+            InternetRequestType.BANGLE_APP_LOADER -> {
+                if (GBApplication.hasDirectInternetAccess()) {
+                    // We're in the bangle build with direct internet access
+                    return true
+                }
+                return prefs.getBoolean(
+                    "pref_key_internethelper_allow_bangle_app_loader",
+                    false
+                )
+            }
+
+            InternetRequestType.WATCH_APP -> {
+                // Devices with watch app internet access must have devicesettings_device_internet_access
+                val devicePrefs: Prefs = GBApplication.getDevicePrefs(device)
+                if (!devicePrefs.getBoolean(DeviceSettingsPreferenceConst.PREF_DEVICE_INTERNET_ACCESS, false)) {
+                    LOG.warn("Device has no internet access enabled for watch apps")
+                    return false
+                }
+                return when (getFirewallAction(uri)) {
+                    FirewallAction.ALLOW -> true
+                    FirewallAction.BLOCK -> false
+                }
+            }
+        }
+    }
+
+    private fun getFirewallAction(uri: Uri): FirewallAction {
+        val defaultAction = FirewallAction.BLOCK
+        val rules: List<InternetFirewallRule>
+
+        try {
+            val deviceRules = GBApplication.acquireDB().use { db ->
+                val deviceFromDb = DBHelper.getDevice(device, db.daoSession)
+
+                val qb = db.getDaoSession().internetFirewallRuleDao.queryBuilder()
+                return@use qb
+                    .where(
+                        qb.and(
+                            InternetFirewallRuleDao.Properties.Domain.eq(uri.host),
+                            InternetFirewallRuleDao.Properties.DeviceId.eq(deviceFromDb.id)
+                        )
+                    ).build().list()
+            }
+
+            val globalRules = GBApplication.acquireDB().use { db ->
+                val qb = db.getDaoSession().internetFirewallRuleDao.queryBuilder()
+                return@use qb
+                    .where(
+                        qb.and(
+                            InternetFirewallRuleDao.Properties.Domain.eq(uri.host),
+                            InternetFirewallRuleDao.Properties.DeviceId.isNull
+                        )
+                    ).build().list()
+            }
+
+            LOG.debug("Got rules: {} device-specific / {} global", deviceRules.size, globalRules.size)
+
+            // Prioritize device-specific rules
+            rules = deviceRules + globalRules
+        } catch (e: Exception) {
+            LOG.error("Error reading firewall rules from db, default action is {}", defaultAction, e)
+            return defaultAction
+        }
+
+        if (rules.isEmpty()) {
+            LOG.debug("No rules matched for {}, default action is {}", uri, defaultAction)
+            return defaultAction
+        }
+
+        val action = FirewallAction.valueOf(rules[0].action)
+
+        LOG.debug("Firewall action: {} {}", action, uri)
+
+        return action
+    }
+
+    companion object {
+        private val LOG = LoggerFactory.getLogger(InternetFirewall::class.java)
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/InternetRequestType.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/InternetRequestType.kt
new file mode 100644
index 0000000000..c47b68bce1
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/internet/InternetRequestType.kt
@@ -0,0 +1,9 @@
+package nodomain.freeyourgadget.gadgetbridge.internet
+
+enum class InternetRequestType {
+    PEBBLE_APP_STORE,
+    PEBBLE_APP_CONFIG,
+    PEBBLE_BACKGROUND_JS,
+    BANGLE_APP_LOADER,
+    WATCH_APP,
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupport.java
index 9d8b18cf59..b0b2c2f765 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/GarminSupport.java
@@ -191,6 +191,7 @@ public class GarminSupport extends AbstractBTLESingleDeviceSupport implements IC
     public void setContext(final GBDevice gbDevice, final BluetoothAdapter btAdapter, final Context context) {
         super.setContext(gbDevice, btAdapter, context);
         this.mediaManager = new MediaManager(context);
+        this.protocolBufferHandler.setContext(gbDevice, btAdapter, context);
         this.transferNotification = new GBProgressNotification(context, GB.NOTIFICATION_CHANNEL_ID_TRANSFER);
     }
 
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/ProtocolBufferHandler.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/ProtocolBufferHandler.java
index 1a499dfb3c..3a45cc3e9a 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/ProtocolBufferHandler.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/ProtocolBufferHandler.java
@@ -2,6 +2,8 @@ package nodomain.freeyourgadget.gadgetbridge.service.devices.garmin;
 
 import static nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSettingsPreferenceConst.PREF_SYNC_CALENDAR;
 
+import android.bluetooth.BluetoothAdapter;
+import android.content.Context;
 import android.content.Intent;
 import android.graphics.Bitmap;
 import android.location.Location;
@@ -33,6 +35,7 @@ import nodomain.freeyourgadget.gadgetbridge.devices.garmin.GarminPreferences;
 import nodomain.freeyourgadget.gadgetbridge.devices.garmin.GarminRealtimeSettingsFragment;
 import nodomain.freeyourgadget.gadgetbridge.externalevents.gps.GBLocationProviderType;
 import nodomain.freeyourgadget.gadgetbridge.externalevents.gps.GBLocationService;
+import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
 import nodomain.freeyourgadget.gadgetbridge.model.CannedMessagesSpec;
 import nodomain.freeyourgadget.gadgetbridge.proto.garmin.GdiAuthenticationService;
 import nodomain.freeyourgadget.gadgetbridge.proto.garmin.GdiCalendarService;
@@ -53,6 +56,8 @@ import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http.HttpHand
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.messages.GFDIMessage;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.messages.ProtobufMessage;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.messages.status.ProtobufStatusMessage;
+import nodomain.freeyourgadget.gadgetbridge.util.MediaManager;
+import nodomain.freeyourgadget.gadgetbridge.util.notifications.GBProgressNotification;
 import nodomain.freeyourgadget.gadgetbridge.webview.CurrentPosition;
 import nodomain.freeyourgadget.gadgetbridge.util.DateTimeUtils;
 import nodomain.freeyourgadget.gadgetbridge.util.GB;
@@ -67,7 +72,7 @@ public class ProtocolBufferHandler implements MessageHandler {
     private final int maxChunkSize = 375; //tested on Vívomove Style
     private int lastProtobufRequestId;
     private final AppConfigHandler appConfigHandler;
-    private final HttpHandler httpHandler;
+    private HttpHandler httpHandler;
     private final DataTransferHandler dataTransferHandler;
     private final FileSyncServiceHandler fileSyncServiceHandler;
     private final EcgServiceHandler ecgServiceHandler;
@@ -78,12 +83,16 @@ public class ProtocolBufferHandler implements MessageHandler {
         this.deviceSupport = deviceSupport;
         chunkedFragmentsMap = new HashMap<>();
         appConfigHandler = new AppConfigHandler(deviceSupport);
-        httpHandler = new HttpHandler(deviceSupport);
         dataTransferHandler = new DataTransferHandler();
         fileSyncServiceHandler = new FileSyncServiceHandler(deviceSupport);
         ecgServiceHandler = new EcgServiceHandler(deviceSupport);
     }
 
+    public void setContext(final GBDevice gbDevice, final BluetoothAdapter btAdapter, final Context context) {
+        // http handler needs the device
+        httpHandler = new HttpHandler(deviceSupport);
+    }
+
     private int getNextProtobufRequestId() {
         lastProtobufRequestId = (lastProtobufRequestId + 1) % 65536;
         return lastProtobufRequestId;
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/GarminHttpRequest.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/GarminHttpRequest.java
index cdab877b47..2f6dc057a6 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/GarminHttpRequest.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/GarminHttpRequest.java
@@ -1,8 +1,12 @@
 package nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http;
 
-import java.net.MalformedURLException;
-import java.net.URL;
+import android.net.Uri;
+
+import com.google.gson.JsonElement;
+import com.google.gson.JsonObject;
+
 import java.util.HashMap;
+import java.util.LinkedHashMap;
 import java.util.List;
 import java.util.Locale;
 import java.util.Map;
@@ -12,42 +16,64 @@ import nodomain.freeyourgadget.gadgetbridge.util.HttpUtils;
 
 public class GarminHttpRequest {
     private final GdiHttpService.HttpService.RawRequest rawRequest;
+    private final GdiHttpService.HttpService.WebRequest webRequest;
 
-    private final String url;
-    private final String path;
-    private final Map<String, String> query;
+    private final String method;
+    private final Uri uri;
     private final Map<String, String> headers;
 
     public GarminHttpRequest(final GdiHttpService.HttpService.RawRequest rawRequest) {
         this.rawRequest = rawRequest;
-
-        final URL netUrl;
-        try {
-            netUrl = new URL(rawRequest.getUrl());
-        } catch (final MalformedURLException e) {
-            throw new IllegalArgumentException("Failed to parse url", e);
-        }
-
-        this.url = rawRequest.getUrl();
-        this.path = netUrl.getPath();
-        this.query = HttpUtils.urlQueryParameters(netUrl);
+        this.webRequest = null;
+        this.method = rawRequest.getMethod().name();
+        this.uri = Uri.parse(rawRequest.getUrl());
         this.headers = headersToMap(rawRequest.getHeaderList());
     }
 
+    public GarminHttpRequest(final GdiHttpService.HttpService.WebRequest webRequest) throws GarminJsonException {
+        this.rawRequest = null;
+        this.webRequest = webRequest;
+        this.method = webRequest.getMethod().name();
+        this.uri = Uri.parse(webRequest.getUrl());
+        final JsonElement garminHeaders = GarminJson.decode(webRequest.getHeaders().toByteArray());
+        this.headers = new LinkedHashMap<>();
+        if (garminHeaders instanceof JsonObject jsonObject) {
+            for (String key : jsonObject.keySet()) {
+                headers.put(key, jsonObject.get(key).getAsString());
+            }
+        }
+    }
+
     public GdiHttpService.HttpService.RawRequest getRawRequest() {
         return rawRequest;
     }
 
+    public Uri getUri() {
+        return uri;
+    }
+
+    public String getDomain() {
+        return uri.getHost();
+    }
+
     public String getUrl() {
-        return url;
+        return rawRequest != null ? rawRequest.getUrl() : webRequest.getUrl();
     }
 
     public String getPath() {
-        return path;
+        return uri.getPath();
+    }
+
+    public byte[] getBody() {
+        return rawRequest != null ? rawRequest.getRawBody().toByteArray() : webRequest.getBody().toByteArray();
+    }
+
+    public String getMethod() {
+        return method;
     }
 
     public Map<String, String> getQuery() {
-        return query;
+        return HttpUtils.urlQueryParameters(uri.getQuery());
     }
 
     public Map<String, String> getHeaders() {
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/GarminHttpResponse.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/GarminHttpResponse.java
index 9cbadaa68e..570485447d 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/GarminHttpResponse.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/GarminHttpResponse.java
@@ -11,6 +11,9 @@ public class GarminHttpResponse {
 
     private Callable<Void> onDataSuccessfullySentListener;
 
+    public GarminHttpResponse() {
+    }
+
     public int getStatus() {
         return status;
     }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/HttpHandler.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/HttpHandler.java
index 95d0f89f7a..0646138701 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/HttpHandler.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/HttpHandler.java
@@ -2,12 +2,20 @@ package nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http;
 
 import androidx.annotation.Nullable;
 
+import com.google.gson.JsonElement;
+import com.google.gson.JsonObject;
+import com.google.gson.JsonParser;
+import com.google.gson.JsonPrimitive;
 import com.google.protobuf.ByteString;
 
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
+import java.io.ByteArrayInputStream;
 import java.io.ByteArrayOutputStream;
+import java.io.IOException;
+import java.io.InputStreamReader;
+import java.nio.charset.StandardCharsets;
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.List;
@@ -19,23 +27,27 @@ import nodomain.freeyourgadget.gadgetbridge.proto.garmin.GdiHttpService;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.GarminSupport;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http.interceptors.AgpsInterceptor;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http.interceptors.ContactsInterceptor;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http.interceptors.FirewallInterceptor;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http.interceptors.HttpInterceptor;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http.interceptors.ImageServiceInterceptor;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http.interceptors.OauthInterceptor;
 import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http.interceptors.WeatherInterceptor;
 
+@SuppressWarnings("ClassCanBeRecord")
 public class HttpHandler {
     private static final Logger LOG = LoggerFactory.getLogger(HttpHandler.class);
 
     private final List<HttpInterceptor> interceptors;
 
-    public HttpHandler(GarminSupport deviceSupport) {
-        interceptors = Arrays.asList(
+    public HttpHandler(final GarminSupport deviceSupport) {
+        this.interceptors = Arrays.asList(
                 new WeatherInterceptor(),
                 new AgpsInterceptor(deviceSupport),
                 new ImageServiceInterceptor(deviceSupport),
                 new ContactsInterceptor(deviceSupport),
-                new OauthInterceptor(deviceSupport)
+                new OauthInterceptor(deviceSupport),
+                // Should always be the last one
+                new FirewallInterceptor(deviceSupport)
         );
     }
 
@@ -76,8 +88,6 @@ public class HttpHandler {
                     .build();
         }
 
-        LOG.debug("Http response status={}", response.getStatus());
-
         return createRawResponse(request, response);
     }
 
@@ -94,7 +104,13 @@ public class HttpHandler {
 
         final HttpInterceptor interceptor = interceptorOpt.get();
         LOG.debug("Handling request to {}", interceptor.getClass().getSimpleName());
-        return interceptor.handle(request);
+        final GarminHttpResponse response = interceptor.handle(request);
+        if (response != null) {
+            LOG.debug("Response from interceptor: {}, {} bytes", response.getStatus(), response.getBody().length);
+        } else {
+            LOG.debug("No response from interceptor");
+        }
+        return response;
     }
 
     private static GdiHttpService.HttpService.RawResponse createRawResponse(
@@ -163,8 +179,81 @@ public class HttpHandler {
     }
 
     public GdiHttpService.HttpService.WebResponse handleWebRequest(final GdiHttpService.HttpService.WebRequest webRequest) {
-        LOG.debug("Got webRequest: {} - {}", webRequest.getMethod(), webRequest.getUrl());
+        LOG.debug("Got webRequest: {} {}", webRequest.getMethod(), webRequest.getUrl());
 
-        return null;
+        try {
+            final GarminHttpRequest request = new GarminHttpRequest(webRequest);
+
+            final GarminHttpResponse response = handleRequest(request);
+
+            if (response == null) {
+                return GdiHttpService.HttpService.WebResponse.newBuilder()
+                        .setStatus(GdiHttpService.HttpService.Status.UNKNOWN_STATUS)
+                        .setHttpStatus(0)
+                        .build();
+            }
+
+            final byte[] headers;
+            if (webRequest.getHttpHeadersInResponse()) {
+                byte[] encodedHeaders = null;
+                try {
+                    final JsonObject jsonObject = new JsonObject();
+                    for (Map.Entry<String, String> e : response.getHeaders().entrySet()) {
+                        jsonObject.addProperty(e.getKey(), e.getValue());
+                    }
+                    encodedHeaders = GarminJson.encode(jsonObject);
+                } catch (final GarminJsonException e) {
+                    LOG.error("Failed to encode headers", e);
+                }
+                headers = encodedHeaders;
+            } else {
+                headers = null;
+            }
+
+            if (response.getBody().length > webRequest.getMaxResponseLength()) {
+                // TODO figure out the compression algorithm
+                return GdiHttpService.HttpService.WebResponse.newBuilder()
+                        .setStatus(GdiHttpService.HttpService.Status.FILE_TOO_LARGE)
+                        .setHttpStatus(0)
+                        .build();
+            }
+
+            final JsonElement jsonElement;
+            if ("application/json".equals(response.getHeaders().get("content-type"))) {
+                try (final InputStreamReader reader = new InputStreamReader(new ByteArrayInputStream(response.getBody()))) {
+                    jsonElement = JsonParser.parseReader(reader);
+                } catch (IOException e) {
+                    LOG.error("Failed to decode body as json", e);
+                    return GdiHttpService.HttpService.WebResponse.newBuilder()
+                            .setStatus(GdiHttpService.HttpService.Status.DATA_TRANSFER_ITEM_FAILURE)
+                            .setHttpStatus(0)
+                            .build();
+                }
+            } else if (webRequest.getResponseType() == GdiHttpService.HttpService.ResponseType.JSON) {
+                // We got non-json
+                return GdiHttpService.HttpService.WebResponse.newBuilder()
+                        .setStatus(GdiHttpService.HttpService.Status.DATA_TRANSFER_ITEM_FAILURE)
+                        .setHttpStatus(response.getStatus())
+                        .build();
+            } else {
+                jsonElement = new JsonPrimitive(new String(response.getBody(), StandardCharsets.UTF_8));
+            }
+            final byte[] body = GarminJson.encode(jsonElement);
+
+            final GdiHttpService.HttpService.WebResponse.Builder builder = GdiHttpService.HttpService.WebResponse.newBuilder()
+                    .setStatus(GdiHttpService.HttpService.Status.OK)
+                    .setHttpStatus(response.getStatus())
+                    .setBody(ByteString.copyFrom(body))
+                    .setSize(0); // 0 for non-compressed
+
+            if (headers != null) {
+                builder.setHeaders(ByteString.copyFrom(headers));
+            }
+
+            return builder.build();
+        } catch (final GarminJsonException e) {
+            LOG.error("Garmin json error (?)", e);
+            return null;
+        }
     }
 }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/AgpsInterceptor.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/AgpsInterceptor.java
index 7e07aec237..da63d7f500 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/AgpsInterceptor.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/AgpsInterceptor.java
@@ -42,7 +42,8 @@ public class AgpsInterceptor implements HttpInterceptor {
 
     @Override
     public boolean supports(@NotNull final GarminHttpRequest request) {
-        return request.getPath().startsWith("/ephemeris/");
+        return "api.gcs.garmin.com".equals(request.getDomain()) &&
+                request.getPath().startsWith("/ephemeris/");
     }
 
     @Override
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/ContactsInterceptor.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/ContactsInterceptor.java
index 2aea8018ff..b75183308c 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/ContactsInterceptor.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/ContactsInterceptor.java
@@ -31,7 +31,8 @@ public class ContactsInterceptor implements HttpInterceptor {
 
     @Override
     public boolean supports(@NotNull final GarminHttpRequest request) {
-        return request.getPath().startsWith("/device-gateway/usercontact/");
+        return "connectapi.garmin.com".equals(request.getDomain()) &&
+                request.getPath().startsWith("/device-gateway/usercontact/");
     }
 
     @Override
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/FirewallInterceptor.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/FirewallInterceptor.java
new file mode 100644
index 0000000000..145614f70a
--- /dev/null
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/FirewallInterceptor.java
@@ -0,0 +1,112 @@
+package nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http.interceptors;
+
+import android.os.RemoteException;
+import android.webkit.WebResourceResponse;
+
+import org.jetbrains.annotations.NotNull;
+import org.jetbrains.annotations.Nullable;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
+import java.io.ByteArrayOutputStream;
+import java.io.IOException;
+import java.io.InputStream;
+import java.nio.charset.StandardCharsets;
+
+import nodomain.freeyourgadget.gadgetbridge.GBApplication;
+import nodomain.freeyourgadget.gadgetbridge.internet.InternetFirewall;
+import nodomain.freeyourgadget.gadgetbridge.internet.InternetRequestType;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.GarminSupport;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http.GarminHttpRequest;
+import nodomain.freeyourgadget.gadgetbridge.service.devices.garmin.http.GarminHttpResponse;
+import nodomain.freeyourgadget.gadgetbridge.util.InternetHelperSingleton;
+import nodomain.freeyourgadget.internethelper.aidl.http.HttpRequest;
+
+@SuppressWarnings("ClassCanBeRecord")
+public class FirewallInterceptor implements HttpInterceptor {
+    private static final Logger LOG = LoggerFactory.getLogger(FirewallInterceptor.class);
+
+    private final InternetFirewall firewall;
+
+    public FirewallInterceptor(final GarminSupport deviceSupport) {
+        this.firewall = new InternetFirewall(InternetRequestType.WATCH_APP, deviceSupport.getDevice());
+    }
+
+    @Override
+    public boolean supports(@NotNull final GarminHttpRequest request) {
+        return true;
+    }
+
+    @Override
+    @Nullable
+    public GarminHttpResponse handle(@NotNull final GarminHttpRequest request) {
+        if (!GBApplication.hasInternetAccess()) {
+            LOG.warn("Gb has no internet access");
+            return null;
+        }
+
+        // Firewall checks the device_internet_access
+        if (!firewall.isAllowed(request.getUri())) {
+            LOG.warn("Firewall blocked the request");
+            return null;
+        }
+
+        if (request.getDomain().endsWith("garmin.com") || request.getDomain().endsWith("dciwx.com")) {
+            // For now, we explicitly block all requests to Garmin domains, even if the user whitelists them.
+            // Due to fake OAuth, most of these will include invalid authentication credentials, and needs
+            // further investigation
+            LOG.warn("Blocking request to Garmin url: {}", request.getDomain());
+            return null;
+        }
+
+        // TODO refactor this to be asynchronous
+        final WebResourceResponse response;
+        try {
+            response = InternetHelperSingleton.INSTANCE.send(
+                    request.getUri(),
+                    HttpRequest.Method.valueOf(request.getMethod()),
+                    request.getHeaders(),
+                    new String(request.getBody(), StandardCharsets.UTF_8), // FIXME we should be able to send the raw bytes
+                    "application/json",
+                    false
+            );
+        } catch (final RemoteException e) {
+            LOG.error("Remote exception", e);
+            return null;
+        } catch (final InterruptedException e) {
+            LOG.error("Request was interrupted", e);
+            return null;
+        }
+
+        if (response == null) {
+            LOG.error("Response is null");
+            return null;
+        }
+
+        final GarminHttpResponse garminHttpResponse = new GarminHttpResponse();
+        garminHttpResponse.setStatus(response.getStatusCode());
+        garminHttpResponse.getHeaders().putAll(response.getResponseHeaders());
+
+        try {
+            garminHttpResponse.setBody(readAllBytes(response.getData()));
+        } catch (final IOException e) {
+            LOG.error("Failed to read bytes from response", e);
+            return null;
+        }
+
+        return garminHttpResponse;
+    }
+
+    public static byte[] readAllBytes(final InputStream in) throws IOException {
+        final ByteArrayOutputStream out = new ByteArrayOutputStream();
+        byte[] buffer = new byte[4096];
+        while (true) {
+            int read = in.read(buffer);
+            if (read == -1) {
+                break;
+            }
+            out.write(buffer, 0, read);
+        }
+        return out.toByteArray();
+    }
+}
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/ImageServiceInterceptor.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/ImageServiceInterceptor.java
index 4805aa5cab..a7b6a1602c 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/ImageServiceInterceptor.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/ImageServiceInterceptor.java
@@ -44,7 +44,8 @@ public class ImageServiceInterceptor implements HttpInterceptor {
 
     @Override
     public boolean supports(@NotNull final GarminHttpRequest request) {
-        return request.getPath().startsWith("/image-service/");
+        return "api.gcs.garmin.com".equals(request.getDomain()) &&
+                request.getPath().startsWith("/image-service/");
     }
 
     @Override
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/WeatherInterceptor.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/WeatherInterceptor.java
index 5d650b853f..8174f7e344 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/WeatherInterceptor.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/garmin/http/interceptors/WeatherInterceptor.java
@@ -43,7 +43,8 @@ public class WeatherInterceptor implements HttpInterceptor {
 
     @Override
     public boolean supports(@NotNull final GarminHttpRequest request) {
-        return request.getPath().startsWith("/weather/");
+        return "api.gcs.garmin.com".equals(request.getDomain()) &&
+                request.getPath().startsWith("/weather/");
     }
 
     /// These get requested on connection at most every 5 minutes
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/zeppos/services/ZeppOsHttpService.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/zeppos/services/ZeppOsHttpService.java
index 3a36ae7907..42f9b9983b 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/zeppos/services/ZeppOsHttpService.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/huami/zeppos/services/ZeppOsHttpService.java
@@ -156,7 +156,7 @@ public class ZeppOsHttpService extends AbstractZeppOsService {
 
         final String host = url.getHost();
         final String path = url.getPath();
-        final Map<String, String> query = HttpUtils.urlQueryParameters(url);
+        final Map<String, String> query = HttpUtils.urlQueryParameters(url.getQuery());
 
         final int statusCode;
         final String response;
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/webview/PebbleJsService.kt b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/webview/PebbleJsService.kt
index 6703ec985a..4ef033b538 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/webview/PebbleJsService.kt
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/pebble/webview/PebbleJsService.kt
@@ -30,6 +30,7 @@ import android.webkit.WebView
 import androidx.core.app.NotificationCompat
 import nodomain.freeyourgadget.gadgetbridge.R
 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice
+import nodomain.freeyourgadget.gadgetbridge.internet.InternetRequestType
 import nodomain.freeyourgadget.gadgetbridge.util.GB
 import nodomain.freeyourgadget.gadgetbridge.webview.GBChromeClient
 import nodomain.freeyourgadget.gadgetbridge.webview.GBWebClient
@@ -103,7 +104,7 @@ class PebbleJsService : Service() {
                 LOG.info("WEBVIEW starting for device ${device.address}")
                 WebView.setWebContentsDebuggingEnabled(true)
                 val uiContext = applicationContext.createConfigurationContext(resources.configuration)
-                val gbWebClient = GBWebClient(GBWebClient.REQUEST_TYPE_PEBBLE_BACKGROUND_JS)
+                val gbWebClient = GBWebClient(InternetRequestType.PEBBLE_BACKGROUND_JS, device)
                 val wv = WebView(uiContext).apply {
                     settings.javaScriptEnabled = true
                     settings.domStorageEnabled = true
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/HttpUtils.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/HttpUtils.java
index cd2ea3ba1a..e2fce6b7d4 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/HttpUtils.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/util/HttpUtils.java
@@ -4,7 +4,6 @@ import org.apache.commons.lang3.StringUtils;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
-import java.net.URL;
 import java.net.URLDecoder;
 import java.util.Collections;
 import java.util.LinkedHashMap;
@@ -20,8 +19,7 @@ public class HttpUtils {
     /**
      * @noinspection CharsetObjectCanBeUsed not supported by SDK 21
      **/
-    public static Map<String, String> urlQueryParameters(final URL url) {
-        final String query = url.getQuery();
+    public static Map<String, String> urlQueryParameters(final String query) {
         if (StringUtils.isBlank(query)) {
             return Collections.emptyMap();
         }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/webview/GBWebClient.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/webview/GBWebClient.java
index 2994c0745e..249913add6 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/webview/GBWebClient.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/webview/GBWebClient.java
@@ -31,6 +31,7 @@ import net.e175.klaus.solarpositioning.SPA;
 import net.e175.klaus.solarpositioning.SunriseTransitSet;
 
 import org.apache.commons.lang3.StringUtils;
+import org.jetbrains.annotations.NotNull;
 import org.json.JSONArray;
 import org.json.JSONException;
 import org.json.JSONObject;
@@ -47,6 +48,9 @@ import java.util.List;
 import java.util.Map;
 
 import nodomain.freeyourgadget.gadgetbridge.GBApplication;
+import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
+import nodomain.freeyourgadget.gadgetbridge.internet.InternetFirewall;
+import nodomain.freeyourgadget.gadgetbridge.internet.InternetRequestType;
 import nodomain.freeyourgadget.gadgetbridge.model.WeatherSpec;
 import nodomain.freeyourgadget.gadgetbridge.model.weather.Weather;
 import nodomain.freeyourgadget.gadgetbridge.model.weather.WeatherMapper;
@@ -57,14 +61,9 @@ import nodomain.freeyourgadget.internethelper.aidl.http.HttpRequest;
 public class GBWebClient extends WebViewClient {
     private static final Logger LOG = LoggerFactory.getLogger(GBWebClient.class);
 
-    public static int REQUEST_TYPE_OTHER = 0;
-    public static int REQUEST_TYPE_PEBBLE_APP_STORE = 1;
-    public static int REQUEST_TYPE_PEBBLE_APP_CONFIG = 2;
-    public static int REQUEST_TYPE_PEBBLE_BACKGROUND_JS = 3;
-    public static int REQUEST_TYPE_BANGLE_APP_LOADER = 4;
-    private int requestType;
+    private final InternetFirewall firewall;
 
-    private String[] LocallySupportedDomains = new String[]{
+    private final String[] LocallySupportedDomains = new String[]{
             "openweathermap.org",   //for weather :)
             "rawgit.com",           //for trekvolle
     };
@@ -72,9 +71,9 @@ public class GBWebClient extends WebViewClient {
     private final Map<String, List<Entry>> postData = new HashMap<>();
     private record Entry(long timestamp, String body) {}
 
-    public GBWebClient(int type) {
+    public GBWebClient(final InternetRequestType type, @NotNull final GBDevice device) {
         super();
-        requestType = type;
+        this.firewall = new InternetFirewall(type, device);
     }
 
     /**
@@ -155,24 +154,11 @@ public class GBWebClient extends WebViewClient {
         }
 
         // Handle predefined groups
-        if (requestType == REQUEST_TYPE_PEBBLE_APP_STORE) {
-            matchFound = true;
-            urlIsAllowed = prefs.getBoolean("pref_key_internethelper_allow_pebble_appstore", false);
-        } else if (requestType == REQUEST_TYPE_PEBBLE_APP_CONFIG) {
-            matchFound = true;
-            urlIsAllowed = prefs.getBoolean("pref_key_internethelper_allow_pebble_configs", false);
-        } else if (requestType == REQUEST_TYPE_PEBBLE_BACKGROUND_JS) {
-            matchFound = true;
-            urlIsAllowed = prefs.getBoolean("pref_key_internethelper_allow_pebble_background_js", false);
-        } else if (requestType == REQUEST_TYPE_BANGLE_APP_LOADER) {
-            matchFound = true;
-            urlIsAllowed = prefs.getBoolean("pref_key_internethelper_allow_bangle_app_loader", false);
-        }
+        urlIsAllowed = firewall.isAllowed(requestedUri);
 
         // Handle OpenWeatherMap locally
         boolean forceLocal = false;
         if (locallySupported && prefs.getBoolean("pref_key_internethelper_force_local", true)) {
-            matchFound = true;
             urlIsAllowed = true;
             forceLocal = true;
         }
diff --git a/app/src/main/proto/garmin/gdi_http_service.proto b/app/src/main/proto/garmin/gdi_http_service.proto
index a0cac7c057..c811dd038f 100644
--- a/app/src/main/proto/garmin/gdi_http_service.proto
+++ b/app/src/main/proto/garmin/gdi_http_service.proto
@@ -57,7 +57,7 @@ message HttpService {
     optional uint32 httpStatus = 2;
     optional bytes body = 3;
     optional bytes headers = 4;
-    optional bytes size = 5;
+    optional uint32 size = 5;
     optional ResponseType responseType = 6;
   }
 
diff --git a/app/src/main/res/layout/activity_internet_firewall.xml b/app/src/main/res/layout/activity_internet_firewall.xml
new file mode 100644
index 0000000000..44be0dcac0
--- /dev/null
+++ b/app/src/main/res/layout/activity_internet_firewall.xml
@@ -0,0 +1,39 @@
+<?xml version="1.0" encoding="utf-8"?>
+<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent"
+    android:fitsSystemWindows="true">
+
+    <FrameLayout
+        android:layout_width="match_parent"
+        android:layout_height="match_parent"
+        android:paddingBottom="80dp">
+
+        <androidx.recyclerview.widget.RecyclerView
+            android:id="@+id/firewall_rules_list"
+            android:layout_width="match_parent"
+            android:layout_height="match_parent"
+            android:clipToPadding="false" />
+
+        <TextView
+            android:id="@+id/empty_state_text"
+            android:layout_width="wrap_content"
+            android:layout_height="wrap_content"
+            android:layout_gravity="center"
+            android:text="@string/internet_firewall_no_domains"
+            android:textAppearance="?attr/textAppearanceBody1"
+            android:visibility="gone" />
+
+    </FrameLayout>
+
+    <com.google.android.material.floatingactionbutton.FloatingActionButton
+        android:id="@+id/fab_add_domain"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        android:layout_gravity="bottom|end"
+        android:layout_margin="@dimen/fab_margin"
+        android:contentDescription="@string/internet_firewall_add_domain"
+        app:srcCompat="@drawable/ic_add" />
+
+</androidx.coordinatorlayout.widget.CoordinatorLayout>
diff --git a/app/src/main/res/layout/dialog_firewall_add_rule.xml b/app/src/main/res/layout/dialog_firewall_add_rule.xml
new file mode 100644
index 0000000000..18e41076e0
--- /dev/null
+++ b/app/src/main/res/layout/dialog_firewall_add_rule.xml
@@ -0,0 +1,46 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="wrap_content"
+    android:orientation="vertical"
+    android:paddingStart="24dp"
+    android:paddingTop="20dp"
+    android:paddingEnd="24dp"
+    android:paddingBottom="8dp">
+
+    <com.google.android.material.textfield.TextInputLayout
+        android:id="@+id/domain_input_layout"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:hint="@string/internet_firewall_domain"
+        app:boxBackgroundMode="outline">
+
+        <com.google.android.material.textfield.TextInputEditText
+            android:id="@+id/domain_input_text"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:imeOptions="flagNoPersonalizedLearning|flagNoExtractUi"
+            android:inputType="textUri|textNoSuggestions"
+            android:singleLine="true" />
+
+    </com.google.android.material.textfield.TextInputLayout>
+
+    <com.google.android.material.textfield.TextInputLayout
+        android:id="@+id/action_input_layout"
+        style="@style/Widget.Material3.TextInputLayout.OutlinedBox.ExposedDropdownMenu"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:layout_marginTop="16dp"
+        android:hint="@string/internet_firewall_action"
+        android:labelFor="@id/action_dropdown">
+
+        <AutoCompleteTextView
+            android:id="@+id/action_dropdown"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:inputType="none" />
+
+    </com.google.android.material.textfield.TextInputLayout>
+
+</LinearLayout>
diff --git a/app/src/main/res/layout/firewall_rule_item.xml b/app/src/main/res/layout/firewall_rule_item.xml
new file mode 100644
index 0000000000..fa82d57de6
--- /dev/null
+++ b/app/src/main/res/layout/firewall_rule_item.xml
@@ -0,0 +1,36 @@
+<?xml version="1.0" encoding="utf-8"?>
+<com.google.android.material.card.MaterialCardView xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    android:layout_width="match_parent"
+    android:layout_height="wrap_content"
+    android:layout_marginStart="8dp"
+    android:layout_marginTop="4dp"
+    android:layout_marginEnd="8dp"
+    android:layout_marginBottom="4dp"
+    app:cardCornerRadius="8dp"
+    app:cardElevation="2dp">
+
+    <LinearLayout
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:orientation="vertical"
+        android:padding="16dp">
+
+        <TextView
+            android:id="@+id/domain_text"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:textAppearance="?attr/textAppearanceBody1"
+            android:textStyle="bold" />
+
+        <TextView
+            android:id="@+id/action_text"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginTop="4dp"
+            android:textAppearance="?attr/textAppearanceBody2"
+            android:textColor="?android:attr/textColorSecondary" />
+
+    </LinearLayout>
+
+</com.google.android.material.card.MaterialCardView>
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
index 8596925d33..71b8be3487 100644
--- a/app/src/main/res/values/strings.xml
+++ b/app/src/main/res/values/strings.xml
@@ -4526,6 +4526,15 @@
     <string name="internet_helper_pref_pebble_app_config_summary">Allow access to webpages that are needed for configuring apps and watchfaces</string>
     <string name="internet_helper_pref_bangle_app_loader_title">Bangle app loader</string>
     <string name="internet_helper_pref_bangle_app_loader_summary">Access the Bangle app loader website</string>
+    <string name="internet_firewall_title">Firewall</string>
+    <string name="internet_firewall_summary">Configure which domains can be accessed through the internet</string>
+    <string name="internet_firewall_domain">Domain</string>
+    <string name="internet_firewall_action">Action</string>
+    <string name="internet_firewall_allow">Allow</string>
+    <string name="internet_firewall_block">Block</string>
+    <string name="internet_firewall_no_domains">No domain rules found. Default action: %s</string>
+    <string name="internet_firewall_add_domain">Add domain</string>
+    <string name="internet_firewall_edit_domain">Edit domain</string>
     <string name="rebble_appstore_download_failed_wrong_content_type">Download failed, wrong content-type: %1$s</string>
     <string name="rebble_appstore_download_failed">Download failed: %1$s</string>
     <string name="rebble_appstore_fetch_app_info_failed_content_type">Fetching app info failed, wrong content-type: %1$s</string>
diff --git a/app/src/main/res/xml/devicesettings_device_internet_firewall.xml b/app/src/main/res/xml/devicesettings_device_internet_firewall.xml
new file mode 100644
index 0000000000..e64a9fca4a
--- /dev/null
+++ b/app/src/main/res/xml/devicesettings_device_internet_firewall.xml
@@ -0,0 +1,9 @@
+<?xml version="1.0" encoding="utf-8"?>
+<androidx.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+    <Preference
+        android:dependency="device_internet_access"
+        android:icon="@drawable/ic_shield"
+        android:key="pref_key_internet_firewall"
+        android:summary="@string/internet_firewall_summary"
+        android:title="@string/internet_firewall_title" />
+</androidx.preference.PreferenceScreen>
diff --git a/app/src/main/res/xml/devicesettings_root_internet.xml b/app/src/main/res/xml/devicesettings_root_internet.xml
new file mode 100644
index 0000000000..66ac642e63
--- /dev/null
+++ b/app/src/main/res/xml/devicesettings_root_internet.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0" encoding="utf-8"?>
+<androidx.preference.PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android">
+    <PreferenceScreen
+        android:icon="@drawable/ic_language"
+        android:key="pref_screen_internet"
+        android:persistent="false"
+        android:title="@string/permission_internet_access_title" />
+</androidx.preference.PreferenceScreen>
```
-----------------------------------
