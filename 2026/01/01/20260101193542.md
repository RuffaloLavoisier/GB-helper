# Commit: 82177b9b77857edd6a11e485fb156aa1e8ed6723
## Message: Soundcore Q30: Switch to BTBR support class, add headphones features
## Changed files:
app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/soundcore/q30/SoundcoreQ30Coordinator.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/soundcore/q30/SoundcoreQ30DeviceSupport.java

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/soundcore/q30/SoundcoreQ30IOThread.java

## Diff:
```
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/soundcore/q30/SoundcoreQ30Coordinator.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/soundcore/q30/SoundcoreQ30Coordinator.java
index 8d4f706fd9..72ff4b9ed0 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/soundcore/q30/SoundcoreQ30Coordinator.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/soundcore/q30/SoundcoreQ30Coordinator.java
@@ -6,6 +6,7 @@ import java.util.regex.Pattern;
 
 import nodomain.freeyourgadget.gadgetbridge.R;
 import nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSpecificSettings;
+import nodomain.freeyourgadget.gadgetbridge.activities.devicesettings.DeviceSpecificSettingsScreen;
 import nodomain.freeyourgadget.gadgetbridge.devices.AbstractBLClassicDeviceCoordinator;
 import nodomain.freeyourgadget.gadgetbridge.devices.DeviceCoordinator;
 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
@@ -49,6 +50,8 @@ public class SoundcoreQ30Coordinator extends AbstractBLClassicDeviceCoordinator
     public DeviceSpecificSettings getDeviceSpecificSettings(final GBDevice device) {
         final DeviceSpecificSettings deviceSpecificSettings = new DeviceSpecificSettings();
         deviceSpecificSettings.addRootScreen(R.xml.devicesettings_soundcore_q30);
+        deviceSpecificSettings.addRootScreen(DeviceSpecificSettingsScreen.CALLS_AND_NOTIFICATIONS);
+        deviceSpecificSettings.addSubScreen(DeviceSpecificSettingsScreen.CALLS_AND_NOTIFICATIONS, R.xml.devicesettings_headphones);
         return deviceSpecificSettings;
     }
 
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/soundcore/q30/SoundcoreQ30DeviceSupport.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/soundcore/q30/SoundcoreQ30DeviceSupport.java
index 499b77d9d3..a2b1a2b492 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/soundcore/q30/SoundcoreQ30DeviceSupport.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/soundcore/q30/SoundcoreQ30DeviceSupport.java
@@ -1,23 +1,25 @@
 package nodomain.freeyourgadget.gadgetbridge.service.devices.soundcore.q30;
 
-import nodomain.freeyourgadget.gadgetbridge.service.serial.AbstractSerialDeviceSupport;
-import nodomain.freeyourgadget.gadgetbridge.service.serial.GBDeviceIoThread;
-import nodomain.freeyourgadget.gadgetbridge.service.serial.GBDeviceProtocol;
+import java.util.UUID;
 
-public class SoundcoreQ30DeviceSupport extends AbstractSerialDeviceSupport {
+import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
+import nodomain.freeyourgadget.gadgetbridge.service.btbr.TransactionBuilder;
+import nodomain.freeyourgadget.gadgetbridge.service.serial.AbstractHeadphoneSerialDeviceSupportV2;
+
+public class SoundcoreQ30DeviceSupport extends AbstractHeadphoneSerialDeviceSupportV2<SoundcoreQ30Protocol> {
+    public SoundcoreQ30DeviceSupport() {
+        addSupportedService(UUID.fromString("00001101-0000-1000-8000-00805f9b34fb"));
+    }
 
     @Override
-    protected GBDeviceProtocol createDeviceProtocol() {
+    protected SoundcoreQ30Protocol createDeviceProtocol() {
         return new SoundcoreQ30Protocol(getDevice());
     }
 
     @Override
-    protected GBDeviceIoThread createDeviceIOThread() {
-        return new SoundcoreQ30IOThread(getDevice(), getContext(), (SoundcoreQ30Protocol) getDeviceProtocol(),this, getBluetoothAdapter());
-    }
-
-    @Override
-    public boolean useAutoConnect() {
-        return false;
+    protected TransactionBuilder initializeDevice(final TransactionBuilder builder) {
+        builder.write(mDeviceProtocol.encodeDeviceInfoRequest());
+        builder.setDeviceState(GBDevice.State.INITIALIZED);
+        return builder;
     }
 }
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/soundcore/q30/SoundcoreQ30IOThread.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/soundcore/q30/SoundcoreQ30IOThread.java
deleted file mode 100644
index bff87809e8..0000000000
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/devices/soundcore/q30/SoundcoreQ30IOThread.java
+++ /dev/null
@@ -1,51 +0,0 @@
-package nodomain.freeyourgadget.gadgetbridge.service.devices.soundcore.q30;
-
-import static nodomain.freeyourgadget.gadgetbridge.util.GB.hexdump;
-
-import android.bluetooth.BluetoothAdapter;
-import android.content.Context;
-import android.os.ParcelUuid;
-
-import androidx.annotation.NonNull;
-
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import java.io.IOException;
-import java.io.InputStream;
-import java.util.Arrays;
-import java.util.UUID;
-
-import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;
-import nodomain.freeyourgadget.gadgetbridge.service.btclassic.BtClassicIoThread;
-import nodomain.freeyourgadget.gadgetbridge.service.serial.AbstractSerialDeviceSupport;
-
-public class SoundcoreQ30IOThread extends BtClassicIoThread {
-    private static final Logger LOG = LoggerFactory.getLogger(SoundcoreQ30IOThread.class);
-    private final SoundcoreQ30Protocol mSoundcoreProtocol;
-
-    public SoundcoreQ30IOThread(GBDevice gbDevice, Context context, SoundcoreQ30Protocol deviceProtocol, AbstractSerialDeviceSupport deviceSupport, BluetoothAdapter btAdapter) {
-        super(gbDevice, context, deviceProtocol, deviceSupport, btAdapter);
-        mSoundcoreProtocol = deviceProtocol;
-    }
-
-    @Override
-    protected byte[] parseIncoming(InputStream inStream) throws IOException {
-        byte[] buffer = new byte[1048576]; //HUGE read
-        int bytes = inStream.read(buffer);
-        LOG.debug("read {} bytes. {}", bytes, hexdump(buffer, 0, bytes));
-        return Arrays.copyOf(buffer, bytes);
-    }
-
-    @Override
-    protected void initialize() {
-        write(mSoundcoreProtocol.encodeDeviceInfoRequest());
-        super.initialize();
-    }
-
-    @Override
-    @NonNull
-    protected UUID getUuidToConnect(@NonNull ParcelUuid[] uuids) {
-        return UUID.fromString("00001101-0000-1000-8000-00805f9b34fb");
-    }
-}
```
-----------------------------------
