# Commit: 367ce236a12d5186e1ebeb05bc08686d3d8c42b6
## Message: Export GenericWeatherReceiver from manifest

This is useful to cache the latest weather when no gadgets are
connected, as well as for weather app developers to be able to test
their apps without any gadget.
## Changed files:
app/src/main/AndroidManifest.xml

app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/DeviceCommunicationService.java

## Diff:
```
diff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml
index b573d14ada..3f9985bb18 100644
--- a/app/src/main/AndroidManifest.xml
+++ b/app/src/main/AndroidManifest.xml
@@ -651,7 +651,7 @@
         <receiver
             android:name=".externalevents.GenericWeatherReceiver"
             android:enabled="true"
-            android:exported="false">
+            android:exported="true">
             <intent-filter>
                 <action android:name="nodomain.freeyourgadget.gadgetbridge.ACTION_GENERIC_WEATHER" />
             </intent-filter>
diff --git a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/DeviceCommunicationService.java b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/DeviceCommunicationService.java
index 0e1a950d8e..2dafd307b8 100644
--- a/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/DeviceCommunicationService.java
+++ b/app/src/main/java/nodomain/freeyourgadget/gadgetbridge/service/DeviceCommunicationService.java
@@ -83,7 +83,6 @@ import nodomain.freeyourgadget.gadgetbridge.externalevents.BluetoothPairingReque
 import nodomain.freeyourgadget.gadgetbridge.externalevents.CMWeatherReceiver;
 import nodomain.freeyourgadget.gadgetbridge.externalevents.CalendarReceiver;
 import nodomain.freeyourgadget.gadgetbridge.externalevents.DeviceSettingsReceiver;
-import nodomain.freeyourgadget.gadgetbridge.externalevents.GenericWeatherReceiver;
 import nodomain.freeyourgadget.gadgetbridge.externalevents.HrvCacheInvalidationReceiver;
 import nodomain.freeyourgadget.gadgetbridge.externalevents.IntentApiReceiver;
 import nodomain.freeyourgadget.gadgetbridge.externalevents.KeyMissingReceiver;
@@ -280,7 +279,6 @@ public class DeviceCommunicationService extends Service implements SharedPrefere
     private CMWeatherReceiver mCMWeatherReceiver = null;
     private LineageOsWeatherReceiver mLineageOsWeatherReceiver = null;
     private TinyWeatherForecastGermanyReceiver mTinyWeatherForecastGermanyReceiver = null;
-    private GenericWeatherReceiver mGenericWeatherReceiver = null;
     private OmniJawsObserver mOmniJawsObserver = null;
     private final DeviceSettingsReceiver deviceSettingsReceiver = new DeviceSettingsReceiver();
     private final IntentApiReceiver intentApiReceiver = new IntentApiReceiver();
@@ -1487,10 +1485,6 @@ public class DeviceCommunicationService extends Service implements SharedPrefere
                     mTinyWeatherForecastGermanyReceiver = new TinyWeatherForecastGermanyReceiver();
                     ContextCompat.registerReceiver(this, mTinyWeatherForecastGermanyReceiver, new IntentFilter("de.kaffeemitkoffein.broadcast.WEATHERDATA"), ContextCompat.RECEIVER_EXPORTED);
                 }
-                if (mGenericWeatherReceiver == null) {
-                    mGenericWeatherReceiver = new GenericWeatherReceiver();
-                    ContextCompat.registerReceiver(this, mGenericWeatherReceiver, new IntentFilter(GenericWeatherReceiver.ACTION_GENERIC_WEATHER), ContextCompat.RECEIVER_EXPORTED);
-                }
                 if (mOmniJawsObserver == null) {
                     try {
                         mOmniJawsObserver = new OmniJawsObserver(new Handler());
@@ -1580,10 +1574,6 @@ public class DeviceCommunicationService extends Service implements SharedPrefere
                 unregisterReceiver(mGBAutoFetchReceiver);
                 mGBAutoFetchReceiver = null;
             }
-            if (mGenericWeatherReceiver != null) {
-                unregisterReceiver(mGenericWeatherReceiver);
-                mGenericWeatherReceiver = null;
-            }
             if (mSleepAsAndroidReceiver != null) {
                 unregisterReceiver(mSleepAsAndroidReceiver);
                 mSleepAsAndroidReceiver = null;
```
-----------------------------------
